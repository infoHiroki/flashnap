<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <meta name="theme-color" content="#4a90d9">
  <title>Flashnap</title>
  <link rel="manifest" href="manifest.json">
  <style>
    :root {
      --bg-primary: #ffffff;
      --bg-secondary: #f5f5f5;
      --bg-tertiary: #e8e8e8;
      --text-primary: #1a1a1a;
      --text-secondary: #666666;
      --accent: #4a90d9;
      --accent-hover: #3a7bc8;
      --danger: #e74c3c;
      --danger-hover: #c0392b;
      --success: #27ae60;
      --border: #ddd;
      --shadow: rgba(0, 0, 0, 0.1);
    }

    [data-theme="dark"] {
      --bg-primary: #1a1a2e;
      --bg-secondary: #16213e;
      --bg-tertiary: #0f3460;
      --text-primary: #eaeaea;
      --text-secondary: #b0b0b0;
      --border: #2a2a4a;
      --shadow: rgba(0, 0, 0, 0.3);
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: var(--bg-primary);
      color: var(--text-primary);
      min-height: 100vh;
      min-height: 100dvh;
      overflow-x: hidden;
    }

    /* ãƒ˜ãƒƒãƒ€ãƒ¼ */
    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px 16px;
      background: var(--bg-secondary);
      border-bottom: 1px solid var(--border);
      position: sticky;
      top: 0;
      z-index: 100;
    }

    .header h1 {
      font-size: 1.2rem;
      font-weight: 600;
    }

    .header-buttons {
      display: flex;
      gap: 8px;
    }

    /* ãƒœã‚¿ãƒ³å…±é€š */
    .btn {
      padding: 8px 16px;
      border: none;
      border-radius: 8px;
      font-size: 0.9rem;
      cursor: pointer;
      transition: background 0.2s, transform 0.1s;
    }

    .btn:active {
      transform: scale(0.98);
    }

    .btn-primary {
      background: var(--accent);
      color: white;
    }

    .btn-primary:hover {
      background: var(--accent-hover);
    }

    .btn-secondary {
      background: var(--bg-tertiary);
      color: var(--text-primary);
    }

    .btn-danger {
      background: var(--danger);
      color: white;
    }

    .btn-danger:hover {
      background: var(--danger-hover);
    }

    .btn-icon {
      padding: 8px;
      background: transparent;
      font-size: 1.2rem;
    }

    /* ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ */
    .main {
      padding: 16px;
      max-width: 600px;
      margin: 0 auto;
    }

    /* èª¿æŸ»é¸æŠç”»é¢ */
    .survey-list {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .survey-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 16px;
      background: var(--bg-secondary);
      border-radius: 12px;
      border: 1px solid var(--border);
      cursor: pointer;
      transition: background 0.2s;
    }

    .survey-item:hover {
      background: var(--bg-tertiary);
    }

    .survey-item.active {
      border-color: var(--accent);
      border-width: 2px;
    }

    .survey-info h3 {
      font-size: 1rem;
      margin-bottom: 4px;
    }

    .survey-info p {
      font-size: 0.8rem;
      color: var(--text-secondary);
    }

    .survey-actions {
      display: flex;
      gap: 4px;
    }

    /* éšå±¤è¡¨ç¤º */
    .hierarchy-section {
      margin-bottom: 24px;
    }

    .breadcrumbs {
      display: flex;
      flex-wrap: wrap;
      gap: 4px;
      align-items: center;
      margin-bottom: 16px;
      font-size: 0.85rem;
      color: var(--text-secondary);
    }

    .breadcrumb-item {
      cursor: pointer;
      padding: 4px 8px;
      border-radius: 4px;
      background: var(--bg-secondary);
    }

    .breadcrumb-item:hover {
      background: var(--bg-tertiary);
    }

    .breadcrumb-separator {
      color: var(--text-secondary);
    }

    .node-list {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .node-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px 16px;
      background: var(--bg-secondary);
      border-radius: 8px;
      border: 1px solid var(--border);
      cursor: pointer;
      transition: background 0.2s;
    }

    .node-item:hover {
      background: var(--bg-tertiary);
    }

    .node-name {
      font-weight: 500;
    }

    .node-count {
      font-size: 0.8rem;
      color: var(--text-secondary);
    }

    .node-actions {
      display: flex;
      gap: 4px;
    }

    /* æ’®å½±ã‚»ã‚¯ã‚·ãƒ§ãƒ³ */
    .capture-section {
      text-align: center;
      padding: 24px 0;
    }

    .current-number {
      font-size: 4rem;
      font-weight: 700;
      color: var(--accent);
      margin-bottom: 8px;
    }

    .current-path {
      font-size: 0.9rem;
      color: var(--text-secondary);
      margin-bottom: 8px;
      word-break: break-all;
    }

    .current-count {
      font-size: 0.85rem;
      color: var(--text-secondary);
      margin-bottom: 24px;
    }

    .capture-buttons {
      display: flex;
      flex-direction: column;
      gap: 12px;
      align-items: center;
    }

    /* æ¨ªå‘ãå°‚ç”¨ãƒœã‚¿ãƒ³ã¯ç¸¦å‘ãã§ã¯éè¡¨ç¤º */
    .capture-buttons-landscape {
      display: none;
    }

    .btn-capture {
      width: 120px;
      height: 120px;
      border-radius: 50%;
      font-size: 3rem;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .btn-undo {
      padding: 12px 24px;
    }

    #fileInput {
      display: none;
    }

    /* æ¨ªæŒã¡å°‚ç”¨ã‚µã‚¤ãƒ‰ãƒãƒ¼ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆéè¡¨ç¤ºï¼‰ */
    .landscape-sidebar {
      display: none;
    }

    /* æ¨ªæŒã¡æ™‚ã®ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ */
    @media (orientation: landscape) and (max-height: 500px) {
      body {
        overflow: hidden;
      }

      .header {
        padding: 6px 16px;
      }

      .main {
        padding: 4px 8px;
        max-width: none;
        overflow: hidden;
      }

      #captureScreen {
        display: grid;
        grid-template-columns: 180px minmax(0, 1fr) 100px;
        grid-template-rows: 1fr;
        gap: 8px;
        height: calc(100dvh - 44px);
        align-items: start;
      }

      /* æ¨ªå‘ãæ™‚ã¯ãƒ‘ãƒ³ããšéè¡¨ç¤ºï¼ˆå·¦ã‚µã‚¤ãƒ‰ãƒãƒ¼ã§ä»£æ›¿ï¼‰ */
      .breadcrumbs {
        display: none;
      }

      /* ç¸¦å‘ãç”¨ã®éšå±¤ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã¯éè¡¨ç¤º */
      .hierarchy-section {
        display: none;
      }

      /* å·¦: ãƒ„ãƒªãƒ¼ã‚µã‚¤ãƒ‰ãƒãƒ¼ */
      .landscape-sidebar {
        grid-column: 1;
        grid-row: 1;
        display: flex;
        flex-direction: column;
        max-height: 100%;
        overflow-y: auto;
        align-self: start;
        padding-left: 0;
      }

      .landscape-tree {
        flex: 1;
        overflow-y: auto;
      }

      /* ãƒ„ãƒªãƒ¼ã‚¢ã‚¤ãƒ†ãƒ  */
      .tree-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 6px 8px;
        font-size: 0.8rem;
        cursor: pointer;
        border-left: 3px solid transparent;
        transition: background 0.15s;
      }

      .tree-item:hover {
        background: var(--bg-tertiary);
      }

      .tree-item.selected {
        background: var(--bg-tertiary);
        border-left-color: var(--accent);
      }

      .tree-survey {
        font-weight: 600;
        background: var(--bg-secondary);
        border-bottom: 1px solid var(--border);
      }

      .tree-node {
        font-size: 0.75rem;
      }

      .tree-item-name {
        flex: 1;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }

      .tree-item-count {
        font-size: 0.7rem;
        color: var(--text-secondary);
        margin-left: 4px;
        flex-shrink: 0;
      }

      .tree-item-actions {
        display: none;
      }

      .tree-item-actions .btn-icon {
        font-size: 0.75rem;
        padding: 2px 4px;
        opacity: 0.6;
      }

      .tree-item-actions .btn-icon:hover {
        opacity: 1;
      }

      .btn-add-node-landscape {
        margin-top: 8px;
        padding: 6px 8px;
        font-size: 0.8rem;
        width: 100%;
      }

      /* ä¸­å¤®: ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãƒ©ãƒƒãƒ‘ãƒ¼ */
      .center-content {
        grid-column: 2;
        grid-row: 1;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        height: 100%;
        overflow: hidden;  /* ã¯ã¿å‡ºã—é˜²æ­¢ */
        min-width: 0;      /* flexå­è¦ç´ ã®ç¸®å°è¨±å¯ */
      }

      .capture-section {
        padding: 0;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
      }

      .capture-section .current-number {
        font-size: 4.5rem;
        margin-bottom: 4px;
      }

      .capture-section .current-path {
        display: none;
      }

      .capture-section .current-count {
        display: block;
        font-size: 1.1rem;
        margin-bottom: 4px;
      }

      .capture-section .capture-buttons {
        display: none;
      }

      /* recent-sectionå¾©æ´»ï¼ˆä¸­å¤®ã‚«ãƒ©ãƒ å†…ï¼‰ */
      .recent-section {
        display: block;
        margin-top: 8px;
        width: 100%;
        max-width: 100%;   /* noneã§ã¯ãªã100%ã« */
        overflow: hidden;  /* ã¯ã¿å‡ºã—é˜²æ­¢ */
      }

      .recent-section h3 {
        font-size: 0.8rem;
        margin-bottom: 6px;
        text-align: center;
      }

      .recent-list {
        display: flex;     /* æ˜ç¤ºçš„ã«è¿½åŠ  */
        flex-wrap: nowrap; /* æŠ˜ã‚Šè¿”ã•ãªã„ */
        justify-content: flex-start;
        overflow-x: auto;
        gap: 8px;
      }

      .recent-item {
        width: 50px;
        height: 50px;
      }

      .recent-item-name {
        font-size: 0.55rem;
      }

      /* å³: ã‚«ãƒ¡ãƒ©ãƒœã‚¿ãƒ³ */
      .capture-buttons-landscape {
        grid-column: 3;
        grid-row: 1;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        height: 100%;
        position: relative;
      }

      /* å–ã‚Šæ¶ˆã—ãƒœã‚¿ãƒ³ã¯ä¸Šéƒ¨ã«çµ¶å¯¾é…ç½®ï¼ˆã‚«ãƒ¡ãƒ©ä½ç½®ã«å½±éŸ¿ãªã—ï¼‰ */
      .capture-buttons-landscape .btn-undo {
        position: absolute;
        top: 8px;
        font-size: 0.75rem;
        padding: 4px 8px;
      }

      .capture-buttons-landscape .btn-capture {
        width: 80px;
        height: 80px;
        font-size: 2rem;
        border-radius: 50%;
        background: var(--accent);
        color: white;
        border: none;
        cursor: pointer;
      }

      /* æ¨ªæŒã¡æ™‚ã®ãƒ¢ãƒ¼ãƒ€ãƒ«å¯¾å¿œ */
      .modal {
        max-height: 90vh;
        overflow-y: auto;
      }

      .modal-body {
        padding: 12px;
      }

      .form-group {
        margin-bottom: 8px;
      }

      .form-group input,
      .form-group select {
        padding: 8px;
      }
    }

    /* æœ€è¿‘ã®æ’®å½± */
    .recent-section {
      margin-top: 32px;
    }

    .recent-section h3 {
      font-size: 0.9rem;
      color: var(--text-secondary);
      margin-bottom: 12px;
    }

    .recent-list {
      display: flex;
      gap: 8px;
      overflow-x: auto;
      padding-bottom: 8px;
    }

    .recent-item {
      flex-shrink: 0;
      width: 80px;
      height: 80px;
      border-radius: 8px;
      overflow: hidden;
      position: relative;
    }

    .recent-item img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .recent-item-name {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      background: rgba(0, 0, 0, 0.7);
      color: white;
      font-size: 0.65rem;
      padding: 2px 4px;
      text-align: center;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    /* ãƒ¢ãƒ¼ãƒ€ãƒ« */
    .modal-overlay {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.5);
      z-index: 200;
      align-items: center;
      justify-content: center;
      padding: 16px;
    }

    .modal-overlay.active {
      display: flex;
    }

    .modal {
      background: var(--bg-primary);
      border-radius: 16px;
      width: 100%;
      max-width: 480px;
      max-height: 90vh;
      overflow: auto;
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 16px;
      border-bottom: 1px solid var(--border);
    }

    .modal-header h2 {
      font-size: 1.1rem;
    }

    .modal-body {
      padding: 16px;
    }

    .modal-footer {
      display: flex;
      gap: 8px;
      justify-content: flex-end;
      padding: 16px;
      border-top: 1px solid var(--border);
    }

    /* ãƒ•ã‚©ãƒ¼ãƒ  */
    .form-group {
      margin-bottom: 16px;
    }

    .form-group label {
      display: block;
      margin-bottom: 6px;
      font-size: 0.9rem;
      font-weight: 500;
    }

    .form-group input,
    .form-group select {
      width: 100%;
      padding: 10px 12px;
      border: 1px solid var(--border);
      border-radius: 8px;
      font-size: 1rem;
      background: var(--bg-secondary);
      color: var(--text-primary);
    }

    .form-group input:focus,
    .form-group select:focus {
      outline: none;
      border-color: var(--accent);
    }

    .form-group input[type="checkbox"] {
      width: auto;
      margin-right: 8px;
    }

    .form-group label:has(input[type="checkbox"]) {
      display: flex;
      align-items: center;
    }

    .form-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
    }

    /* è¨­å®š */
    .setting-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px 0;
      border-bottom: 1px solid var(--border);
    }

    .setting-item:last-child {
      border-bottom: none;
    }

    .setting-label {
      font-weight: 500;
    }

    .setting-desc {
      font-size: 0.8rem;
      color: var(--text-secondary);
    }

    /* ãƒˆã‚°ãƒ«ã‚¹ã‚¤ãƒƒãƒ */
    .toggle {
      position: relative;
      width: 48px;
      height: 28px;
    }

    .toggle input {
      opacity: 0;
      width: 0;
      height: 0;
    }

    .toggle-slider {
      position: absolute;
      cursor: pointer;
      inset: 0;
      background: var(--bg-tertiary);
      border-radius: 28px;
      transition: 0.3s;
    }

    .toggle-slider:before {
      content: '';
      position: absolute;
      height: 22px;
      width: 22px;
      left: 3px;
      bottom: 3px;
      background: white;
      border-radius: 50%;
      transition: 0.3s;
    }

    .toggle input:checked + .toggle-slider {
      background: var(--accent);
    }

    .toggle input:checked + .toggle-slider:before {
      transform: translateX(20px);
    }

    /* ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆå†™çœŸä¸€è¦§ */
    .photo-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
      gap: 8px;
      margin-top: 16px;
    }

    .photo-item {
      position: relative;
      aspect-ratio: 1;
      border-radius: 8px;
      overflow: hidden;
    }

    .photo-item img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .photo-item-delete {
      position: absolute;
      top: 4px;
      right: 4px;
      width: 24px;
      height: 24px;
      border-radius: 50%;
      background: var(--danger);
      color: white;
      border: none;
      cursor: pointer;
      font-size: 0.8rem;
    }

    .photo-item-name {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      background: rgba(0, 0, 0, 0.7);
      color: white;
      font-size: 0.6rem;
      padding: 4px;
      text-align: center;
    }

    /* ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆä¸€è¦§ */
    .template-list {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .template-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px;
      background: var(--bg-secondary);
      border-radius: 8px;
    }

    /* çµ±è¨ˆ */
    .stats {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 12px;
      margin-bottom: 16px;
    }

    .stat-item {
      text-align: center;
      padding: 12px;
      background: var(--bg-secondary);
      border-radius: 8px;
    }

    .stat-value {
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--accent);
    }

    .stat-label {
      font-size: 0.8rem;
      color: var(--text-secondary);
    }

    /* ç©ºçŠ¶æ…‹ */
    .empty-state {
      text-align: center;
      padding: 48px 16px;
      color: var(--text-secondary);
    }

    .empty-state-icon {
      font-size: 3rem;
      margin-bottom: 16px;
    }

    /* ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ */
    .hidden {
      display: none !important;
    }

    .text-center {
      text-align: center;
    }

    .mt-16 {
      margin-top: 16px;
    }

    .mb-16 {
      margin-bottom: 16px;
    }

    /* ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿å…¥åŠ›ã‚»ã‚¯ã‚·ãƒ§ãƒ³ */
    .metadata-section {
      padding: 0 16px 16px;
    }

    .metadata-row {
      margin-bottom: 8px;
    }

    .metadata-row select {
      width: 100%;
      padding: 10px 12px;
      border: 1px solid var(--border);
      border-radius: 8px;
      background: var(--bg-primary);
      color: var(--text-primary);
      font-size: 0.9rem;
      appearance: auto;
    }

    .meta-tabs {
      display: flex;
      gap: 4px;
      flex-wrap: wrap;
    }

    .meta-tabs button {
      flex: 1;
      min-width: 60px;
      padding: 8px 4px;
      border: 1px solid var(--border);
      border-radius: 8px;
      background: var(--bg-secondary);
      color: var(--text-primary);
      font-size: 0.8rem;
      cursor: pointer;
      transition: background 0.2s;
    }

    .meta-tabs button.active {
      background: var(--accent);
      color: white;
      border-color: var(--accent);
    }

    @media (orientation: landscape) and (max-height: 500px) {
      .metadata-section {
        padding: 0 8px 8px;
      }
      .metadata-row {
        margin-bottom: 4px;
      }
      .metadata-row select {
        padding: 6px 8px;
        font-size: 0.8rem;
      }
      .meta-tabs button {
        padding: 4px 2px;
        font-size: 0.75rem;
      }
    }
  </style>
</head>
<body>
  <!-- Google APIs for Drive integration -->
  <script src="https://apis.google.com/js/api.js" async defer></script>
  <script src="https://accounts.google.com/gsi/client" async defer></script>
  <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
  <header class="header">
    <div style="display: flex; align-items: center; gap: 8px;">
      <button class="btn btn-icon hidden" id="btnBack" title="æˆ»ã‚‹">
        <span>â†</span>
      </button>
      <h1 id="headerTitle" style="cursor: pointer;">Flashnap</h1>
    </div>
    <div class="header-buttons">
      <button class="btn btn-icon" id="btnExport" title="ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ">
        <span>ğŸ“¤</span>
      </button>
      <button class="btn btn-icon" id="btnSettings" title="è¨­å®š">
        <span>âš™ï¸</span>
      </button>
    </div>
  </header>

  <!-- ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
  <main class="main">
    <!-- èª¿æŸ»é¸æŠç”»é¢ -->
    <section id="surveyScreen">
      <div class="survey-list" id="surveyList"></div>
      <button class="btn btn-primary mt-16" id="btnNewSurvey" style="width: 100%;">
        + æ–°è¦èª¿æŸ»ã‚’ä½œæˆ
      </button>
    </section>

    <!-- æ’®å½±ç”»é¢ -->
    <section id="captureScreen" class="hidden">
      <!-- ãƒ‘ãƒ³ããš -->
      <div class="breadcrumbs" id="breadcrumbs"></div>

      <!-- æ¨ªæŒã¡å°‚ç”¨ãƒ„ãƒªãƒ¼ã‚µã‚¤ãƒ‰ãƒãƒ¼ -->
      <div class="landscape-sidebar" id="landscapeSidebar">
        <div class="landscape-tree" id="landscapeTree"></div>
        <button class="btn btn-secondary btn-add-node-landscape" id="btnAddNodeLandscape">
          + éšå±¤è¿½åŠ 
        </button>
      </div>

      <!-- éšå±¤ä¸€è¦§ï¼ˆç¸¦å‘ãç”¨ï¼‰ -->
      <div class="hierarchy-section">
        <div class="node-list" id="nodeList"></div>
        <button class="btn btn-secondary mt-16" id="btnAddNode" style="width: 100%;">
          + éšå±¤ã‚’è¿½åŠ 
        </button>
      </div>

      <!-- ä¸­å¤®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ï¼ˆæ’®å½±ã‚»ã‚¯ã‚·ãƒ§ãƒ³ + æœ€è¿‘ã®æ’®å½±ï¼‰ -->
      <div class="center-content">
        <!-- æ’®å½±ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
        <div class="capture-section">
          <div class="current-number" id="currentNumber">001</div>
          <div class="current-path" id="currentPath">æ’®å½±å ´æ‰€ã‚’é¸æŠã—ã¦ãã ã•ã„</div>
          <div class="current-count" id="currentCount">0æšæ’®å½±æ¸ˆã¿</div>
          <div id="metadataSection" class="metadata-section hidden">
            <div class="metadata-row">
              <div class="meta-tabs" id="categoryTabs"></div>
            </div>
            <div class="metadata-row">
              <select id="metaPart"><option value="">éƒ¨ä½</option></select>
            </div>
            <div class="metadata-row">
              <select id="metaMaterial"><option value="">æè³ª</option></select>
            </div>
            <div class="metadata-row">
              <select id="metaNote"><option value="">ç‰¹è¨˜</option></select>
            </div>
          </div>
          <div class="capture-buttons">
            <input type="file" id="fileInput" accept="image/*" capture="environment">
            <button class="btn btn-primary btn-capture" id="btnCapture">
              <span>ğŸ“·</span>
            </button>
            <button class="btn btn-secondary btn-undo hidden" id="btnUndo">
              â†©ï¸ å–ã‚Šæ¶ˆã—
            </button>
          </div>
        </div>

        <!-- æœ€è¿‘ã®æ’®å½± -->
        <div class="recent-section">
          <h3>æœ€è¿‘ã®æ’®å½±</h3>
          <div class="recent-list" id="recentList"></div>
        </div>

      </div>

      <!-- æ¨ªå‘ãå°‚ç”¨ã‚«ãƒ¡ãƒ©ãƒœã‚¿ãƒ³ -->
      <div class="capture-buttons-landscape">
        <button class="btn btn-secondary btn-undo hidden" id="btnUndoLandscape">
          â†©ï¸ å–ã‚Šæ¶ˆã—
        </button>
        <button class="btn btn-primary btn-capture" id="btnCaptureLandscape">
          <span>ğŸ“·</span>
        </button>
      </div>
    </section>
  </main>

  <!-- èª¿æŸ»ä½œæˆ/ç·¨é›†ãƒ¢ãƒ¼ãƒ€ãƒ« -->
  <div class="modal-overlay" id="surveyModal">
    <div class="modal">
      <div class="modal-header">
        <h2 id="surveyModalTitle">æ–°è¦èª¿æŸ»</h2>
        <button class="btn btn-icon" id="btnCloseSurveyModal">âœ•</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label for="surveyName">èª¿æŸ»å</label>
          <input type="text" id="surveyName" placeholder="ä¾‹: æœ¬é¤¨ç‚¹æ¤œ">
        </div>
        <div class="form-group">
          <label for="surveyType">èª¿æŸ»ç¨®åˆ¥</label>
          <select id="surveyType">
            <option value="">æ¨™æº–ï¼ˆå†™çœŸã®ã¿ï¼‰</option>
            <option value="kenzen">å¥å…¨åº¦èª¿æŸ»ç¥¨</option>
          </select>
        </div>
        <div class="form-group">
          <label for="templateSelect">ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ</label>
          <select id="templateSelect">
            <option value="">ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãªã—</option>
          </select>
        </div>
        <details class="mt-16">
          <summary style="cursor: pointer; color: var(--text-secondary);">é€£ç•ªè¨­å®šã‚’ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º</summary>
          <div class="mt-16">
            <div class="form-row">
              <div class="form-group">
                <label for="surveyDigits">æ¡æ•°</label>
                <select id="surveyDigits">
                  <option value="">ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ</option>
                  <option value="2">2æ¡</option>
                  <option value="3">3æ¡</option>
                  <option value="4">4æ¡</option>
                </select>
              </div>
              <div class="form-group">
                <label for="surveyStartNum">é–‹å§‹ç•ªå·</label>
                <input type="number" id="surveyStartNum" placeholder="ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ" min="0">
              </div>
            </div>
            <div class="form-row">
              <div class="form-group">
                <label for="surveyPrefix">ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹</label>
                <input type="text" id="surveyPrefix" placeholder="ä¾‹: A-">
              </div>
              <div class="form-group">
                <label for="surveySeparator">åŒºåˆ‡ã‚Šæ–‡å­—</label>
                <select id="surveySeparator">
                  <option value="">ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ</option>
                  <option value="-">-ï¼ˆãƒã‚¤ãƒ•ãƒ³ï¼‰</option>
                  <option value="_">_ï¼ˆã‚¢ãƒ³ãƒ€ãƒ¼ã‚¹ã‚³ã‚¢ï¼‰</option>
                  <option value="">ãªã—</option>
                </select>
              </div>
            </div>
            <div class="form-group">
              <label>
                <input type="checkbox" id="surveyZeroPad"> ã‚¼ãƒ­åŸ‹ã‚
              </label>
            </div>
          </div>
        </details>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" id="btnCancelSurvey">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
        <button class="btn btn-primary" id="btnSaveSurvey">ä¿å­˜</button>
      </div>
    </div>
  </div>

  <!-- éšå±¤è¿½åŠ /ç·¨é›†ãƒ¢ãƒ¼ãƒ€ãƒ« -->
  <div class="modal-overlay" id="nodeModal">
    <div class="modal">
      <div class="modal-header">
        <h2 id="nodeModalTitle">éšå±¤ã‚’è¿½åŠ </h2>
        <button class="btn btn-icon" id="btnCloseNodeModal">âœ•</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label for="nodeName">éšå±¤å</label>
          <input type="text" id="nodeName" placeholder="ä¾‹: 1éš">
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" id="btnCancelNode">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
        <button class="btn btn-primary" id="btnSaveNode">ä¿å­˜</button>
      </div>
    </div>
  </div>

  <!-- ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆãƒ¢ãƒ¼ãƒ€ãƒ« -->
  <div class="modal-overlay" id="exportModal">
    <div class="modal">
      <div class="modal-header">
        <h2>ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ</h2>
        <button class="btn btn-icon" id="btnCloseExportModal">âœ•</button>
      </div>
      <div class="modal-body">
        <div class="stats" id="exportStats"></div>
        <div class="photo-grid" id="photoGrid"></div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" id="btnCancelExport">é–‰ã˜ã‚‹</button>
        <button class="btn btn-primary" id="btnDownloadZip">ZIPãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</button>
      </div>
    </div>
  </div>

  <!-- è¨­å®šãƒ¢ãƒ¼ãƒ€ãƒ« -->
  <div class="modal-overlay" id="settingsModal">
    <div class="modal">
      <div class="modal-header">
        <h2>è¨­å®š</h2>
        <button class="btn btn-icon" id="btnCloseSettingsModal">âœ•</button>
      </div>
      <div class="modal-body">
        <!-- ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰ -->
        <div class="setting-item">
          <div>
            <div class="setting-label">ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰</div>
          </div>
          <label class="toggle">
            <input type="checkbox" id="darkModeToggle">
            <span class="toggle-slider"></span>
          </label>
        </div>

        <!-- ã‚¯ãƒ©ã‚¦ãƒ‰åŒæœŸ -->
        <h3 class="mt-16 mb-16">ã‚¯ãƒ©ã‚¦ãƒ‰åŒæœŸ</h3>
        <div class="setting-item">
          <div>
            <div class="setting-label">Google Drive</div>
            <div class="setting-desc" id="googleDriveStatus">æœªæ¥ç¶š</div>
          </div>
          <div style="display: flex; gap: 8px;">
            <button class="btn btn-primary" id="btnConnectGoogleDrive">æ¥ç¶š</button>
            <button class="btn btn-secondary hidden" id="btnDisconnectGoogleDrive">è§£é™¤</button>
            <button class="btn btn-secondary hidden" id="btnSyncNow">åŒæœŸ</button>
          </div>
        </div>
        <div class="setting-item hidden" id="syncQueueStatus">
          <div>
            <div class="setting-label">åŒæœŸã‚­ãƒ¥ãƒ¼</div>
            <div class="setting-desc" id="syncQueueCount">0ä»¶å¾…æ©Ÿä¸­</div>
          </div>
          <button class="btn btn-secondary" id="btnClearSyncQueue">ã‚¯ãƒªã‚¢</button>
        </div>
        <div class="setting-item">
          <div>
            <div class="setting-label">ãƒ‡ãƒã‚¤ã‚¹ã«ä¿å­˜</div>
            <div class="setting-desc">æ’®å½±æ™‚ã«Downloadsãƒ•ã‚©ãƒ«ãƒ€ã«ã‚‚ä¿å­˜</div>
          </div>
          <label class="toggle">
            <input type="checkbox" id="downloadToDeviceToggle" checked>
            <span class="toggle-slider"></span>
          </label>
        </div>

        <!-- ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆé€£ç•ªè¨­å®š -->
        <h3 class="mt-16 mb-16">ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆé€£ç•ªè¨­å®š</h3>
        <div class="form-row">
          <div class="form-group">
            <label for="defaultDigits">æ¡æ•°</label>
            <select id="defaultDigits">
              <option value="2">2æ¡</option>
              <option value="3" selected>3æ¡</option>
              <option value="4">4æ¡</option>
            </select>
          </div>
          <div class="form-group">
            <label for="defaultStartNum">é–‹å§‹ç•ªå·</label>
            <input type="number" id="defaultStartNum" value="1" min="0">
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label for="defaultPrefix">ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹</label>
            <input type="text" id="defaultPrefix" placeholder="ãªã—">
          </div>
          <div class="form-group">
            <label for="defaultSeparator">åŒºåˆ‡ã‚Šæ–‡å­—</label>
            <select id="defaultSeparator">
              <option value="-">-ï¼ˆãƒã‚¤ãƒ•ãƒ³ï¼‰</option>
              <option value="_">_ï¼ˆã‚¢ãƒ³ãƒ€ãƒ¼ã‚¹ã‚³ã‚¢ï¼‰</option>
              <option value="">ãªã—</option>
            </select>
          </div>
        </div>
        <div class="form-group">
          <label>
            <input type="checkbox" id="defaultZeroPad" checked> ã‚¼ãƒ­åŸ‹ã‚
          </label>
        </div>

        <!-- ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ -->
        <h3 class="mt-16 mb-16">ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ</h3>
        <div class="template-list" id="templateList"></div>
        <button class="btn btn-secondary mt-16" id="btnSaveTemplate" style="width: 100%;">
          ç¾åœ¨ã®éšå±¤ã‚’ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã¨ã—ã¦ä¿å­˜
        </button>

        <!-- å±é™ºæ“ä½œ -->
        <h3 class="mt-16 mb-16" style="color: var(--danger);">å±é™ºãªæ“ä½œ</h3>
        <button class="btn btn-secondary mb-16" id="btnUpdateApp" style="width: 100%;">
          ã‚¢ãƒ—ãƒªã‚’æ›´æ–°
        </button>
        <button class="btn btn-danger" id="btnResetData" style="width: 100%;">
          ãƒ‡ãƒ¼ã‚¿ã‚’ãƒªã‚»ãƒƒãƒˆ
        </button>
      </div>
      <div class="modal-footer">
        <button class="btn btn-primary" id="btnSaveSettings">ä¿å­˜</button>
      </div>
    </div>
  </div>

  <!-- JSZip -->
  <script src="lib/jszip.min.js"></script>

  <script>
    // ============================================
    // èª¿æŸ»ç¨®åˆ¥ãƒã‚¹ã‚¿ãƒ¼ãƒ‡ãƒ¼ã‚¿
    // ============================================
    const SURVEY_TYPES = {
      kenzen: {
        label: 'å¥å…¨åº¦èª¿æŸ»ç¥¨',
        master: {"parts":{"å¤–éƒ¨":["åŸºç¤ã€åœŸå£Œ","å¤–æ§‹","åºŠ","æ§‹é€ æ","å£ï½¥æŸ±","ãã®ä»–","å¤–å£","åº‡ã€è»’å¤©","æ¢","æŸ±","æ¢ï½¥æŸ±","è»’å¤©ï½¥æ¢","å¤–è£…ä»•ä¸Šã’æ","é‰„éª¨éƒ¨æ","å»ºå…·","çª“ã‚µãƒƒã‚·","åºã€è»’å¤©","æ’æ°´è¨­å‚™"],"å±‹æ ¹":["é˜²æ°´å±¤","å±‹æ ¹","è»’","ãã®ä»–","æ’æ°´è¨­å‚™"],"å†…éƒ¨":["å¤©äº•","å¤©äº•ï½¥æ¢","å£","åºŠ","ãã®ä»–","å»ºå…·","æ¢","æŸ±","æ¢ï½¥æŸ±","å£ï½¥æŸ±","æ¢ï½¥å£","çª“ã‚µãƒƒã‚·"],"è¨­å‚™":["ä¾¿å™¨ã€æ´—é¢å™¨ç­‰","çµ¦æ’æ°´","ãã®ä»–","ç…§æ˜å™¨å…·","é›»æ°—è¨­å‚™","æ¹¯æ²¸å™¨ã€ã‚³ãƒ³ãƒ­","æ›æ°—è¨­å‚™","ç©ºèª¿è¨­å‚™"]},"materials":[{"cat":"å¤–éƒ¨","parts":["åŸºç¤ã€åœŸå£Œ"],"val":"åœŸç ‚"},{"cat":"å¤–éƒ¨","parts":["åŸºç¤ã€åœŸå£Œ"],"val":"ç ‚åˆ©"},{"cat":"å¤–éƒ¨","parts":["åŸºç¤ã€åœŸå£Œ"],"val":"ï½±ï½½ï¾Œï½§ï¾™ï¾„"},{"cat":"å¤–éƒ¨","parts":["åŸºç¤ã€åœŸå£Œ","å¤–æ§‹"],"val":"ï½²ï¾ï¾€ï½°ï¾›ï½¯ï½·ï¾ï½¸ï¾"},{"cat":"å¤–éƒ¨","parts":["åŸºç¤ã€åœŸå£Œ","åºŠ","å¤–æ§‹","æ§‹é€ æ","å£ï½¥æŸ±","ãã®ä»–"],"val":"ï½ºï¾ï½¸ï¾˜ï½°ï¾„"},{"cat":"å¤–éƒ¨","parts":["åŸºç¤ã€åœŸå£Œ","å¤–å£","åº‡ã€è»’å¤©","æ¢","æŸ±","åºŠ","å¤–æ§‹","æ§‹é€ æ","å£ï½¥æŸ±","æ¢ï½¥æŸ±","è»’å¤©ï½¥æ¢","ãã®ä»–"],"val":"ï½ºï¾ï½¸ï¾˜ï½°ï¾„/å¡—è£…"},{"cat":"å¤–éƒ¨","parts":["åŸºç¤ã€åœŸå£Œ","å¤–å£","åº‡ã€è»’å¤©","æ¢","æŸ±","åºŠ","å¤–æ§‹","æ§‹é€ æ","å£ï½¥æŸ±","æ¢ï½¥æŸ±","è»’å¤©ï½¥æ¢","ãã®ä»–"],"val":"ï½ºï¾ï½¸ï¾˜ï½°ï¾„/ï¾“ï¾™ï¾€ï¾™"},{"cat":"å¤–éƒ¨","parts":["å¤–å£"],"val":"ALCï¾Šï¾Ÿï¾ˆï¾™"},{"cat":"å¤–éƒ¨","parts":["å¤–å£"],"val":"æ¼†å–°"},{"cat":"å¤–éƒ¨","parts":["å¤–å£"],"val":"å¹ä»˜ï¾€ï½²ï¾™"},{"cat":"å¤–éƒ¨","parts":["å¤–å£","ãã®ä»–"],"val":"ï½½ï¾šï½°ï¾„"},{"cat":"å¤–éƒ¨","parts":["å¤–å£","å¤–æ§‹"],"val":"ï¾šï¾ï½¶ï¾"},{"cat":"å¤–éƒ¨","parts":["å¤–å£","åº‡ã€è»’å¤©"],"val":"ï½¾ï¾’ï¾ï¾„æ¿/å¡—è£…"},{"cat":"å¤–éƒ¨","parts":["å¤–å£","åº‡ã€è»’å¤©","ãã®ä»–"],"val":"æœ¨æ¿"},{"cat":"å¤–éƒ¨","parts":["å¤–å£","åº‡ã€è»’å¤©","ãã®ä»–"],"val":"æœ¨æ¿/å¡—è£…"},{"cat":"å¤–éƒ¨","parts":["å¤–å£","åº‡ã€è»’å¤©","ãã®ä»–"],"val":"é‡‘å±ï¾Šï¾Ÿï¾ˆï¾™"},{"cat":"å¤–éƒ¨","parts":["å¤–å£","åºŠ","å¤–æ§‹"],"val":"çŸ³æ/ï¾“ï¾™ï¾€ï¾™"},{"cat":"å¤–éƒ¨","parts":["å¤–å£","åºŠ","å¤–æ§‹"],"val":"ï½ºï¾ï½¸ï¾˜ï½°ï¾„æ´—ã„å‡ºã—ä»•ä¸Šã’"},{"cat":"å¤–éƒ¨","parts":["å¤–å£","åº‡ã€è»’å¤©","å£ï½¥æŸ±","è»’å¤©ï½¥æ¢"],"val":"ï¾˜ï½¼ï¾å¹ä»˜"},{"cat":"å¤–éƒ¨","parts":["å¤–å£","åº‡ã€è»’å¤©","æŸ±","ãã®ä»–"],"val":"æœ¨æ/å¡—è£…"},{"cat":"å¤–éƒ¨","parts":["å¤–å£","å¤–è£…ä»•ä¸Šã’æ","åº‡ã€è»’å¤©","åºŠ","å¤–æ§‹"],"val":"ï¾€ï½²ï¾™"},{"cat":"å¤–éƒ¨","parts":["å¤–å£","åº‡ã€è»’å¤©","å£ï½¥æŸ±","è»’å¤©ï½¥æ¢","ãã®ä»–"],"val":"ï¾“ï¾™ï¾€ï¾™/å¡—è£…"},{"cat":"å¤–éƒ¨","parts":["å¤–å£","åº‡ã€è»’å¤©","å¤–æ§‹","é‰„éª¨éƒ¨æ","ãã®ä»–"],"val":"é‹¼æ¿"},{"cat":"å¤–éƒ¨","parts":["å¤–å£","åº‡ã€è»’å¤©","å¤–æ§‹","é‰„éª¨éƒ¨æ","ãã®ä»–"],"val":"é‹¼æ¿/å¡—è£…"},{"cat":"å¤–éƒ¨","parts":["å¤–å£","åº‡ã€è»’å¤©","åºŠ","å¤–æ§‹","ãã®ä»–"],"val":"çŸ³æ"},{"cat":"å¤–éƒ¨","parts":["å¤–å£","åº‡ã€è»’å¤©","åºŠ","å¤–æ§‹","ãã®ä»–"],"val":"ï½³ï¾šï¾€ï¾å¡—è†œé˜²æ°´"},{"cat":"å¤–éƒ¨","parts":["å¤–å£","åº‡ã€è»’å¤©","åºŠ","å¤–æ§‹","ãã®ä»–"],"val":"FRPæ¨¹è„‚"},{"cat":"å¤–éƒ¨","parts":["å¤–å£","åº‡ã€è»’å¤©","å»ºå…·","å¤–æ§‹","é‰„éª¨éƒ¨æ","ãã®ä»–"],"val":"é‡‘å±éƒ¨æ"},{"cat":"å¤–éƒ¨","parts":["å¤–å£","åº‡ã€è»’å¤©","å»ºå…·","çª“ã‚µãƒƒã‚·","å¤–æ§‹","ãã®ä»–"],"val":"ï½±ï¾™ï¾"},{"cat":"å¤–éƒ¨","parts":["å¤–å£","åº‡ã€è»’å¤©","æ¢","æŸ±","åºŠ","å¤–æ§‹","ãã®ä»–"],"val":"ï½ºï¾ï½¸ï¾˜ï½°ï¾„ï¾Œï¾ï¾›ï½¯ï½¸"},{"cat":"å¤–éƒ¨","parts":["å¤–å£","åº‡ã€è»’å¤©","æ¢","æŸ±","åºŠ","å¤–æ§‹","ãã®ä»–"],"val":"ï½»ï½²ï¾ƒï¾ï½¨ï¾ï½¸ï¾"},{"cat":"å¤–éƒ¨","parts":["å¤–å£","åº‡ã€è»’å¤©","æ¢","æŸ±","åºŠ","å¤–æ§‹","ãã®ä»–"],"val":"ï½¼ï½°ï¾˜ï¾ï½¸ï¾"},{"cat":"å¤–éƒ¨","parts":["å¤–å£","åº‡ã€è»’å¤©","æ¢","æŸ±","æ§‹é€ æ","å£ï½¥æŸ±","æ¢ï½¥æŸ±","è»’å¤©ï½¥æ¢"],"val":"ï½ºï¾ï½¸ï¾˜ï½°ï¾„æ‰“ã¡æ”¾ã—"},{"cat":"å¤–éƒ¨","parts":["å¤–å£","åº‡ã€è»’å¤©","æ¢","æŸ±","åºŠ","å¤–æ§‹","å£ï½¥æŸ±","æ¢ï½¥æŸ±","è»’å¤©ï½¥æ¢","ãã®ä»–"],"val":"ï½±ï¾™ï¾ï¾Šï¾Ÿï¾ˆï¾™"},{"cat":"å¤–éƒ¨","parts":["å¤–å£","åºã€è»’å¤©","æ¢","æŸ±","åºŠ","å¤–æ§‹","å£ï½¥æŸ±","æ¢ï½¥æŸ±","è»’å¤©ï½¥æ¢","ãã®ä»–"],"val":"ï¾“ï¾™ï¾€ï¾™"},{"cat":"å¤–éƒ¨","parts":["å¤–å£","åº‡ã€è»’å¤©","æ¢","æŸ±","åºŠ","å¤–æ§‹","æ§‹é€ æ","å£ï½¥æŸ±","æ¢ï½¥æŸ±","è»’å¤©ï½¥æ¢","ãã®ä»–"],"val":"ï½ºï¾ï½¸ï¾˜ï½°ï¾„/ï¾€ï½²ï¾™"},{"cat":"å¤–éƒ¨","parts":["å¤–å£","åº‡ã€è»’å¤©","æ¢","æŸ±","åºŠ","å¤–æ§‹","æ§‹é€ æ","å£ï½¥æŸ±","æ¢ï½¥æŸ±","è»’å¤©ï½¥æ¢","ãã®ä»–"],"val":"æœ¨æ"},{"cat":"å¤–éƒ¨","parts":["åº‡ã€è»’å¤©","ãã®ä»–"],"val":"ï¾ï¾Ÿï¾˜ï½¶æ³¢æ¿"},{"cat":"å¤–éƒ¨","parts":["å»ºå…·","çª“ã‚µãƒƒã‚·"],"val":"æœ¨æ/ï½¶ï¾ï¾—ï½½"},{"cat":"å¤–éƒ¨","parts":["å»ºå…·","çª“ã‚µãƒƒã‚·"],"val":"ï½½ï¾ƒï¾ï¾šï½½/ï½¶ï¾ï¾—ï½½"},{"cat":"å¤–éƒ¨","parts":["å»ºå…·","æ’æ°´è¨­å‚™","å¤–æ§‹","ãã®ä»–"],"val":"é‹¼è£½"},{"cat":"å¤–éƒ¨","parts":["å»ºå…·","å¤–æ§‹","ãã®ä»–"],"val":"ï½½ï¾ƒï¾ï¾šï½½"},{"cat":"å¤–éƒ¨","parts":["å»ºå…·","çª“ã‚µãƒƒã‚·","å¤–æ§‹","ãã®ä»–"],"val":"æœ¨è£½"},{"cat":"å¤–éƒ¨","parts":["çª“ã‚µãƒƒã‚·"],"val":"ï½±ï¾™ï¾/ï½¶ï¾ï¾—ï½½"},{"cat":"å¤–éƒ¨","parts":["çª“ã‚µãƒƒã‚·","å¤–æ§‹","ãã®ä»–"],"val":"ï½¶ï¾ï¾—ï½½"},{"cat":"å¤–éƒ¨","parts":["åºŠ","å¤–æ§‹"],"val":"é˜²æ»‘æ€§ï¾‹ï¾ï¾†ï¾™åºŠï½¼ï½°ï¾„"},{"cat":"å¤–éƒ¨","parts":["åºŠ","å¤–æ§‹","ãã®ä»–"],"val":"äººå·¥æœ¨æ"},{"cat":"å¤–éƒ¨","parts":["æ’æ°´è¨­å‚™","å¤–æ§‹","ãã®ä»–"],"val":"å¡©ï¾‹ï¾"},{"cat":"å±‹æ ¹","parts":["é˜²æ°´å±¤"],"val":"FRPæ¨¹è„‚"},{"cat":"å±‹æ ¹","parts":["é˜²æ°´å±¤"],"val":"ï½±ï½½ï¾Œï½§ï¾™ï¾„é˜²æ°´"},{"cat":"å±‹æ ¹","parts":["é˜²æ°´å±¤"],"val":"ï½³ï¾šï¾€ï¾å¡—è†œé˜²æ°´"},{"cat":"å±‹æ ¹","parts":["é˜²æ°´å±¤"],"val":"ï½¼ï½°ï¾„é˜²æ°´"},{"cat":"å±‹æ ¹","parts":["é˜²æ°´å±¤"],"val":"æŠ¼ã•ãˆï½ºï¾ï½¸ï¾˜ï½°ï¾„"},{"cat":"å±‹æ ¹","parts":["é˜²æ°´å±¤"],"val":"é˜²æ»‘æ€§ï¾‹ï¾ï¾†ï¾™åºŠï½¼ï½°ï¾„"},{"cat":"å±‹æ ¹","parts":["å±‹æ ¹","è»’","ãã®ä»–"],"val":"ï½±ï½½ï¾Œï½§ï¾™ï¾„ï½¼ï¾ï½¸ï¾ï¾™"},{"cat":"å±‹æ ¹","parts":["å±‹æ ¹","è»’","ãã®ä»–"],"val":"ç“¦"},{"cat":"å±‹æ ¹","parts":["å±‹æ ¹","é˜²æ°´å±¤"],"val":"ï½ºï¾ï½¸ï¾˜ï½°ï¾„/å¡—è†œ"},{"cat":"å±‹æ ¹","parts":["å±‹æ ¹","ãã®ä»–"],"val":"ï½±ï¾™ï¾/ï½¶ï¾ï¾—ï½½"},{"cat":"å±‹æ ¹","parts":["å±‹æ ¹","ãã®ä»–"],"val":"ï½ºï¾ï½¸ï¾˜ï½°ï¾„/é‡‘å±ç¬ æœ¨"},{"cat":"å±‹æ ¹","parts":["å±‹æ ¹","ãã®ä»–"],"val":"ï¾Šï¾Ÿï¾ˆï¾™"},{"cat":"å±‹æ ¹","parts":["å±‹æ ¹","ãã®ä»–"],"val":"ï¾ï¾Ÿï¾˜ï½¶"},{"cat":"å±‹æ ¹","parts":["å±‹æ ¹","ãã®ä»–"],"val":"ï¾ï¾Ÿï¾˜ï½¶æ³¢æ¿"},{"cat":"å±‹æ ¹","parts":["è»’"],"val":"ï½±ï¾™ï¾ï½½ï¾Šï¾Ÿï¾ï¾„ï¾ï¾šï¾™"},{"cat":"å±‹æ ¹","parts":["å±‹æ ¹","è»’"],"val":"æœ¨æ¿/å¡—è£…"},{"cat":"å±‹æ ¹","parts":["å±‹æ ¹","è»’","ãã®ä»–"],"val":"ï½½ï¾šï½°ï¾„æ³¢æ¿"},{"cat":"å±‹æ ¹","parts":["é˜²æ°´å±¤","å±‹æ ¹","ãã®ä»–"],"val":"ä¿è­·ç ‚åˆ©"},{"cat":"å±‹æ ¹","parts":["å±‹æ ¹","è»’","ãã®ä»–"],"val":"ï½ºï¾ï½¸ï¾˜ï½°ï¾„/ï¾“ï¾™ï¾€ï¾™"},{"cat":"å±‹æ ¹","parts":["å±‹æ ¹","è»’","ãã®ä»–"],"val":"ï½ºï¾ï½¸ï¾˜ï½°ï¾„/å¡—è£…"},{"cat":"å±‹æ ¹","parts":["å±‹æ ¹","è»’","ãã®ä»–"],"val":"ï½¼ï½°ï¾˜ï¾ï½¸ï¾"},{"cat":"å±‹æ ¹","parts":["å±‹æ ¹","è»’","ãã®ä»–"],"val":"ï¾“ï¾™ï¾€ï¾™/å¡—è£…"},{"cat":"å±‹æ ¹","parts":["å±‹æ ¹","é˜²æ°´å±¤","è»’","ãã®ä»–"],"val":"é‡‘å±æŠ˜æ¿"},{"cat":"å±‹æ ¹","parts":["å±‹æ ¹","è»’","ãã®ä»–"],"val":"é‡‘å±æ¿"},{"cat":"å±‹æ ¹","parts":["å±‹æ ¹","è»’","ãã®ä»–"],"val":"é‹¼æ¿/å¡—è£…"},{"cat":"å±‹æ ¹","parts":["å±‹æ ¹","è»’","ãã®ä»–"],"val":"é‰„éª¨"},{"cat":"å±‹æ ¹","parts":["å±‹æ ¹","æ’æ°´è¨­å‚™","ãã®ä»–"],"val":"é‹¼è£½"},{"cat":"å±‹æ ¹","parts":["è»’","ãã®ä»–"],"val":"ï½¹ï½²ï½¶ï¾™æ¿"},{"cat":"å±‹æ ¹","parts":["è»’","ãã®ä»–"],"val":"ï½¹ï½²ï½¶ï¾™æ¿/å¡—è£…"},{"cat":"å±‹æ ¹","parts":["æ’æ°´è¨­å‚™","ãã®ä»–"],"val":"å¡©ï¾‹ï¾"},{"cat":"å±‹æ ¹","parts":["æ’æ°´è¨­å‚™","ãã®ä»–"],"val":"æ¨¹è„‚"},{"cat":"å±‹æ ¹","parts":["ãã®ä»–"],"val":"ï½±ï½¸ï¾˜ï¾™/ï½½ï¾ƒï¾ï¾šï½½"},{"cat":"å±‹æ ¹","parts":["ãã®ä»–"],"val":"é‹¼è£½æ /ï½¶ï¾ï¾—ï½½"},{"cat":"å±‹æ ¹","parts":["å±‹æ ¹","è»’","æ’æ°´è¨­å‚™","ãã®ä»–"],"val":"ï½½ï¾ƒï¾ï¾šï½½"},{"cat":"å±‹æ ¹","parts":["å±‹æ ¹","è»’","æ’æ°´è¨­å‚™","ãã®ä»–"],"val":"éŠ…æ¿"},{"cat":"å±‹æ ¹","parts":["å±‹æ ¹","è»’","ãã®ä»–"],"val":"ï½±ï¾™ï¾"},{"cat":"å±‹æ ¹","parts":["å±‹æ ¹","è»’","ãã®ä»–"],"val":"ï¾“ï¾™ï¾€ï¾™"},{"cat":"å±‹æ ¹","parts":["å±‹æ ¹","è»’","ãã®ä»–"],"val":"æœ¨æ"},{"cat":"å±‹æ ¹","parts":["å±‹æ ¹","è»’","é˜²æ°´å±¤","ãã®ä»–"],"val":"ï½ºï¾ï½¸ï¾˜ï½°ï¾„"},{"cat":"å±‹æ ¹","parts":["å±‹æ ¹","é˜²æ°´å±¤","ãã®ä»–"],"val":"ï¾€ï½²ï¾™"},{"cat":"å†…éƒ¨","parts":["å¤©äº•","å¤©äº•ï½¥æ¢"],"val":"çŸ³è†ï¾ï¾ï½°ï¾„ï¾(ï½¼ï¾ï¾Œï¾Ÿï¾„ï½°ï¾)"},{"cat":"å†…éƒ¨","parts":["å¤©äº•","å¤©äº•ï½¥æ¢"],"val":"çŸ³è†ï¾ï¾ï½°ï¾„ï¾(ï½¿ï½°ï¾—ï¾„ï¾)"},{"cat":"å†…éƒ¨","parts":["å¤©äº•","å£","åºŠ"],"val":"ï¾“ï¾™ï¾€ï¾™"},{"cat":"å†…éƒ¨","parts":["å¤©äº•","å£","å¤©äº•ï½¥æ¢"],"val":"ï½¾ï¾’ï¾ï¾„æ¿"},{"cat":"å†…éƒ¨","parts":["å¤©äº•","å£","å¤©äº•ï½¥æ¢"],"val":"ï½¾ï¾’ï¾ï¾„æ¿/å¡—è£…"},{"cat":"å†…éƒ¨","parts":["å¤©äº•","å£","å¤©äº•ï½¥æ¢"],"val":"ï½¹ï½²ï½¶ï¾™æ¿"},{"cat":"å†…éƒ¨","parts":["å¤©äº•","å£","å¤©äº•ï½¥æ¢"],"val":"ï½¹ï½²ï½¶ï¾™æ¿/å¡—è£…"},{"cat":"å†…éƒ¨","parts":["å¤©äº•","å£","å¤©äº•ï½¥æ¢"],"val":"é‡‘å±ï¾Šï¾Ÿï¾ˆï¾™/å¡—è£…"},{"cat":"å†…éƒ¨","parts":["å¤©äº•","å£","å¤©äº•ï½¥æ¢"],"val":"ï½¸ï¾›ï½½"},{"cat":"å†…éƒ¨","parts":["å¤©äº•","å£","å¤©äº•ï½¥æ¢"],"val":"åŒ–ç²§ï¾Œï½¨ï¾™ï¾‘è²¼ã‚Š"},{"cat":"å†…éƒ¨","parts":["å¤©äº•","å£","ãã®ä»–"],"val":"åŒ–ç²§ï¾Šï¾Ÿï¾ˆï¾™"},{"cat":"å†…éƒ¨","parts":["å¤©äº•","å£","å»ºå…·","ãã®ä»–"],"val":"åŒ–ç²§æ¿/ï½¶ï¾ï¾—ï½½"},{"cat":"å†…éƒ¨","parts":["å¤©äº•","å£","å»ºå…·","ãã®ä»–"],"val":"åŒ–ç²§æ¿/ï½±ï¾™ï¾"},{"cat":"å†…éƒ¨","parts":["å¤©äº•","å£","å»ºå…·","ãã®ä»–"],"val":"åŒ–ç²§æ¿"},{"cat":"å†…éƒ¨","parts":["å¤©äº•","å£","å¤©äº•ï½¥æ¢"],"val":"çŸ³è†ï¾ï¾ï½°ï¾„ï¾/ï½¸ï¾›ï½½"},{"cat":"å†…éƒ¨","parts":["å¤©äº•","å£","å¤©äº•ï½¥æ¢"],"val":"ï½ºï¾ï½¸ï¾˜ï½°ï¾„/ï½¸ï¾›ï½½"},{"cat":"å†…éƒ¨","parts":["å¤©äº•","å£","å¤©äº•ï½¥æ¢"],"val":"æ¼†å–°"},{"cat":"å†…éƒ¨","parts":["å¤©äº•","å£","å¤©äº•ï½¥æ¢"],"val":"çŸ³è†ï¾ï¾ï½°ï¾„ï¾/å¡—è£…"},{"cat":"å†…éƒ¨","parts":["å¤©äº•","å£","å¤©äº•ï½¥æ¢"],"val":"å¸éŸ³ï¾ï¾ï½°ï¾„ï¾"},{"cat":"å†…éƒ¨","parts":["å¤©äº•","å£","å¤©äº•ï½¥æ¢"],"val":"æœ¨æ¯›ï½¾ï¾’ï¾ï¾„æ¿"},{"cat":"å†…éƒ¨","parts":["å¤©äº•","å£","åºŠ"],"val":"ï¾“ï¾™ï¾€ï¾™/å¡—è£…"},{"cat":"å†…éƒ¨","parts":["å¤©äº•","å£","åºŠ"],"val":"æœ¨æ¿/å¡—è£…"},{"cat":"å†…éƒ¨","parts":["å¤©äº•","å£","åºŠ","æ¢","æŸ±","æ¢ï½¥æŸ±","å£ï½¥æŸ±","å¤©äº•ï½¥æ¢","æ¢ï½¥å£"],"val":"ï½ºï¾ï½¸ï¾˜ï½°ï¾„/ï¾“ï¾™ï¾€ï¾™"},{"cat":"å†…éƒ¨","parts":["å¤©äº•","å£","åºŠ","æ¢","æŸ±","æ¢ï½¥æŸ±","å£ï½¥æŸ±","å¤©äº•ï½¥æ¢","æ¢ï½¥å£"],"val":"ï½ºï¾ï½¸ï¾˜ï½°ï¾„/å¡—è£…"},{"cat":"å†…éƒ¨","parts":["å¤©äº•","å£","æ¢","æŸ±","æ¢ï½¥æŸ±","å£ï½¥æŸ±","å¤©äº•ï½¥æ¢","æ¢ï½¥å£"],"val":"ï½ºï¾ï½¸ï¾˜ï½°ï¾„æ‰“ã¡æ”¾ã—"},{"cat":"å†…éƒ¨","parts":["æ¢","æŸ±","ãã®ä»–","æ¢ï½¥æŸ±","å£ï½¥æŸ±","å¤©äº•ï½¥æ¢","æ¢ï½¥å£"],"val":"æœ¨æ/å¡—è£…"},{"cat":"å†…éƒ¨","parts":["å¤©äº•","å£","ãã®ä»–","æ¢ï½¥æŸ±","å£ï½¥æŸ±","å¤©äº•ï½¥æ¢","æ¢ï½¥å£"],"val":"æœ¨æ¿/å¡—è£…"},{"cat":"å†…éƒ¨","parts":["å¤©äº•","å£","ãã®ä»–","æ¢ï½¥æŸ±","å£ï½¥æŸ±","å¤©äº•ï½¥æ¢","æ¢ï½¥å£"],"val":"æœ¨åˆæ¿/å¡—è£…"},{"cat":"å†…éƒ¨","parts":["å¤©äº•"],"val":"ï½±ï¾™ï¾"},{"cat":"å†…éƒ¨","parts":["å¤©äº•"],"val":"æ¨¹è„‚ï¾Šï¾Ÿï¾ˆï¾™"},{"cat":"å†…éƒ¨","parts":["å¤©äº•"],"val":"ï½±ï¾™ï¾ï½½ï¾Šï¾Ÿï¾ï¾„ï¾ï¾šï¾™"},{"cat":"å†…éƒ¨","parts":["å£"],"val":"çªè—»åœŸ"},{"cat":"å†…éƒ¨","parts":["å¤©äº•","å£","å»ºå…·"],"val":"æœ¨åˆæ¿/å¡—è£…"},{"cat":"å†…éƒ¨","parts":["å¤©äº•","å£"],"val":"èšæ¥½èª¿å¡—æ"},{"cat":"å†…éƒ¨","parts":["å£","ãã®ä»–"],"val":"é‹¼æ¿"},{"cat":"å†…éƒ¨","parts":["å¤©äº•","å£"],"val":"æœ‰å­”æœ¨è³ªï¾ï¾ï½°ï¾„ï¾"},{"cat":"å†…éƒ¨","parts":["å¤©äº•","æ¢","æŸ±","å£","æ¢ï½¥æŸ±","å£ï½¥æŸ±","å¤©äº•ï½¥æ¢","æ¢ï½¥å£"],"val":"ï½¸ï¾ï¾—ï½½ï½³ï½°ï¾™ï¾ï¾ï½°ï¾„ï¾"},{"cat":"å†…éƒ¨","parts":["å¤©äº•","æ¢","æŸ±","å£","æ¢ï½¥æŸ±","å£ï½¥æŸ±","å¤©äº•ï½¥æ¢","æ¢ï½¥å£"],"val":"ï¾›ï½¯ï½¸ï½³ï½°ï¾™å¹ä»˜"},{"cat":"å†…éƒ¨","parts":["å£","åºŠ"],"val":"ï¾€ï½²ï¾™"},{"cat":"å†…éƒ¨","parts":["åºŠ"],"val":"ï¾‹ï¾ï¾†ï¾™åºŠï½¼ï½°ï¾„"},{"cat":"å†…éƒ¨","parts":["åºŠ"],"val":"ï¾‹ï¾ï¾†ï¾™åºŠï¾€ï½²ï¾™"},{"cat":"å†…éƒ¨","parts":["åºŠ"],"val":"ï½¸ï½¯ï½¼ï½®ï¾ï¾Œï¾›ï½±"},{"cat":"å†…éƒ¨","parts":["å£","åºŠ","ãã®ä»–"],"val":"çŸ³æ"},{"cat":"å†…éƒ¨","parts":["å»ºå…·","çª“ã‚µãƒƒã‚·","ãã®ä»–"],"val":"ï½½ï¾ƒï¾ï¾šï½½/ï½¶ï¾ï¾—ï½½"},{"cat":"å†…éƒ¨","parts":["å£","åºŠ","ãã®ä»–"],"val":"ï½¼ï½°ï¾˜ï¾ï½¸ï¾"},{"cat":"å†…éƒ¨","parts":["å£","æŸ±","åºŠ","ãã®ä»–","å£ï½¥æŸ±"],"val":"ï½½ï¾ƒï¾ï¾šï½½"},{"cat":"å†…éƒ¨","parts":["å£","ãã®ä»–"],"val":"å¡©ï¾‹ï¾"},{"cat":"å†…éƒ¨","parts":["å£","åºŠ","ãã®ä»–"],"val":"äººå·¥å¤§ç†çŸ³"},{"cat":"å†…éƒ¨","parts":["å£","åºŠ","ãã®ä»–"],"val":"äººé€ å¤§ç†çŸ³"},{"cat":"å†…éƒ¨","parts":["å£","åºŠ","æ¢","æŸ±","æ¢ï½¥æŸ±","å£ï½¥æŸ±","æ¢ï½¥å£"],"val":"è»½é‡ï½ºï¾ï½¸ï¾˜ï½°ï¾„"},{"cat":"å†…éƒ¨","parts":["å£","ãã®ä»–"],"val":"ï½ºï¾ï½¸ï¾˜ï½°ï¾„ï¾Œï¾ï¾›ï½¯ï½¸"},{"cat":"å†…éƒ¨","parts":["åºŠ"],"val":"ï¾€ï½²ï¾™ï½¶ï½°ï¾ï¾Ÿï½¯ï¾„"},{"cat":"å†…éƒ¨","parts":["åºŠ"],"val":"ç„¡å¢ï¾Œï¾›ï½°ï¾˜ï¾ï½¸ï¾"},{"cat":"å†…éƒ¨","parts":["åºŠ"],"val":"ç¸ç”²æ¿"},{"cat":"å†…éƒ¨","parts":["åºŠ"],"val":"ç•³"},{"cat":"å†…éƒ¨","parts":["åºŠ"],"val":"æ¨¹è„‚ç³»å¡—åºŠ"},{"cat":"å†…éƒ¨","parts":["åºŠ"],"val":"è¤‡åˆï¾Œï¾›ï½°ï¾˜ï¾ï½¸ï¾"},{"cat":"å†…éƒ¨","parts":["å»ºå…·"],"val":"è¥–"},{"cat":"å†…éƒ¨","parts":["å»ºå…·"],"val":"é‹¼è£½"},{"cat":"å†…éƒ¨","parts":["å»ºå…·"],"val":"éšœå­"},{"cat":"å†…éƒ¨","parts":["å»ºå…·","çª“ã‚µãƒƒã‚·"],"val":"æœ¨æ /æœ¨åˆæ¿"},{"cat":"å†…éƒ¨","parts":["å»ºå…·","çª“ã‚µãƒƒã‚·","ãã®ä»–"],"val":"ï½±ï¾™ï¾"},{"cat":"å†…éƒ¨","parts":["å»ºå…·","çª“ã‚µãƒƒã‚·"],"val":"é‹¼è£½/ï½¶ï¾ï¾—ï½½"},{"cat":"å†…éƒ¨","parts":["å»ºå…·","çª“ã‚µãƒƒã‚·"],"val":"æœ¨æ /ï½±ï½¸ï¾˜ï¾™"},{"cat":"å†…éƒ¨","parts":["å»ºå…·","çª“ã‚µãƒƒã‚·","ãã®ä»–"],"val":"æ¨¹è„‚"},{"cat":"å†…éƒ¨","parts":["å»ºå…·","ãã®ä»–"],"val":"æœ¨è£½"},{"cat":"å†…éƒ¨","parts":["å»ºå…·","çª“ã‚µãƒƒã‚·","ãã®ä»–"],"val":"ï½±ï¾™ï¾/ï½¶ï¾ï¾—ï½½"},{"cat":"å†…éƒ¨","parts":["å»ºå…·","çª“ã‚µãƒƒã‚·","ãã®ä»–"],"val":"é‹¼è£½æ /ï½¶ï¾ï¾—ï½½"},{"cat":"å†…éƒ¨","parts":["ãã®ä»–"],"val":"ï½¶ï¾ï¾—ï½½é¡"},{"cat":"å†…éƒ¨","parts":["ãã®ä»–"],"val":"ï¾ï¾Ÿï¾˜ï½¶"},{"cat":"å†…éƒ¨","parts":["æ¢","æŸ±","ãã®ä»–","æ¢ï½¥æŸ±","å¤©äº•ï½¥æ¢"],"val":"é‰„éª¨"},{"cat":"å†…éƒ¨","parts":["æ¢","æŸ±","ãã®ä»–","æ¢ï½¥æŸ±","å¤©äº•ï½¥æ¢"],"val":"é‰„éª¨/å¡—è£…"},{"cat":"å†…éƒ¨","parts":["åºŠ"],"val":"é˜²æ»‘æ€§ï¾‹ï¾ï¾†ï¾™åºŠï½¼ï½°ï¾„"},{"cat":"å†…éƒ¨","parts":["åºŠ"],"val":"Pï¾€ï½²ï¾™"},{"cat":"å†…éƒ¨","parts":["å»ºå…·","ãã®ä»–"],"val":"ç¹Šç¶­è£½"},{"cat":"è¨­å‚™","parts":["ä¾¿å™¨ã€æ´—é¢å™¨ç­‰"],"val":"é™¶å™¨"},{"cat":"è¨­å‚™","parts":["çµ¦æ’æ°´","ä¾¿å™¨ã€æ´—é¢å™¨ç­‰","ãã®ä»–"],"val":"ï½½ï¾ƒï¾ï¾šï½½"},{"cat":"è¨­å‚™","parts":["ä¾¿å™¨ã€æ´—é¢å™¨ç­‰"],"val":"ï½¶ï¾ï¾—ï½½é¡"},{"cat":"è¨­å‚™","parts":["çµ¦æ’æ°´"],"val":"å¡©ï¾‹ï¾"},{"cat":"è¨­å‚™","parts":["ä¾¿å™¨ã€æ´—é¢å™¨ç­‰","çµ¦æ’æ°´","ãã®ä»–"],"val":"æ¨¹è„‚/é‹¼è£½"},{"cat":"è¨­å‚™","parts":["ä¾¿å™¨ã€æ´—é¢å™¨ç­‰","çµ¦æ’æ°´","ãã®ä»–"],"val":"é‹¼è£½"},{"cat":"è¨­å‚™","parts":["ç…§æ˜å™¨å…·","é›»æ°—è¨­å‚™","ä¾¿å™¨ã€æ´—é¢å™¨ç­‰","çµ¦æ’æ°´","æ¹¯æ²¸å™¨ã€ã‚³ãƒ³ãƒ­","æ›æ°—è¨­å‚™","ç©ºèª¿è¨­å‚™","ãã®ä»–"],"val":"-"}],"notes":[{"cat":"å¤–éƒ¨","parts":["åŸºç¤ã€åœŸå£Œ","å¤–æ§‹"],"val":"åœ°ç›¤æ²ˆä¸‹"},{"cat":"å¤–éƒ¨","parts":["åŸºç¤ã€åœŸå£Œ"],"val":"åŸºç¤å·¾æœ¨çˆ†è£‚"},{"cat":"å¤–éƒ¨","parts":["åŸºç¤ã€åœŸå£Œ"],"val":"åŸºç¤å·¾æœ¨ï¾“ï¾™ï¾€ï¾™ã²ã³å‰²ã‚Œ"},{"cat":"å¤–éƒ¨","parts":["åŸºç¤ã€åœŸå£Œ"],"val":"åŸºç¤å·¾æœ¨ï¾“ï¾™ï¾€ï¾™æ¬ æ"},{"cat":"å¤–éƒ¨","parts":["åŸºç¤ã€åœŸå£Œ"],"val":"åŸºç¤å·¾æœ¨å¡—è†œå‰¥ãŒã‚Œ"},{"cat":"å¤–éƒ¨","parts":["åŸºç¤ã€åœŸå£Œ"],"val":"åŸºç¤ï¾“ï¾™ï¾€ï¾™æµ®ã"},{"cat":"å¤–éƒ¨","parts":["åŸºç¤ã€åœŸå£Œ"],"val":"çŠ¬èµ°ã‚Šã²ã³å‰²ã‚Œ"},{"cat":"å¤–éƒ¨","parts":["å¤–å£"],"val":"ALCï¾Šï¾Ÿï¾ˆï¾™æ¬ æ"},{"cat":"å¤–éƒ¨","parts":["å¤–å£","åº‡ã€è»’å¤©","æ¢","æŸ±"],"val":"å‹æ ç›®åœ°è£œä¿®éƒ¨å‘¨è¾ºã®ç™½è¯"},{"cat":"å¤–éƒ¨","parts":["å¤–å£","åº‡ã€è»’å¤©","æ¢","æŸ±"],"val":"å‹æ ç›®åœ°éƒ¨å‘¨è¾ºã®ç™½è¯"},{"cat":"å¤–éƒ¨","parts":["å¤–å£","åº‡ã€è»’å¤©","æ¢","æŸ±","åºŠ","å¤–æ§‹","ãã®ä»–"],"val":"å¡—è†œå‰¥ãŒã‚Œ"},{"cat":"å¤–éƒ¨","parts":["å¤–å£","åº‡ã€è»’å¤©","æ¢","æŸ±","åºŠ","å¤–æ§‹","ãã®ä»–"],"val":"å¡—è†œåŠ£åŒ–"},{"cat":"å¤–éƒ¨","parts":["å¤–å£","åº‡ã€è»’å¤©","æ¢","æŸ±","åºŠ","å¤–æ§‹","ãã®ä»–"],"val":"å¡—è†œåŠ£åŒ–ï½¥æ±šã‚Œ"},{"cat":"å¤–éƒ¨","parts":["å¤–å£","åº‡ã€è»’å¤©","æ¢","æŸ±","åºŠ","å¤–æ§‹","ãã®ä»–"],"val":"å¡—è†œæµ®ã"},{"cat":"å¤–éƒ¨","parts":["å¤–å£","åº‡ã€è»’å¤©","å»ºå…·","å¤–æ§‹","æ§‹é€ æ","ãã®ä»–"],"val":"æœ¨éƒ¨çµŒå¹´åŠ£åŒ–"},{"cat":"å¤–éƒ¨","parts":["å¤–å£","çª“ã‚µãƒƒã‚·","ãã®ä»–"],"val":"æ°´åˆ‡é‡‘ç‰©å¤‰å½¢"},{"cat":"å¤–éƒ¨","parts":["å¤–å£"],"val":"æ¼†å–°ã²ã³å‰²ã‚Œ"},{"cat":"å¤–éƒ¨","parts":["å¤–å£"],"val":"æ¼†å–°ã²ã³å‰²ã‚Œï½¥æ¬ æ"},{"cat":"å¤–éƒ¨","parts":["å¤–å£","åº‡ã€è»’å¤©","ãã®ä»–"],"val":"æ¼†å–°çµŒå¹´åŠ£åŒ–"},{"cat":"å¤–éƒ¨","parts":["å¤–å£","åº‡ã€è»’å¤©","å¤–æ§‹","ãã®ä»–"],"val":"ç¬ æœ¨æµ®ã"},{"cat":"å¤–éƒ¨","parts":["å¤–å£","åº‡ã€è»’å¤©","æ¢","æŸ±","åºŠ","å¤–æ§‹","ãã®ä»–"],"val":"è£œä¿®è·¡çˆ†è£‚"},{"cat":"å¤–éƒ¨","parts":["å¤–å£","åº‡ã€è»’å¤©","æ¢","æŸ±","åºŠ","å¤–æ§‹","ãã®ä»–"],"val":"è£œä¿®è·¡ï½¼ï½°ï¾˜ï¾ï½¸ï¾åŠ£åŒ–"},{"cat":"å¤–éƒ¨","parts":["å¤–å£","ãã®ä»–"],"val":"é€šæ°—å£éŒ†"},{"cat":"å¤–éƒ¨","parts":["å¤–å£","å¤–æ§‹","ãã®ä»–"],"val":"é‡‘ç‰©è…é£Ÿ"},{"cat":"å¤–éƒ¨","parts":["å¤–å£","å¤–æ§‹","ãã®ä»–"],"val":"é‡‘ç‰©éŒ†"},{"cat":"å¤–éƒ¨","parts":["å¤–å£","åº‡ã€è»’å¤©","é‰„éª¨éƒ¨æ","ãã®ä»–"],"val":"é‹¼æ¿å¡—è†œåŠ£åŒ–"},{"cat":"å¤–éƒ¨","parts":["å¤–å£","åº‡ã€è»’å¤©","æ¢","æŸ±","åºŠ","å¤–æ§‹","ãã®ä»–"],"val":"ï½ºï¾ï½¸ï¾˜ï½°ï¾„ã²ã³å‰²ã‚Œ"},{"cat":"å¤–éƒ¨","parts":["å¤–å£","åº‡ã€è»’å¤©","æ¢","æŸ±","åºŠ","å¤–æ§‹","ãã®ä»–"],"val":"ï½ºï¾ï½¸ï¾˜ï½°ï¾„ã²ã³å‰²ã‚Œï½¥å¡—è†œå‰¥ãŒã‚Œ"},{"cat":"å¤–éƒ¨","parts":["å¤–å£","åº‡ã€è»’å¤©","æ¢","æŸ±","åºŠ","å¤–æ§‹","ãã®ä»–"],"val":"ï½ºï¾ï½¸ï¾˜ï½°ï¾„ã²ã³å‰²ã‚Œï½¥çˆ†è£‚ï½¥éœ²ç­‹"},{"cat":"å¤–éƒ¨","parts":["å¤–å£","åº‡ã€è»’å¤©","æ¢","æŸ±","åºŠ","å¤–æ§‹","ãã®ä»–"],"val":"ï½ºï¾ï½¸ï¾˜ï½°ï¾„ã²ã³å‰²ã‚Œï½¥æ¬ æ"},{"cat":"å¤–éƒ¨","parts":["å¤–å£","åº‡ã€è»’å¤©","æ¢","æŸ±","åºŠ","å¤–æ§‹","ãã®ä»–"],"val":"ï½ºï¾ï½¸ï¾˜ï½°ï¾„ã²ã³å‰²ã‚Œï½¥æµ®ã"},{"cat":"å¤–éƒ¨","parts":["å¤–å£","åº‡ã€è»’å¤©","æ¢","æŸ±","åºŠ","å¤–æ§‹","ãã®ä»–"],"val":"ï½ºï¾ï½¸ï¾˜ï½°ï¾„æ¬ æ"},{"cat":"å¤–éƒ¨","parts":["å¤–å£","åº‡ã€è»’å¤©","æ¢","æŸ±","åºŠ","å¤–æ§‹","ãã®ä»–"],"val":"ï½ºï¾ï½¸ï¾˜ï½°ï¾„æ¼æ°´è·¡"},{"cat":"å¤–éƒ¨","parts":["å¤–å£","åº‡ã€è»’å¤©","æ¢","æŸ±","åºŠ","å¤–æ§‹","ãã®ä»–"],"val":"ï½ºï¾ï½¸ï¾˜ï½°ï¾„çˆ†è£‚"},{"cat":"å¤–éƒ¨","parts":["å¤–å£","åº‡ã€è»’å¤©","æ¢","æŸ±","åºŠ","å¤–æ§‹","ãã®ä»–"],"val":"ï½ºï¾ï½¸ï¾˜ï½°ï¾„ç¶²çŠ¶ã²ã³å‰²ã‚Œ"},{"cat":"å¤–éƒ¨","parts":["å¤–å£","åº‡ã€è»’å¤©","æ¢","æŸ±","åºŠ","å¤–æ§‹","ãã®ä»–"],"val":"ï½ºï¾ï½¸ï¾˜ï½°ï¾„éœ²ç­‹"},{"cat":"å¤–éƒ¨","parts":["å¤–å£","åº‡ã€è»’å¤©","æ¢","æŸ±","åºŠ","å¤–æ§‹","ãã®ä»–"],"val":"ï½ºï¾ï½¸ï¾˜ï½°ï¾„ï¾Œï¾ï¾›ï½¯ï½¸æ¬ æ"},{"cat":"å¤–éƒ¨","parts":["å¤–å£","åº‡ã€è»’å¤©","æ¢","æŸ±","åºŠ","å¤–æ§‹","ãã®ä»–"],"val":"ï½ºï¾ï½¸ï¾˜ï½°ï¾„ï¾Œï¾ï¾›ï½¯ï½¸ç™½è¯"},{"cat":"å¤–éƒ¨","parts":["å¤–å£","åº‡ã€è»’å¤©","çª“ã‚µãƒƒã‚·","å»ºå…·","ãã®ä»–"],"val":"ï½¼ï½°ï¾˜ï¾ï½¸ï¾åŠ£åŒ–"},{"cat":"å¤–éƒ¨","parts":["å¤–å£","å¤–è£…ä»•ä¸Šã’æ","åºŠ","å¤–æ§‹"],"val":"ï¾€ï½²ï¾™ã²ã³å‰²ã‚Œ"},{"cat":"å¤–éƒ¨","parts":["å¤–å£","å¤–è£…ä»•ä¸Šã’æ","åºŠ","å¤–æ§‹"],"val":"ï¾€ï½²ï¾™æ¬ æ"},{"cat":"å¤–éƒ¨","parts":["å¤–å£","å¤–è£…ä»•ä¸Šã’æ","åºŠ","å¤–æ§‹"],"val":"ï¾€ï½²ï¾™æµ®ã"},{"cat":"å¤–éƒ¨","parts":["å¤–å£","å¤–è£…ä»•ä¸Šã’æ","åºŠ","å¤–æ§‹"],"val":"ï¾€ï½²ï¾™ç›®åœ°ã®åŠ£åŒ–"},{"cat":"å¤–éƒ¨","parts":["å¤–å£","å¤–æ§‹","é‰„éª¨éƒ¨æ","ãã®ä»–"],"val":"ï¾ï¾ï¾™ï¾„éŒ†"},{"cat":"å¤–éƒ¨","parts":["å¤–å£","åº‡ã€è»’å¤©","æ¢","æŸ±","åºŠ","å¤–æ§‹","ãã®ä»–"],"val":"ï¾“ï¾™ï¾€ï¾™ã²ã³å‰²ã‚Œ"},{"cat":"å¤–éƒ¨","parts":["å¤–å£","åº‡ã€è»’å¤©","æ¢","æŸ±","åºŠ","å¤–æ§‹","ãã®ä»–"],"val":"ï¾“ï¾™ï¾€ï¾™ã²ã³å‰²ã‚Œï½¥æµ®ã"},{"cat":"å¤–éƒ¨","parts":["å¤–å£","åº‡ã€è»’å¤©","æ¢","æŸ±","åºŠ","å¤–æ§‹","ãã®ä»–"],"val":"ï¾“ï¾™ï¾€ï¾™æ¬ æ"},{"cat":"å¤–éƒ¨","parts":["å¤–å£","åº‡ã€è»’å¤©","æ¢","æŸ±","åºŠ","å¤–æ§‹","ãã®ä»–"],"val":"ï¾“ï¾™ï¾€ï¾™æµ®ã"},{"cat":"å¤–éƒ¨","parts":["å¤–å£","åº‡ã€è»’å¤©","æ¢","æŸ±","åºŠ","å¤–æ§‹","ãã®ä»–"],"val":"ï¾“ï¾™ï¾€ï¾™ç¶²çŠ¶ã²ã³å‰²ã‚Œ"},{"cat":"å¤–éƒ¨","parts":["åº‡ã€è»’å¤©","ãã®ä»–"],"val":"æ³¢æ¿åŠ£åŒ–"},{"cat":"å¤–éƒ¨","parts":["åºŠ","å¤–æ§‹"],"val":"åœŸé–“ï½ºï¾ï½¸ï¾˜ï½°ï¾„æ±šã‚Œ"},{"cat":"å¤–éƒ¨","parts":["åºŠ","å¤–æ§‹"],"val":"åœŸé–“ï½ºï¾ï½¸ï¾˜ï½°ï¾„ã²ã³å‰²ã‚Œ"},{"cat":"å¤–éƒ¨","parts":["åºŠ","å¤–æ§‹"],"val":"åœŸé–“ï½ºï¾ï½¸ï¾˜ï½°ï¾„æ¬ æ"},{"cat":"å¤–éƒ¨","parts":["åºŠ","å¤–æ§‹"],"val":"åœŸé–“ï½ºï¾ï½¸ï¾˜ï½°ï¾„æµ®ã"},{"cat":"å¤–éƒ¨","parts":["åºŠ","å¤–æ§‹"],"val":"åœŸé–“ï¾€ï½²ï¾™æ¬ æ"},{"cat":"å¤–éƒ¨","parts":["åºŠ","å¤–æ§‹"],"val":"åºŠï¾€ï½²ï¾™æ±šã‚Œ"},{"cat":"å¤–éƒ¨","parts":["åºŠ","å¤–æ§‹"],"val":"æ®µé¼»æ¬ æ"},{"cat":"å¤–éƒ¨","parts":["åºŠ","å¤–æ§‹"],"val":"æ®µé¼»æµ®ã"},{"cat":"å¤–éƒ¨","parts":["åºŠ","å¤–æ§‹"],"val":"é˜²æ»‘æåŠ£åŒ–"},{"cat":"å¤–éƒ¨","parts":["åºŠ","å¤–æ§‹","ãã®ä»–"],"val":"éšæ®µè¸é¢æµ®ã"},{"cat":"å¤–éƒ¨","parts":["å»ºå…·"],"val":"å»ºå…·åŠ£åŒ–"},{"cat":"å¤–éƒ¨","parts":["å»ºå…·"],"val":"å»ºå…·å¤‰å½¢"},{"cat":"å¤–éƒ¨","parts":["å»ºå…·"],"val":"å»ºå…·è…é£Ÿ"},{"cat":"å¤–éƒ¨","parts":["å»ºå…·"],"val":"å»ºå…·éŒ†"},{"cat":"å¤–éƒ¨","parts":["å»ºå…·"],"val":"é‹¼è£½å»ºå…·å¡—è†œåŠ£åŒ–"},{"cat":"å¤–éƒ¨","parts":["å»ºå…·"],"val":"é‹¼è£½å»ºå…·å¡—è†œå‰ãŒã‚Œ"},{"cat":"å¤–éƒ¨","parts":["å»ºå…·"],"val":"é‹¼è£½å»ºå…·è…é£Ÿ"},{"cat":"å¤–éƒ¨","parts":["å»ºå…·"],"val":"é‹¼è£½å»ºå…·é–‹é–‰ä¸è‰¯"},{"cat":"å¤–éƒ¨","parts":["å»ºå…·"],"val":"ï½¼ï½¬ï½¯ï¾€ï½°çµŒå¹´åŠ£åŒ–"},{"cat":"å¤–éƒ¨","parts":["å»ºå…·"],"val":"ï½¼ï½¬ï½¯ï¾€ï½°è…é£Ÿ"},{"cat":"å¤–éƒ¨","parts":["å»ºå…·"],"val":"ï½¼ï½¬ï½¯ï¾€ï½°éŒ†ï½¥é–‹é–‰ä¸è‰¯"},{"cat":"å¤–éƒ¨","parts":["çª“ã‚µãƒƒã‚·"],"val":"ï½¶ï¾ï¾—ï½½ã²ã³å‰²ã‚Œ"},{"cat":"å¤–éƒ¨","parts":["çª“ã‚µãƒƒã‚·"],"val":"ï½¶ï¾ï¾—ï½½ï¾Œï¾ï¾›ï½¯ï½¸ã²ã³å‰²ã‚Œ"},{"cat":"å¤–éƒ¨","parts":["çª“ã‚µãƒƒã‚·"],"val":"ï½»ï½¯ï½¼çµŒå¹´åŠ£åŒ–"},{"cat":"å¤–éƒ¨","parts":["çª“ã‚µãƒƒã‚·"],"val":"ï¾‹ï¾ï½°ï¾„å¤–ã‚Œ"},{"cat":"å¤–éƒ¨","parts":["æ’æ°´è¨­å‚™"],"val":"æ¨‹æ´ã¿é‡‘ç‰©è„±è½"},{"cat":"å¤–éƒ¨","parts":["æ’æ°´è¨­å‚™"],"val":"æ¨‹æ´ã¿é‡‘ç‰©è…é£Ÿ"},{"cat":"å¤–éƒ¨","parts":["æ’æ°´è¨­å‚™"],"val":"æ¨‹æ´ã¿é‡‘ç‰©éŒ†"},{"cat":"å¤–éƒ¨","parts":["æ’æ°´è¨­å‚™"],"val":"æ¨‹ç ´æ"},{"cat":"å¤–éƒ¨","parts":["æ’æ°´è¨­å‚™"],"val":"ï½¸ï¾ï¾šï½°ï¾ï¾ï½¸ï¾éŒ†"},{"cat":"å¤–éƒ¨","parts":["æ’æ°´è¨­å‚™"],"val":"ï¾„ï¾ï¾š-ï¾éŒ†"},{"cat":"å¤–éƒ¨","parts":["åºŠ","å¤–æ§‹","ãã®ä»–"],"val":"æ‰‹æ‘ºè…é£Ÿ"},{"cat":"å¤–éƒ¨","parts":["åºŠ","å¤–æ§‹","ãã®ä»–"],"val":"æ‰‹æ‘ºéŒ†"},{"cat":"å¤–éƒ¨","parts":["å¤–æ§‹","ãã®ä»–"],"val":"ï¾Œï½ªï¾ï½½ç ´æ"},{"cat":"å¤–éƒ¨","parts":["å¤–æ§‹","ãã®ä»–"],"val":"ï¾Œï½ªï¾ï½½è…é£Ÿ"},{"cat":"å¤–éƒ¨","parts":["å¤–æ§‹","ãã®ä»–"],"val":"ï¾ï¾ï¾ï¾ç ´æ"},{"cat":"å¤–éƒ¨","parts":["å¤–æ§‹","ãã®ä»–"],"val":"ï¾ï¾ï¾ï¾è…é£Ÿ"},{"cat":"å¤–éƒ¨","parts":["å¤–æ§‹","ãã®ä»–"],"val":"ï¾ï¾ï¾ï¾éŒ†ï½¥å›ºå®šä¸è‰¯"},{"cat":"å¤–éƒ¨","parts":["å¤–å£","åºŠ","å¤–æ§‹","ãã®ä»–"],"val":"Exp.Jç ´æ"},{"cat":"å¤–éƒ¨","parts":["æŸ±","æ§‹é€ æ"],"val":"æœ¨æŸ±è…æœ½"},{"cat":"å¤–éƒ¨","parts":["æŸ±","é‰„éª¨éƒ¨æ"],"val":"æŸ±ä¸Šéƒ¨ï½¥é‰„éª¨å±‹æ ¹åŸºç¤æ¬ æ"},{"cat":"å¤–éƒ¨","parts":["å¤–å£","åº‡ã€è»’å¤©","æ¢","æŸ±","åºŠ","å¤–æ§‹","ãã®ä»–"],"val":"ï½ºï¾ï½¸ï¾˜ï½°ï¾„ç™½è¯"},{"cat":"å¤–éƒ¨","parts":["å¤–å£","åº‡ã€è»’å¤©","æ¢","æŸ±","åºŠ","å¤–æ§‹","ãã®ä»–"],"val":"ï¾“ï¾™ï¾€ï¾™å‰¥è½"},{"cat":"å¤–éƒ¨","parts":["å¤–å£","åº‡ã€è»’å¤©","æ¢","æŸ±"],"val":"é‰„ç­‹è…é£Ÿ"},{"cat":"å¤–éƒ¨","parts":["å¤–å£"],"val":"å¤–å£ï½¸ï¾—ï½¯ï½¸æ³¨å…¥è·¡åŠ£åŒ–"},{"cat":"å¤–éƒ¨","parts":["å»ºå…·"],"val":"é‹¼è£½å»ºå…·éŒ†"},{"cat":"å¤–éƒ¨","parts":["å¤–æ§‹","ãã®ä»–"],"val":"ï¾Œï½ªï¾ï½½éŒ†"},{"cat":"å¤–éƒ¨","parts":["å¤–æ§‹","ãã®ä»–"],"val":"ï¾ï¾ï¾ï¾åŠ£åŒ–"},{"cat":"å¤–éƒ¨","parts":["æ’æ°´è¨­å‚™"],"val":"æ’æ°´æºã²ã³å‰²ã‚Œ"},{"cat":"å¤–éƒ¨","parts":["æ’æ°´è¨­å‚™"],"val":"æ’æ°´æºè©°ã¾ã‚Š"},{"cat":"å¤–éƒ¨","parts":["çª“ã‚µãƒƒã‚·"],"val":"ï½»ï½¯ï½¼éŒ†"},{"cat":"å¤–éƒ¨","parts":["åºŠ","å¤–æ§‹"],"val":"åœŸé–“ï½ºï¾ï½¸ï¾˜ï½°ï¾„çˆ†è£‚"},{"cat":"å¤–éƒ¨","parts":["å¤–å£","å¤–è£…ä»•ä¸Šã’æ","åºŠ","å¤–æ§‹"],"val":"ï¾€ï½²ï¾™å‰¥è½"},{"cat":"å¤–éƒ¨","parts":["åºŠ","å¤–æ§‹","ãã®ä»–"],"val":"æ‰‹æ‘ºå¡—è†œå‰¥ãŒã‚Œ"},{"cat":"å¤–éƒ¨","parts":["åŸºç¤ã€åœŸå£Œ"],"val":"åŸºç¤ã²ã³å‰²ã‚Œ"},{"cat":"å¤–éƒ¨","parts":["å¤–æ§‹","ãã®ä»–"],"val":"ï¾‹ï¾Ÿï½¸ï¾„ï½¸ï¾ï¾—ï¾‘çµŒå¹´åŠ£åŒ–"},{"cat":"å¤–éƒ¨","parts":["å¤–æ§‹","ãã®ä»–"],"val":"ï¾‹ï¾Ÿï½¸ï¾„ï½¸ï¾ï¾—ï¾‘é€€è‰²"},{"cat":"å¤–éƒ¨","parts":["å¤–æ§‹","ãã®ä»–"],"val":"ï¾‹ï¾Ÿï½¸ï¾„ï½¸ï¾ï¾—ï¾‘è„±è½"},{"cat":"å±‹æ ¹","parts":["é˜²æ°´å±¤"],"val":"å¡—è†œé˜²æ°´åŠ£åŒ–"},{"cat":"å±‹æ ¹","parts":["å±‹æ ¹","è»’","ãã®ä»–"],"val":"å¡—è†œå‰¥ãŒã‚Œ"},{"cat":"å±‹æ ¹","parts":["å±‹æ ¹","è»’","ãã®ä»–"],"val":"å¡—è†œå‰¥ãŒã‚Œï½¥éŒ†"},{"cat":"å±‹æ ¹","parts":["å±‹æ ¹","è»’","ãã®ä»–"],"val":"å¡—è†œæµ®ã"},{"cat":"å±‹æ ¹","parts":["å±‹æ ¹","è»’","ãã®ä»–"],"val":"å¡—è†œè†¨ã‚Œ"},{"cat":"å±‹æ ¹","parts":["å±‹æ ¹","è»’","ãã®ä»–"],"val":"å¡—è†œåŠ£åŒ–ï½¥æ±šã‚Œ"},{"cat":"å±‹æ ¹","parts":["å±‹æ ¹","è»’","ãã®ä»–"],"val":"ï½ºï¾ï½¸ï¾˜ï½°ï¾„ã²ã³å‰²ã‚Œ"},{"cat":"å±‹æ ¹","parts":["å±‹æ ¹","è»’","ãã®ä»–"],"val":"ï½ºï¾ï½¸ï¾˜ï½°ï¾„æ¬ æ"},{"cat":"å±‹æ ¹","parts":["å±‹æ ¹","è»’","ãã®ä»–"],"val":"ï½ºï¾ï½¸ï¾˜ï½°ï¾„çˆ†è£‚"},{"cat":"å±‹æ ¹","parts":["å±‹æ ¹","è»’","ãã®ä»–"],"val":"ï½ºï¾ï½¸ï¾˜ï½°ï¾„æµ®ã"},{"cat":"å±‹æ ¹","parts":["å±‹æ ¹","è»’","ãã®ä»–"],"val":"ï½ºï¾ï½¸ï¾˜ï½°ï¾„éœ²ç­‹"},{"cat":"å±‹æ ¹","parts":["å±‹æ ¹","è»’","ãã®ä»–"],"val":"ï½ºï¾ï½¸ï¾˜ï½°ï¾„æ¼æ°´ã²ã³å‰²ã‚Œ"},{"cat":"å±‹æ ¹","parts":["å±‹æ ¹","è»’","ãã®ä»–"],"val":"ï½¼ï½°ï¾˜ï¾ï½¸ï¾åŠ£åŒ–"},{"cat":"å±‹æ ¹","parts":["å±‹æ ¹","è»’","ãã®ä»–"],"val":"ï¾“ï¾™ï¾€ï¾™ã²ã³å‰²ã‚Œ"},{"cat":"å±‹æ ¹","parts":["å±‹æ ¹","è»’","ãã®ä»–"],"val":"ï¾“ï¾™ï¾€ï¾™æ¬ æ"},{"cat":"å±‹æ ¹","parts":["å±‹æ ¹","è»’","ãã®ä»–"],"val":"ï¾“ï¾™ï¾€ï¾™æµ®ã"},{"cat":"å±‹æ ¹","parts":["å±‹æ ¹","è»’","ãã®ä»–"],"val":"ç›®åœ°åŠ£åŒ–"},{"cat":"å±‹æ ¹","parts":["å±‹æ ¹"],"val":"æŠ˜æ¿å±‹æ ¹éŒ†"},{"cat":"å±‹æ ¹","parts":["å±‹æ ¹"],"val":"å±‹æ ¹æçµŒå¹´åŠ£åŒ–"},{"cat":"å±‹æ ¹","parts":["å±‹æ ¹"],"val":"å±‹æ ¹æç ´æ"},{"cat":"å±‹æ ¹","parts":["å±‹æ ¹"],"val":"å±‹æ ¹è…é£Ÿ"},{"cat":"å±‹æ ¹","parts":["å±‹æ ¹"],"val":"ç“¦ç ´æ"},{"cat":"å±‹æ ¹","parts":["é˜²æ°´å±¤","ãã®ä»–"],"val":"ç¬ æœ¨å¡—è†œåŠ£åŒ–ï½¥æ±šã‚Œ"},{"cat":"å±‹æ ¹","parts":["é˜²æ°´å±¤","ãã®ä»–"],"val":"ç¬ æœ¨æµ®ãï½¥ã²ã³å‰²ã‚Œ"},{"cat":"å±‹æ ¹","parts":["å±‹æ ¹","è»’"],"val":"è¡¨é¢é¢¨åŒ–ï½¥æ±šã‚Œã«ã‚ˆã‚‹çµŒå¹´å¤‰çŠ¶"},{"cat":"å±‹æ ¹","parts":["å±‹æ ¹","ãã®ä»–"],"val":"ï¾„ï½¯ï¾Œï¾Ÿï¾—ï½²ï¾„çµŒå¹´åŠ£åŒ–ï½¥é‡‘ç‰©ã®éŒ†"},{"cat":"å±‹æ ¹","parts":["å±‹æ ¹","ãã®ä»–"],"val":"ï¾ï¾ï½°ï½½ï¾Œï¾Ÿï¾šï½°ï¾„éŒ†"},{"cat":"å±‹æ ¹","parts":["å±‹æ ¹","è»’","ãã®ä»–"],"val":"ï¾ï¾ï¾™ï¾„è…é£Ÿ"},{"cat":"å±‹æ ¹","parts":["å±‹æ ¹","ãã®ä»–"],"val":"ï¾œï½²ï¾”ï½°ç·Šçµéƒ¨éŒ†"},{"cat":"å±‹æ ¹","parts":["å±‹æ ¹","ãã®ä»–"],"val":"æŠ¼ã•ãˆï½ºï¾ï½¸ï¾˜ï½°ï¾„çµŒå¹´åŠ£åŒ–"},{"cat":"å±‹æ ¹","parts":["å±‹æ ¹","è»’","ãã®ä»–"],"val":"é‰„éª¨è…é£Ÿ"},{"cat":"å±‹æ ¹","parts":["å±‹æ ¹","ãã®ä»–"],"val":"æ‰‹æ‘ºè…é£Ÿ"},{"cat":"å±‹æ ¹","parts":["å±‹æ ¹","ãã®ä»–"],"val":"æ‰‹æ‘ºéŒ†"},{"cat":"å±‹æ ¹","parts":["è»’","ãã®ä»–"],"val":"å¤©äº•ï¾Šï¾Ÿï¾ˆï¾™ç ´æ"},{"cat":"å±‹æ ¹","parts":["æ’æ°´è¨­å‚™"],"val":"æ¨‹çµŒå¹´åŠ£åŒ–"},{"cat":"å±‹æ ¹","parts":["æ’æ°´è¨­å‚™"],"val":"æ¨‹è…é£Ÿ"},{"cat":"å±‹æ ¹","parts":["æ’æ°´è¨­å‚™"],"val":"æ¨‹ç ´æ"},{"cat":"å±‹æ ¹","parts":["æ’æ°´è¨­å‚™"],"val":"æ¨‹è©°ã¾ã‚Š"},{"cat":"å±‹æ ¹","parts":["æ’æ°´è¨­å‚™"],"val":"ï¾„ï¾ï¾š-ï¾ï½·ï½¬ï½¯ï¾Œï¾Ÿãªã—"},{"cat":"å±‹æ ¹","parts":["æ’æ°´è¨­å‚™"],"val":"ï¾„ï¾ï¾š-ï¾éŒ†"},{"cat":"å±‹æ ¹","parts":["æ’æ°´è¨­å‚™"],"val":"ï¾„ï¾ï¾š-ï¾è…é£Ÿ"},{"cat":"å±‹æ ¹","parts":["æ’æ°´è¨­å‚™"],"val":"ï¾„ï¾ï¾šï½°ï¾åœŸç ‚å †ç©"},{"cat":"å±‹æ ¹","parts":["æ’æ°´è¨­å‚™"],"val":"ï¾„ï¾ï¾šï½°ï¾åœŸç ‚å †ç©ï½¥æ¤ç”Ÿ"},{"cat":"å±‹æ ¹","parts":["æ’æ°´è¨­å‚™"],"val":"ï¾„ï¾ï¾šï½°ï¾è©°ã¾ã‚Š"},{"cat":"å±‹æ ¹","parts":["é˜²æ°´å±¤"],"val":"é˜²æ°´å±¤è†¨ã‚Œ"},{"cat":"å±‹æ ¹","parts":["é˜²æ°´å±¤"],"val":"é˜²æ°´å±¤ç ´æ–­"},{"cat":"å±‹æ ¹","parts":["å±‹æ ¹","è»’","ãã®ä»–"],"val":"ï½ºï¾ï½¸ï¾˜ï½°ï¾„ç™½è¯"},{"cat":"å±‹æ ¹","parts":["å±‹æ ¹"],"val":"å±‹æ ¹æãšã‚Œ"},{"cat":"å±‹æ ¹","parts":["å±‹æ ¹"],"val":"æŠ˜æ¿å±‹æ ¹ï¾ï¾ï¾™ï¾„è…é£Ÿ"},{"cat":"å±‹æ ¹","parts":["å±‹æ ¹","è»’","ãã®ä»–"],"val":"é‰„éª¨å¡—è†œåŠ£åŒ–"},{"cat":"å±‹æ ¹","parts":["è»’","ãã®ä»–"],"val":"å¤©äº•ï¾Šï¾Ÿï¾ˆï¾™åŠ£åŒ–"},{"cat":"å±‹æ ¹","parts":["å±‹æ ¹","è»’","ãã®ä»–"],"val":"é›¨æ¼ã‚Šè·¡"},{"cat":"å±‹æ ¹","parts":["å±‹æ ¹","è»’","ãã®ä»–"],"val":"ï¾“ï¾™ï¾€ï¾™å‰¥è½"},{"cat":"å±‹æ ¹","parts":["é˜²æ°´å±¤","æ’æ°´è¨­å‚™"],"val":"é˜²æ°´å±¤ï¾„ï¾ï¾šï½°ï¾å‘¨ã‚ŠåŠ£åŒ–"},{"cat":"å†…éƒ¨","parts":["å¤©äº•","å£","æ¢","æŸ±","æ¢ï½¥æŸ±","å£ï½¥æŸ±","å¤©äº•ï½¥æ¢","æ¢ï½¥å£"],"val":"ï½ºï¾ï½¸ï¾˜ï½°ï¾„ã²ã³å‰²ã‚Œ"},{"cat":"å†…éƒ¨","parts":["å¤©äº•","å£","æ¢","æŸ±","æ¢ï½¥æŸ±","å£ï½¥æŸ±","å¤©äº•ï½¥æ¢","æ¢ï½¥å£"],"val":"ï½ºï¾ï½¸ï¾˜ï½°ï¾„æ¼æ°´ã²ã³å‰²ã‚Œ"},{"cat":"å†…éƒ¨","parts":["å¤©äº•","å£","æ¢","æŸ±","æ¢ï½¥æŸ±","å£ï½¥æŸ±","å¤©äº•ï½¥æ¢","æ¢ï½¥å£"],"val":"ï½ºï¾ï½¸ï¾˜ï½°ï¾„æ¬ æ"},{"cat":"å†…éƒ¨","parts":["å¤©äº•","å£","æ¢","æŸ±","æ¢ï½¥æŸ±","å£ï½¥æŸ±","å¤©äº•ï½¥æ¢","æ¢ï½¥å£"],"val":"ï½ºï¾ï½¸ï¾˜ï½°ï¾„çˆ†è£‚"},{"cat":"å†…éƒ¨","parts":["å¤©äº•","å£","æ¢","æŸ±","æ¢ï½¥æŸ±","å£ï½¥æŸ±","å¤©äº•ï½¥æ¢","æ¢ï½¥å£"],"val":"ï½ºï¾ï½¸ï¾˜ï½°ï¾„ç¶²çŠ¶ã²ã³å‰²ã‚Œ"},{"cat":"å†…éƒ¨","parts":["å¤©äº•","å£","æ¢","æŸ±","æ¢ï½¥æŸ±","å£ï½¥æŸ±","å¤©äº•ï½¥æ¢","æ¢ï½¥å£"],"val":"ï½ºï¾ï½¸ï¾˜ï½°ï¾„éœ²ç­‹"},{"cat":"å†…éƒ¨","parts":["å¤©äº•","å£","æ¢","æŸ±","æ¢ï½¥æŸ±","å£ï½¥æŸ±","å¤©äº•ï½¥æ¢","æ¢ï½¥å£"],"val":"ï½ºï¾ï½¸ï¾˜ï½°ï¾„ã²ã³å‰²ã‚Œï½¥ç™½è¯"},{"cat":"å†…éƒ¨","parts":["å¤©äº•","å£","æ¢","æŸ±","æ¢ï½¥æŸ±","å£ï½¥æŸ±","å¤©äº•ï½¥æ¢","æ¢ï½¥å£"],"val":"ï¾“ï¾™ï¾€ï¾™ã²ã³å‰²ã‚Œ"},{"cat":"å†…éƒ¨","parts":["å¤©äº•","å£","æ¢","æŸ±","æ¢ï½¥æŸ±","å£ï½¥æŸ±","å¤©äº•ï½¥æ¢","æ¢ï½¥å£"],"val":"ï¾“ï¾™ï¾€ï¾™æ¬ æ"},{"cat":"å†…éƒ¨","parts":["å¤©äº•","å£","æ¢","æŸ±","æ¢ï½¥æŸ±","å£ï½¥æŸ±","å¤©äº•ï½¥æ¢","æ¢ï½¥å£"],"val":"ï¾“ï¾™ï¾€ï¾™æµ®ã"},{"cat":"å†…éƒ¨","parts":["å¤©äº•","å£","æ¢","æŸ±","æ¢ï½¥æŸ±","å£ï½¥æŸ±","å¤©äº•ï½¥æ¢","æ¢ï½¥å£"],"val":"ï¾“ï¾™ï¾€ï¾™ç¶²çŠ¶ã²ã³å‰²ã‚Œ"},{"cat":"å†…éƒ¨","parts":["å¤©äº•"],"val":"å¤©äº•ï¾ï¾ï½°ï¾„ï¾ç ´æ"},{"cat":"å†…éƒ¨","parts":["å¤©äº•"],"val":"å¤©äº•ï½¹ï½²ï½¶ï¾™æ¿ç ´æ"},{"cat":"å†…éƒ¨","parts":["å¤©äº•"],"val":"å¤©äº•ï½¼ï¾è·¡"},{"cat":"å†…éƒ¨","parts":["å¤©äº•"],"val":"å¤©äº•ãŸã‚ã¿"},{"cat":"å†…éƒ¨","parts":["å¤©äº•"],"val":"å¤©äº•ï¾ï¾ï½°ï¾„ï¾ãšã‚Œ"},{"cat":"å†…éƒ¨","parts":["å¤©äº•"],"val":"å¤©äº•å¡—è†œå‰ãŒã‚Œ"},{"cat":"å†…éƒ¨","parts":["å¤©äº•"],"val":"å¤©äº•å¡—è†œæµ®ã"},{"cat":"å†…éƒ¨","parts":["å¤©äº•"],"val":"å¤©äº•å¡—è†œåŠ£åŒ–"},{"cat":"å†…éƒ¨","parts":["å¤©äº•"],"val":"å¤©äº•ï½¸ï¾›ï½½å‰¥ãŒã‚Œ"},{"cat":"å†…éƒ¨","parts":["å£"],"val":"å†…å£æ±šã‚Œ"},{"cat":"å†…éƒ¨","parts":["å£"],"val":"å†…å£æ¼æ°´è·¡"},{"cat":"å†…éƒ¨","parts":["å£"],"val":"å†…å£ï½¸ï¾›ï½½å‰¥ãŒã‚Œ"},{"cat":"å†…éƒ¨","parts":["å£"],"val":"å†…å£å¡—è†œå‰¥ãŒã‚Œ"},{"cat":"å†…éƒ¨","parts":["å£"],"val":"å†…å£å¡—è†œæµ®ã"},{"cat":"å†…éƒ¨","parts":["å£"],"val":"å†…å£å¡—è†œåŠ£åŒ–"},{"cat":"å†…éƒ¨","parts":["å£"],"val":"å†…å£å¡—è†œåŠ£åŒ–ï½¥æ±šã‚Œ"},{"cat":"å†…éƒ¨","parts":["å£","å¤©äº•","åºŠ","å»ºå…·","çª“ã‚µãƒƒã‚·","ãã®ä»–"],"val":"ï½¼ï½°ï¾˜ï¾ï½¸ï¾åŠ£åŒ–"},{"cat":"å†…éƒ¨","parts":["å£","åºŠ"],"val":"ï¾€ï½²ï¾™ã²ã³å‰²ã‚Œ"},{"cat":"å†…éƒ¨","parts":["å£","åºŠ"],"val":"ï¾€ï½²ï¾™æ¬ æ"},{"cat":"å†…éƒ¨","parts":["å£","åºŠ"],"val":"ï¾€ï½²ï¾™æµ®ã"},{"cat":"å†…éƒ¨","parts":["å£","åºŠ"],"val":"ï¾€ï½²ï¾™ç›®åœ°ã®åŠ£åŒ–"},{"cat":"å†…éƒ¨","parts":["å£","å¤©äº•","ãã®ä»–"],"val":"é‡‘ç‰©è…é£Ÿ"},{"cat":"å†…éƒ¨","parts":["å£","å¤©äº•","ãã®ä»–"],"val":"é‡‘ç‰©éŒ†"},{"cat":"å†…éƒ¨","parts":["å£","å¤©äº•","ãã®ä»–"],"val":"ï¾ï¾ï¾™ï¾„éŒ†"},{"cat":"å†…éƒ¨","parts":["åºŠ"],"val":"åœŸé–“ï½ºï¾ï½¸ï¾˜ï½°ï¾„ã®æ±šã‚Œ"},{"cat":"å†…éƒ¨","parts":["åºŠ"],"val":"åœŸé–“ï½ºï¾ï½¸ï¾˜ï½°ï¾„ã²ã³å‰²ã‚Œ"},{"cat":"å†…éƒ¨","parts":["åºŠ"],"val":"åœŸé–“ï½ºï¾ï½¸ï¾˜ï½°ï¾„æ¬ æ"},{"cat":"å†…éƒ¨","parts":["åºŠ"],"val":"åœŸé–“ï½ºï¾ï½¸ï¾˜ï½°ï¾„æµ®ã"},{"cat":"å†…éƒ¨","parts":["åºŠ"],"val":"å¡—åºŠå¡—è†œå‰¥ãŒã‚Œ"},{"cat":"å†…éƒ¨","parts":["åºŠ"],"val":"å¡—åºŠåŠ£åŒ–ï½¥æ±šã‚Œ"},{"cat":"å†…éƒ¨","parts":["åºŠ"],"val":"ï¾Œï¾›ï½°ï¾˜ï¾ï½¸ï¾åŠ£åŒ–"},{"cat":"å†…éƒ¨","parts":["åºŠ"],"val":"ï¾Œï¾›ï½°ï¾˜ï¾ï½¸ï¾æ‘©è€—"},{"cat":"å†…éƒ¨","parts":["åºŠ"],"val":"åºŠï½¼ï½°ï¾„å‰¥ãŒã‚Œ"},{"cat":"å†…éƒ¨","parts":["åºŠ"],"val":"åºŠï½¼ï½°ï¾„åŠ£åŒ–"},{"cat":"å†…éƒ¨","parts":["åºŠ"],"val":"æ®µé¼»æ¬ æ"},{"cat":"å†…éƒ¨","parts":["åºŠ"],"val":"æ®µé¼»æµ®ã"},{"cat":"å†…éƒ¨","parts":["åºŠ"],"val":"Pï¾€ï½²ï¾™åŠ£åŒ–"},{"cat":"å†…éƒ¨","parts":["åºŠ"],"val":"Pï¾€ï½²ï¾™å‰¥ãŒã‚Œ"},{"cat":"å†…éƒ¨","parts":["åºŠ","ãã®ä»–"],"val":"è£œä¿®è·¡ã²ã³å‰²ã‚Œ"},{"cat":"å†…éƒ¨","parts":["å»ºå…·"],"val":"åŒ–ç²§æ¿ç ´æ"},{"cat":"å†…éƒ¨","parts":["å»ºå…·"],"val":"æœ¨è£½å»ºå…·å¡—è†œå‰ãŒã‚Œ"},{"cat":"å†…éƒ¨","parts":["å»ºå…·"],"val":"æœ¨è£½å»ºå…·ç ´æ"},{"cat":"å†…éƒ¨","parts":["å»ºå…·"],"val":"æœ¨è£½å»ºå…·å¤‰å½¢"},{"cat":"å†…éƒ¨","parts":["å»ºå…·"],"val":"æœ¨è£½å»ºå…·çµŒå¹´åŠ£åŒ–"},{"cat":"å†…éƒ¨","parts":["å»ºå…·"],"val":"é‹¼è£½å»ºå…·æ éŒ†"},{"cat":"å†…éƒ¨","parts":["å»ºå…·"],"val":"é‹¼è£½å»ºå…·æ è…é£Ÿ"},{"cat":"å†…éƒ¨","parts":["å»ºå…·"],"val":"å»ºå…·é–‹é–‰ä¸è‰¯"},{"cat":"å†…éƒ¨","parts":["å»ºå…·"],"val":"é‹¼è£½å»ºå…·å¡—è†œå‰ãŒã‚Œ"},{"cat":"å†…éƒ¨","parts":["å»ºå…·"],"val":"é‹¼è£½å»ºå…·éŒ†"},{"cat":"å†…éƒ¨","parts":["å»ºå…·"],"val":"é‹¼è£½å»ºå…·è…é£Ÿ"},{"cat":"å†…éƒ¨","parts":["å»ºå…·"],"val":"é‹¼è£½å»ºå…·å¤‰å½¢"},{"cat":"å†…éƒ¨","parts":["å»ºå…·"],"val":"é‹¼è£½å»ºå…·çµŒå¹´åŠ£åŒ–"},{"cat":"å†…éƒ¨","parts":["å»ºå…·"],"val":"ï¾„ï¾ï½±ï½¸ï¾›ï½°ï½»ï¾ï½°éŒ†"},{"cat":"å†…éƒ¨","parts":["å»ºå…·"],"val":"ï¾„ï¾ï½±ï½¸ï¾›ï½°ï½»ï¾ï½°æ²¹æ¼ã‚Œ"},{"cat":"å†…éƒ¨","parts":["å»ºå…·"],"val":"è¶ç•ªéŒ†"},{"cat":"å†…éƒ¨","parts":["å»ºå…·"],"val":"å–æ‰‹æ¬ æ"},{"cat":"å†…éƒ¨","parts":["å»ºå…·"],"val":"ï½¼ï½¬ï½¯ï¾€ï½°è…é£Ÿ"},{"cat":"å†…éƒ¨","parts":["å»ºå…·"],"val":"ï½¼ï½¬ï½¯ï¾€ï½°éŒ†"},{"cat":"å†…éƒ¨","parts":["å»ºå…·"],"val":"ï½¼ï½¬ï½¯ï¾€ï½°éŒ†ï½¥é–‹é–‰ä¸è‰¯"},{"cat":"å†…éƒ¨","parts":["å»ºå…·"],"val":"ï½¼ï½°ï¾˜ï¾ï½¸ï¾åŠ£åŒ–"},{"cat":"å†…éƒ¨","parts":["çª“ã‚µãƒƒã‚·"],"val":"ï½¶ï¾ï¾—ï½½ã²ã³å‰²ã‚Œ"},{"cat":"å†…éƒ¨","parts":["çª“ã‚µãƒƒã‚·"],"val":"ï½»ï½¯ï½¼çµŒå¹´åŠ£åŒ–"},{"cat":"å†…éƒ¨","parts":["çª“ã‚µãƒƒã‚·"],"val":"ï½¶ï¾ï¾—ï½½ï¾Œï¾ï¾›ï½¯ï½¸ã²ã³å‰²ã‚Œ"},{"cat":"å†…éƒ¨","parts":["å£","åºŠ","ãã®ä»–"],"val":"Exp.Jç ´æ"},{"cat":"å†…éƒ¨","parts":["åºŠ","ãã®ä»–"],"val":"æ‰‹æ‘ºè…é£Ÿ"},{"cat":"å†…éƒ¨","parts":["åºŠ","ãã®ä»–"],"val":"æ‰‹æ‘ºéŒ†"},{"cat":"å†…éƒ¨","parts":["åºŠ","ãã®ä»–"],"val":"æ‰‹æ‘ºéŒ†ï½¥å¡—è†œå‰¥ãŒã‚Œ"},{"cat":"å†…éƒ¨","parts":["æ¢","æŸ±","ãã®ä»–"],"val":"é‰„éª¨è…é£Ÿ"},{"cat":"å†…éƒ¨","parts":["æ¢","æŸ±","ãã®ä»–"],"val":"ï½ºï¾ï½¸ï¾˜ï½°ï¾„ã²ã³å‰²ã‚Œ"},{"cat":"å†…éƒ¨","parts":["æ¢","æŸ±","ãã®ä»–"],"val":"ï½ºï¾ï½¸ï¾˜ï½°ï¾„æ¬ æ"},{"cat":"å†…éƒ¨","parts":["æ¢","æŸ±","ãã®ä»–"],"val":"ï½ºï¾ï½¸ï¾˜ï½°ï¾„çˆ†è£‚"},{"cat":"å†…éƒ¨","parts":["æ¢","æŸ±","ãã®ä»–"],"val":"ï½ºï¾ï½¸ï¾˜ï½°ï¾„éœ²ç­‹"},{"cat":"å†…éƒ¨","parts":["æ¢","æŸ±","ãã®ä»–"],"val":"ï¾“ï¾™ï¾€ï¾™ã²ã³å‰²ã‚Œ"},{"cat":"å†…éƒ¨","parts":["åºŠ"],"val":"åºŠï¾€ï½²ï¾™æ¬ æ"},{"cat":"å†…éƒ¨","parts":["åºŠ"],"val":"åºŠï½ºï¾ï½¸ï¾˜ï½°ï¾„ã²ã³å‰²ã‚Œ"},{"cat":"å†…éƒ¨","parts":["åºŠ"],"val":"åºŠï½ºï¾ï½¸ï¾˜ï½°ï¾„çˆ†è£‚"},{"cat":"å†…éƒ¨","parts":["å»ºå…·"],"val":"é‹¼è£½å»ºå…·å¡—è†œåŠ£åŒ–"},{"cat":"å†…éƒ¨","parts":["å»ºå…·"],"val":"æœ¨è£½å»ºå…·è…é£Ÿ"},{"cat":"å†…éƒ¨","parts":["åºŠ","ãã®ä»–"],"val":"æ‰‹æ‘ºå¡—è†œå‰¥ãŒã‚Œ"},{"cat":"å†…éƒ¨","parts":["åºŠ","ãã®ä»–"],"val":"æ‰‹æ‘ºãã‚‰ã¤ã"},{"cat":"å†…éƒ¨","parts":["æ¢","æŸ±","ãã®ä»–"],"val":"é‰„éª¨å¡—è†œåŠ£åŒ–"},{"cat":"å†…éƒ¨","parts":["å¤©äº•","å£"],"val":"çµéœ²è·¡"},{"cat":"å†…éƒ¨","parts":["ãã®ä»–"],"val":"ï¾‹ï¾Ÿï½¸ï¾„ï½¸ï¾ï¾—ï¾‘çµŒå¹´åŠ£åŒ–"},{"cat":"å†…éƒ¨","parts":["ãã®ä»–"],"val":"ï¾‹ï¾Ÿï½¸ï¾„ï½¸ï¾ï¾—ï¾‘é€€è‰²"},{"cat":"å†…éƒ¨","parts":["ãã®ä»–"],"val":"ï¾‹ï¾Ÿï½¸ï¾„ï½¸ï¾ï¾—ï¾‘è„±è½"},{"cat":"å†…éƒ¨","parts":["åºŠ"],"val":"åºŠï¾€ï½²ï¾™æµ®ã"},{"cat":"è¨­å‚™","parts":["ç…§æ˜å™¨å…·"],"val":"ç…§æ˜ï½¶ï¾Šï¾ï½°åŠ£åŒ–"},{"cat":"è¨­å‚™","parts":["ç…§æ˜å™¨å…·"],"val":"ç…§æ˜ï½¶ï¾Šï¾ï½°ãªã—"},{"cat":"è¨­å‚™","parts":["ç…§æ˜å™¨å…·"],"val":"ç…§æ˜å™¨å…·åŠ£åŒ–"},{"cat":"è¨­å‚™","parts":["ç…§æ˜å™¨å…·"],"val":"ç…§æ˜ä¸ç‚¹ç¯"},{"cat":"è¨­å‚™","parts":["é›»æ°—è¨­å‚™"],"val":"é›»æ°—é…ç·šæœªå‡¦ç†"},{"cat":"è¨­å‚™","parts":["é›»æ°—è¨­å‚™"],"val":"åˆ†é›»ç›¤åŠ£åŒ–"},{"cat":"è¨­å‚™","parts":["é›»æ°—è¨­å‚™"],"val":"é›»æ°—BOXéŒ†"},{"cat":"è¨­å‚™","parts":["é›»æ°—è¨­å‚™"],"val":"é›»æ°—BOXè…é£Ÿ"},{"cat":"è¨­å‚™","parts":["é›»æ°—è¨­å‚™"],"val":"é›»æ°—BOXå¡—è†œå‰¥ãŒã‚Œ"},{"cat":"è¨­å‚™","parts":["é›»æ°—è¨­å‚™"],"val":"ï½ºï¾ï½¾ï¾ï¾„æå‚·"},{"cat":"è¨­å‚™","parts":["é›»æ°—è¨­å‚™"],"val":"ï½ºï¾ï½¾ï¾ï¾„åŠ£åŒ–"},{"cat":"è¨­å‚™","parts":["é›»æ°—è¨­å‚™"],"val":"ï½ºï¾ï½¾ï¾ï¾„éŒ†"},{"cat":"è¨­å‚™","parts":["é›»æ°—è¨­å‚™"],"val":"ï½½ï½²ï½¯ï¾åŠ£åŒ–"},{"cat":"è¨­å‚™","parts":["é›»æ°—è¨­å‚™"],"val":"ï¾Œï¾ï¾šï½°ï½¶ï½°åŠ£åŒ–"},{"cat":"è¨­å‚™","parts":["é›»æ°—è¨­å‚™"],"val":"ï¾„ï¾—ï¾ï½½åŠ£åŒ–"},{"cat":"è¨­å‚™","parts":["ä¾¿å™¨ã€æ´—é¢å™¨ç­‰"],"val":"ä¾¿å™¨çµŒå¹´åŠ£åŒ–"},{"cat":"è¨­å‚™","parts":["ä¾¿å™¨ã€æ´—é¢å™¨ç­‰"],"val":"ä¾¿å™¨æ¬ æ"},{"cat":"è¨­å‚™","parts":["ä¾¿å™¨ã€æ´—é¢å™¨ç­‰"],"val":"æ´—é¢å™¨çµŒå¹´åŠ£åŒ–"},{"cat":"è¨­å‚™","parts":["ä¾¿å™¨ã€æ´—é¢å™¨ç­‰"],"val":"æ´—é¢å°åŠ£åŒ–"},{"cat":"è¨­å‚™","parts":["ä¾¿å™¨ã€æ´—é¢å™¨ç­‰"],"val":"æ°´æ “é‡‘å…·çµŒå¹´åŠ£åŒ–"},{"cat":"è¨­å‚™","parts":["ä¾¿å™¨ã€æ´—é¢å™¨ç­‰"],"val":"é¡åŠ£åŒ–"},{"cat":"è¨­å‚™","parts":["ä¾¿å™¨ã€æ´—é¢å™¨ç­‰"],"val":"ï¾ï¾Ÿï½°ï¾Šï¾Ÿï½°ï¾ï¾™ï¾€ï¾ï½°åŠ£åŒ–"},{"cat":"è¨­å‚™","parts":["çµ¦æ’æ°´"],"val":"æ’æ°´ç®¡è…é£Ÿ"},{"cat":"è¨­å‚™","parts":["çµ¦æ’æ°´"],"val":"æ’æ°´ç®¡å¡—è†œå‰¥ãŒã‚Œ"},{"cat":"è¨­å‚™","parts":["çµ¦æ’æ°´"],"val":"çµ¦æ°´ç®¡è…é£Ÿ"},{"cat":"è¨­å‚™","parts":["çµ¦æ’æ°´"],"val":"çµ¦æ°´ç®¡çµŒå¹´åŠ£åŒ–"},{"cat":"è¨­å‚™","parts":["çµ¦æ’æ°´"],"val":"çµ¦æ°´ç®¡éŒ†"},{"cat":"è¨­å‚™","parts":["çµ¦æ’æ°´"],"val":"çµ¦æ¹¯ç®¡çµŒå¹´åŠ£åŒ–"},{"cat":"è¨­å‚™","parts":["çµ¦æ’æ°´"],"val":"é‡æ°´å™¨çµŒå¹´åŠ£åŒ–"},{"cat":"è¨­å‚™","parts":["çµ¦æ’æ°´"],"val":"æ’æ°´ç®¡éŒ†"},{"cat":"è¨­å‚™","parts":["çµ¦æ’æ°´"],"val":"å—æ°´æ§½åŠ£åŒ–"},{"cat":"è¨­å‚™","parts":["çµ¦æ’æ°´"],"val":"é«˜æ¶æ°´æ§½åŠ£åŒ–"},{"cat":"è¨­å‚™","parts":["çµ¦æ’æ°´"],"val":"æ’æ°´æºç ´æ"},{"cat":"è¨­å‚™","parts":["çµ¦æ’æ°´"],"val":"æ’æ°´æ¡è“‹ç ´æ"},{"cat":"è¨­å‚™","parts":["çµ¦æ’æ°´"],"val":"æ’æ°´æ¡è“‹éŒ†"},{"cat":"è¨­å‚™","parts":["çµ¦æ’æ°´"],"val":"æ±šæ°´æ¡è“‹ç ´æ"},{"cat":"è¨­å‚™","parts":["çµ¦æ’æ°´"],"val":"æ±šæ°´æ¡è“‹éŒ†"},{"cat":"è¨­å‚™","parts":["çµ¦æ’æ°´"],"val":"ï¾ï¾ï¾ï½°ï¾™è“‹ç ´æ"},{"cat":"è¨­å‚™","parts":["çµ¦æ’æ°´"],"val":"ï¾ï¾ï¾ï½°ï¾™è“‹éŒ†"},{"cat":"è¨­å‚™","parts":["çµ¦æ’æ°´"],"val":"æ•£æ°´æ “è“‹ç ´æ"},{"cat":"è¨­å‚™","parts":["çµ¦æ’æ°´"],"val":"æ•£æ°´æ “è“‹éŒ†"},{"cat":"è¨­å‚™","parts":["çµ¦æ’æ°´"],"val":"æµ„åŒ–æ§½çµŒå¹´åŠ£åŒ–"},{"cat":"è¨­å‚™","parts":["çµ¦æ’æ°´"],"val":"æµ„åŒ–æ§½ï¾Œï¾ï¾›ï½±åŠ£åŒ–"},{"cat":"è¨­å‚™","parts":["çµ¦æ’æ°´"],"val":"ï¾ï¾Ÿï¾ï¾Œï¾ŸçµŒå¹´åŠ£åŒ–"},{"cat":"è¨­å‚™","parts":["æ¹¯æ²¸å™¨ã€ã‚³ãƒ³ãƒ­"],"val":"ç¬é–“æ¹¯æ²¸å™¨åŠ£åŒ–"},{"cat":"è¨­å‚™","parts":["æ¹¯æ²¸å™¨ã€ã‚³ãƒ³ãƒ­"],"val":"çµ¦æ¹¯å™¨çµŒå¹´åŠ£åŒ–"},{"cat":"è¨­å‚™","parts":["æ¹¯æ²¸å™¨ã€ã‚³ãƒ³ãƒ­"],"val":"ï¾ï¾ï½²ï¾—ï½°åŠ£åŒ–"},{"cat":"è¨­å‚™","parts":["æ¹¯æ²¸å™¨ã€ã‚³ãƒ³ãƒ­"],"val":"ï½ºï¾ï¾›çµŒå¹´åŠ£åŒ–"},{"cat":"è¨­å‚™","parts":["æ›æ°—è¨­å‚™"],"val":"æ›æ°—å£åŠ£åŒ–"},{"cat":"è¨­å‚™","parts":["æ›æ°—è¨­å‚™"],"val":"æ›æ°—æ‰‡åŠ£åŒ–"},{"cat":"è¨­å‚™","parts":["æ›æ°—è¨­å‚™"],"val":"æ›æ°—è¨­å‚™çµŒå¹´åŠ£åŒ–"},{"cat":"è¨­å‚™","parts":["æ›æ°—è¨­å‚™"],"val":"ï¾ï¾ï¾ï¾„ï½·ï½¬ï½¯ï¾Œï¾ŸåŠ£åŒ–"},{"cat":"è¨­å‚™","parts":["æ›æ°—è¨­å‚™"],"val":"ï¾€ï¾ï½¸ï¾„åŠ£åŒ–"},{"cat":"è¨­å‚™","parts":["æ›æ°—è¨­å‚™"],"val":"ï¾Œï½°ï¾„ï¾åŠ£åŒ–"},{"cat":"è¨­å‚™","parts":["ç©ºèª¿è¨­å‚™"],"val":"ï½´ï½±ï½ºï¾çµŒå¹´åŠ£åŒ–"},{"cat":"è¨­å‚™","parts":["ç©ºèª¿è¨­å‚™"],"val":"ï½´ï½±ï½ºï¾å®¤å¤–æ©ŸåŠ£åŒ–"},{"cat":"è¨­å‚™","parts":["ç©ºèª¿è¨­å‚™"],"val":"ï½´ï½±ï½ºï¾å†·åª’ç®¡åŠ£åŒ–"},{"cat":"è¨­å‚™","parts":["ç©ºèª¿è¨­å‚™"],"val":"ï¾ï¾—ï½°åŠ£åŒ–"},{"cat":"è¨­å‚™","parts":["ç©ºèª¿è¨­å‚™"],"val":"å†·å´å¡”åŠ£åŒ–"},{"cat":"è¨­å‚™","parts":["ç©ºèª¿è¨­å‚™"],"val":"ï¾ï¾Ÿï¾ï¾Œï¾ŸçµŒå¹´åŠ£åŒ–"},{"cat":"è¨­å‚™","parts":["ç©ºèª¿è¨­å‚™"],"val":"è†¨å¼µï¾€ï¾ï½¸åŠ£åŒ–"},{"cat":"è¨­å‚™","parts":["ç©ºèª¿è¨­å‚™"],"val":"é…ç®¡çµŒå¹´åŠ£åŒ–"},{"cat":"è¨­å‚™","parts":["ãã®ä»–"],"val":"ï½´ï¾šï¾ï¾ï½°ï¾€ï½°çµŒå¹´åŠ£åŒ–"},{"cat":"è¨­å‚™","parts":["ãã®ä»–"],"val":"ï¾Œï¾ï¾—ï½²ï¾ï¾„ï¾åŠ£åŒ–"},{"cat":"è¨­å‚™","parts":["ãã®ä»–"],"val":"ï¾Œï¾ï¾—ï½²ï¾ï¾„ï¾ç ´æ"},{"cat":"è¨­å‚™","parts":["ãã®ä»–"],"val":"é¿é›£å™¨å…·çµŒå¹´åŠ£åŒ–"},{"cat":"è¨­å‚™","parts":["ãã®ä»–"],"val":"æ¶ˆç«æ “å‰ã®éšœå®³ç‰©"},{"cat":"è¨­å‚™","parts":["ãã®ä»–"],"val":"æ¶ˆç«è¨­å‚™çŠ¶æ³"},{"cat":"è¨­å‚™","parts":["ãã®ä»–"],"val":"æ¶ˆé˜²è¨­å‚™çŠ¶æ³"},{"cat":"è¨­å‚™","parts":["ãã®ä»–"],"val":"é˜²ç«ï¾€ï¾ï¾ï¾Šï¾Ÿï½°åŠ£åŒ–"},{"cat":"è¨­å‚™","parts":["ãã®ä»–"],"val":"é˜²ç«æ‰‰åŠ£åŒ–"},{"cat":"è¨­å‚™","parts":["ãã®ä»–"],"val":"é˜²ç«æ‰‰è…é£Ÿ"},{"cat":"è¨­å‚™","parts":["ãã®ä»–"],"val":"é˜²ç«æ‰‰é–‹é–‰ä¸è‰¯"},{"cat":"è¨­å‚™","parts":["ãã®ä»–"],"val":"è‡ªå‹•ç«ç½å ±çŸ¥è¨­å‚™åŠ£åŒ–"},{"cat":"è¨­å‚™","parts":["ãã®ä»–"],"val":"èª˜å°ç¯çµŒå¹´åŠ£åŒ–"},{"cat":"è¨­å‚™","parts":["ãã®ä»–"],"val":"æ„ŸçŸ¥å™¨çµŒå¹´åŠ£åŒ–"},{"cat":"è¨­å‚™","parts":["ãã®ä»–"],"val":"éå¸¸æ”¾é€è¨­å‚™åŠ£åŒ–"},{"cat":"è¨­å‚™","parts":["ãã®ä»–"],"val":"å¤ªé™½å…‰ç™ºé›»è¨­å‚™åŠ£åŒ–"},{"cat":"è¨­å‚™","parts":["ãã®ä»–"],"val":"è“„é›»æ± è¨­å‚™åŠ£åŒ–"},{"cat":"è¨­å‚™","parts":["ãã®ä»–"],"val":"å—å¤‰é›»è¨­å‚™åŠ£åŒ–"},{"cat":"è¨­å‚™","parts":["ãã®ä»–"],"val":"éå¸¸ç”¨ç™ºé›»è¨­å‚™åŠ£åŒ–"},{"cat":"è¨­å‚™","parts":["ãã®ä»–"],"val":"ï½·ï½­ï½°ï¾‹ï¾ï½¸ï¾™åŠ£åŒ–"},{"cat":"è¨­å‚™","parts":["ãã®ä»–"],"val":"é§è»Šå ´è¨­å‚™åŠ£åŒ–"},{"cat":"è¨­å‚™","parts":["ãã®ä»–"],"val":"éŠå…·åŠ£åŒ–"},{"cat":"è¨­å‚™","parts":["ãã®ä»–"],"val":"éŠå…·ç ´æ"},{"cat":"è¨­å‚™","parts":["ãã®ä»–"],"val":"éŠå…·è…é£Ÿ"},{"cat":"è¨­å‚™","parts":["ãã®ä»–"],"val":"éŠå…·éŒ†"},{"cat":"è¨­å‚™","parts":["ãã®ä»–"],"val":"çœ‹æ¿å¡—è†œåŠ£åŒ–"},{"cat":"è¨­å‚™","parts":["ãã®ä»–"],"val":"çœ‹æ¿è…é£Ÿ"},{"cat":"è¨­å‚™","parts":["ãã®ä»–"],"val":"å¤–ç¯åŠ£åŒ–"},{"cat":"è¨­å‚™","parts":["ãã®ä»–"],"val":"å¤–ç¯è…é£Ÿ"},{"cat":"è¨­å‚™","parts":["ãã®ä»–"],"val":"å¤–ç¯éŒ†"},{"cat":"è¨­å‚™","parts":["ãã®ä»–"],"val":"æ²ç¤ºæ¿åŠ£åŒ–"},{"cat":"è¨­å‚™","parts":["ãã®ä»–"],"val":"æ²ç¤ºæ¿è…é£Ÿ"},{"cat":"è¨­å‚™","parts":["ãã®ä»–"],"val":"ï¾ï¾Ÿï½°ï¾™éŒ†"},{"cat":"è¨­å‚™","parts":["ãã®ä»–"],"val":"è»Šæ­¢ã‚ç ´æ"},{"cat":"è¨­å‚™","parts":["ç…§æ˜å™¨å…·"],"val":"ç…§æ˜å™¨å…·éŒ†"},{"cat":"è¨­å‚™","parts":["é›»æ°—è¨­å‚™"],"val":"åˆ†é›»ç›¤éŒ†"},{"cat":"è¨­å‚™","parts":["é›»æ°—è¨­å‚™"],"val":"åˆ†é›»ç›¤è…é£Ÿ"},{"cat":"è¨­å‚™","parts":["ä¾¿å™¨ã€æ´—é¢å™¨ç­‰"],"val":"ä¾¿å™¨ç ´æ"},{"cat":"è¨­å‚™","parts":["ä¾¿å™¨ã€æ´—é¢å™¨ç­‰"],"val":"æ´—é¢å™¨ç ´æ"},{"cat":"è¨­å‚™","parts":["ä¾¿å™¨ã€æ´—é¢å™¨ç­‰"],"val":"æ°´æ “é‡‘å…·æ¼æ°´"},{"cat":"è¨­å‚™","parts":["çµ¦æ’æ°´"],"val":"æ’æ°´ç®¡çµŒå¹´åŠ£åŒ–"},{"cat":"è¨­å‚™","parts":["çµ¦æ’æ°´"],"val":"çµ¦æ°´ç®¡æ¼æ°´"},{"cat":"è¨­å‚™","parts":["çµ¦æ’æ°´"],"val":"æ’æ°´ç®¡æ¼æ°´"},{"cat":"è¨­å‚™","parts":["ãã®ä»–"],"val":"æ¶ˆç«å™¨çµŒå¹´åŠ£åŒ–"},{"cat":"è¨­å‚™","parts":["ãã®ä»–"],"val":"éå¸¸ç…§æ˜ä¸ç‚¹ç¯"},{"cat":"è¨­å‚™","parts":["ãã®ä»–"],"val":"ï½²ï¾ï¾€ï½°ï¾ï¾åŠ£åŒ–"},{"cat":"è¨­å‚™","parts":["ãã®ä»–"],"val":"æ”¾é€è¨­å‚™åŠ£åŒ–"},{"cat":"è¨­å‚™","parts":["ãã®ä»–"],"val":"ï½¶ï½°ï¾ƒï¾åŠ£åŒ–"},{"cat":"è¨­å‚™","parts":["ãã®ä»–"],"val":"ï½¶ï½°ï¾ƒï¾ï¾šï½°ï¾™ç ´æ"}]}
      }
    };

    // ============================================
    // IndexedDB
    // ============================================
    const DB_NAME = 'flashnap';
    const DB_VERSION = 2;
    let db = null;

    async function initDB() {
      return new Promise((resolve, reject) => {
        const request = indexedDB.open(DB_NAME, DB_VERSION);

        request.onerror = () => reject(request.error);
        request.onsuccess = () => {
          db = request.result;
          resolve(db);
        };

        request.onupgradeneeded = (event) => {
          const database = event.target.result;

          // èª¿æŸ»
          if (!database.objectStoreNames.contains('surveys')) {
            const surveys = database.createObjectStore('surveys', { keyPath: 'id' });
            surveys.createIndex('createdAt', 'createdAt');
          }

          // éšå±¤ãƒãƒ¼ãƒ‰
          if (!database.objectStoreNames.contains('nodes')) {
            const nodes = database.createObjectStore('nodes', { keyPath: 'id' });
            nodes.createIndex('surveyId', 'surveyId');
            nodes.createIndex('parentId', 'parentId');
          }

          // æ’®å½±è¨˜éŒ²
          if (!database.objectStoreNames.contains('records')) {
            const records = database.createObjectStore('records', { keyPath: 'id' });
            records.createIndex('surveyId', 'surveyId');
            records.createIndex('nodeId', 'nodeId');
          }

          // å†™çœŸãƒã‚¤ãƒŠãƒª
          if (!database.objectStoreNames.contains('photos')) {
            database.createObjectStore('photos', { keyPath: 'id' });
          }

          // ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
          if (!database.objectStoreNames.contains('templates')) {
            database.createObjectStore('templates', { keyPath: 'id' });
          }

          // è¨­å®š
          if (!database.objectStoreNames.contains('settings')) {
            database.createObjectStore('settings', { keyPath: 'key' });
          }

          // åŒæœŸã‚­ãƒ¥ãƒ¼ (v2ã§è¿½åŠ )
          if (!database.objectStoreNames.contains('syncQueue')) {
            const syncQueue = database.createObjectStore('syncQueue', { keyPath: 'id' });
            syncQueue.createIndex('status', 'status');
          }
        };
      });
    }

    // DBæ±ç”¨æ“ä½œ
    function dbOperation(storeName, mode, operation) {
      return new Promise((resolve, reject) => {
        const transaction = db.transaction(storeName, mode);
        const store = transaction.objectStore(storeName);
        const request = operation(store);
        request.onsuccess = () => resolve(request.result);
        request.onerror = () => reject(request.error);
      });
    }

    async function dbGetAll(storeName) {
      return dbOperation(storeName, 'readonly', store => store.getAll());
    }

    async function dbGet(storeName, key) {
      return dbOperation(storeName, 'readonly', store => store.get(key));
    }

    async function dbPut(storeName, data) {
      return dbOperation(storeName, 'readwrite', store => store.put(data));
    }

    async function dbDelete(storeName, key) {
      return dbOperation(storeName, 'readwrite', store => store.delete(key));
    }

    async function dbGetByIndex(storeName, indexName, value) {
      return new Promise((resolve, reject) => {
        const transaction = db.transaction(storeName, 'readonly');
        const store = transaction.objectStore(storeName);
        const index = store.index(indexName);
        const request = index.getAll(value);
        request.onsuccess = () => resolve(request.result);
        request.onerror = () => reject(request.error);
      });
    }

    async function dbClear(storeName) {
      return dbOperation(storeName, 'readwrite', store => store.clear());
    }

    // ============================================
    // çŠ¶æ…‹ç®¡ç†
    // ============================================
    let state = {
      currentSurveyId: null,
      currentNodeId: null,
      lastRecordId: null,
      lastMetadata: null,
      surveys: [],
      nodes: [],
      records: [],
      templates: [],
      settings: {
        darkMode: false,
        digits: 3,
        startNum: 1,
        zeroPad: true,
        prefix: '',
        separator: '-',
        googleDrive: {
          enabled: false,
          accessToken: null,
          tokenExpiry: null,
          folderId: null
        },
        downloadToDevice: false
      }
    };

    // ============================================
    // Google Drive è¨­å®š
    // ============================================
    const GOOGLE_CLIENT_ID = '347827958454-f2uo1m6fehbcdeq90mkf9uajb0j47cvf.apps.googleusercontent.com';
    const GOOGLE_SCOPES = 'https://www.googleapis.com/auth/drive.file';
    let gapiInited = false;
    let gisInited = false;
    let tokenClient = null;

    // ============================================
    // Google Drive èªè¨¼
    // ============================================
    function initGapi() {
      return new Promise((resolve) => {
        if (typeof gapi === 'undefined') {
          console.log('GAPI not loaded yet');
          resolve(false);
          return;
        }
        gapi.load('client', async () => {
          await gapi.client.init({});
          gapiInited = true;
          console.log('GAPI initialized');
          resolve(true);
        });
      });
    }

    function initGis() {
      return new Promise((resolve) => {
        if (typeof google === 'undefined' || !google.accounts) {
          console.log('GIS not loaded yet');
          resolve(false);
          return;
        }
        tokenClient = google.accounts.oauth2.initTokenClient({
          client_id: GOOGLE_CLIENT_ID,
          scope: GOOGLE_SCOPES,
          callback: (response) => {
            if (response.error) {
              console.error('Token error:', response);
              return;
            }
            // ãƒˆãƒ¼ã‚¯ãƒ³å–å¾—æˆåŠŸ
            state.settings.googleDrive.accessToken = response.access_token;
            state.settings.googleDrive.tokenExpiry = Date.now() + (response.expires_in * 1000);
            state.settings.googleDrive.enabled = true;
            saveGoogleDriveSettings();
            updateGoogleDriveUI();
            // åŒæœŸã‚­ãƒ¥ãƒ¼å‡¦ç†é–‹å§‹
            processSyncQueue();
          }
        });
        gisInited = true;
        console.log('GIS initialized');
        resolve(true);
      });
    }

    async function connectGoogleDrive() {
      if (!gapiInited || !gisInited) {
        await initGapi();
        await initGis();
      }
      if (!gapiInited || !gisInited) {
        alert('Google APIã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ãƒšãƒ¼ã‚¸ã‚’å†èª­ã¿è¾¼ã¿ã—ã¦ãã ã•ã„ã€‚');
        return;
      }
      if (GOOGLE_CLIENT_ID === 'YOUR_CLIENT_ID.apps.googleusercontent.com') {
        alert('Google Driveé€£æºã‚’ä½¿ç”¨ã™ã‚‹ã«ã¯ã€GOOGLE_CLIENT_IDã‚’è¨­å®šã—ã¦ãã ã•ã„ã€‚');
        return;
      }
      tokenClient.requestAccessToken({ prompt: 'consent' });
    }

    async function disconnectGoogleDrive() {
      if (!confirm('Google Driveã¨ã®æ¥ç¶šã‚’è§£é™¤ã—ã¾ã™ã‹ï¼Ÿ')) return;

      if (state.settings.googleDrive.accessToken) {
        google.accounts.oauth2.revoke(state.settings.googleDrive.accessToken);
      }
      state.settings.googleDrive = {
        enabled: false,
        accessToken: null,
        tokenExpiry: null,
        folderId: null
      };
      await saveGoogleDriveSettings();
      updateGoogleDriveUI();
    }

    async function refreshTokenIfNeeded() {
      if (!state.settings.googleDrive.enabled) return false;
      // ãƒˆãƒ¼ã‚¯ãƒ³æœ‰åŠ¹æœŸé™ã®5åˆ†å‰ã«ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥
      if (state.settings.googleDrive.tokenExpiry &&
          Date.now() > state.settings.googleDrive.tokenExpiry - 300000) {
        return new Promise((resolve) => {
          tokenClient.requestAccessToken({ prompt: '' });
          // callbackã§å‡¦ç†ã•ã‚Œã‚‹ã®ã§ã€å°‘ã—å¾…ã¤
          setTimeout(() => resolve(true), 1000);
        });
      }
      return true;
    }

    async function saveGoogleDriveSettings() {
      await dbPut('settings', { key: 'googleDrive', ...state.settings.googleDrive });
    }

    function updateGoogleDriveUI() {
      const statusEl = $('googleDriveStatus');
      const connectBtn = $('btnConnectGoogleDrive');
      const disconnectBtn = $('btnDisconnectGoogleDrive');
      const syncBtn = $('btnSyncNow');

      if (state.settings.googleDrive.enabled) {
        statusEl.textContent = 'æ¥ç¶šä¸­';
        statusEl.style.color = 'var(--success)';
        connectBtn.classList.add('hidden');
        disconnectBtn.classList.remove('hidden');
        syncBtn.classList.remove('hidden');
      } else {
        statusEl.textContent = 'æœªæ¥ç¶š';
        statusEl.style.color = 'var(--text-secondary)';
        connectBtn.classList.remove('hidden');
        disconnectBtn.classList.add('hidden');
        syncBtn.classList.add('hidden');
      }
      updateSyncQueueUI();
    }

    async function updateSyncQueueUI() {
      const queueStatusEl = $('syncQueueStatus');
      const queueCountEl = $('syncQueueCount');
      if (!state.settings.googleDrive.enabled) {
        queueStatusEl.classList.add('hidden');
        return;
      }
      const queue = await dbGetAll('syncQueue');
      if (queue.length > 0) {
        queueStatusEl.classList.remove('hidden');
        const pending = queue.filter(q => q.status === 'pending' || q.status === 'retry').length;
        const failed = queue.filter(q => q.status === 'failed').length;
        const uploading = queue.filter(q => q.status === 'uploading').length;
        let text = `${pending}ä»¶å¾…æ©Ÿä¸­`;
        if (uploading > 0) text += ` / ${uploading}ä»¶ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ä¸­`;
        if (failed > 0) text += ` / ${failed}ä»¶å¤±æ•—`;
        queueCountEl.textContent = text;
      } else {
        queueStatusEl.classList.add('hidden');
      }
    }

    async function syncNowWithFeedback() {
      const queue = await dbGetAll('syncQueue');
      const pending = queue.filter(q => q.status === 'pending' || q.status === 'retry' || q.status === 'failed');
      if (pending.length === 0) {
        alert('åŒæœŸã™ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ãŒã‚ã‚Šã¾ã›ã‚“');
        return;
      }
      // å¤±æ•—ã—ãŸã‚‚ã®ã‚’ãƒªãƒˆãƒ©ã‚¤çŠ¶æ…‹ã«æˆ»ã™
      for (const item of queue.filter(q => q.status === 'failed')) {
        item.status = 'retry';
        item.retryCount = 0;
        await dbPut('syncQueue', item);
      }
      alert(`${pending.length}ä»¶ã®åŒæœŸã‚’é–‹å§‹ã—ã¾ã™`);
      await processSyncQueue();
      await updateSyncQueueUI();
      const remaining = await dbGetAll('syncQueue');
      if (remaining.length === 0) {
        alert('åŒæœŸå®Œäº†ï¼');
      } else {
        const failed = remaining.filter(q => q.status === 'failed');
        if (failed.length > 0) {
          const errorMsg = failed[0].lastError || 'ä¸æ˜ãªã‚¨ãƒ©ãƒ¼';
          alert(`${failed.length}ä»¶ã®åŒæœŸã«å¤±æ•—\n\nã‚¨ãƒ©ãƒ¼: ${errorMsg}`);
        }
      }
    }

    async function clearSyncQueue() {
      if (!confirm('åŒæœŸã‚­ãƒ¥ãƒ¼ã‚’ã™ã¹ã¦ã‚¯ãƒªã‚¢ã—ã¾ã™ã‹ï¼Ÿ')) return;
      await dbClear('syncQueue');
      await updateSyncQueueUI();
      alert('åŒæœŸã‚­ãƒ¥ãƒ¼ã‚’ã‚¯ãƒªã‚¢ã—ã¾ã—ãŸ');
    }

    // ============================================
    // Google Drive ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
    // ============================================
    async function ensureFlashnapFolder() {
      if (state.settings.googleDrive.folderId) {
        return state.settings.googleDrive.folderId;
      }

      await refreshTokenIfNeeded();
      const token = state.settings.googleDrive.accessToken;

      // Flashnapãƒ•ã‚©ãƒ«ãƒ€ã‚’æ¤œç´¢
      const searchRes = await fetch(
        `https://www.googleapis.com/drive/v3/files?q=name='Flashnap' and mimeType='application/vnd.google-apps.folder' and trashed=false`,
        { headers: { 'Authorization': `Bearer ${token}` } }
      );
      const searchData = await searchRes.json();

      if (searchData.files && searchData.files.length > 0) {
        state.settings.googleDrive.folderId = searchData.files[0].id;
        await saveGoogleDriveSettings();
        return state.settings.googleDrive.folderId;
      }

      // ãƒ•ã‚©ãƒ«ãƒ€ä½œæˆ
      const createRes = await fetch('https://www.googleapis.com/drive/v3/files', {
        method: 'POST',
        headers: {
          'Authorization': `Bearer ${token}`,
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          name: 'Flashnap',
          mimeType: 'application/vnd.google-apps.folder'
        })
      });
      const folder = await createRes.json();
      state.settings.googleDrive.folderId = folder.id;
      await saveGoogleDriveSettings();
      return folder.id;
    }

    async function ensureSurveyFolder(surveyName, parentFolderId) {
      await refreshTokenIfNeeded();
      const token = state.settings.googleDrive.accessToken;

      // èª¿æŸ»ãƒ•ã‚©ãƒ«ãƒ€ã‚’æ¤œç´¢
      const searchRes = await fetch(
        `https://www.googleapis.com/drive/v3/files?q=name='${surveyName.replace(/'/g, "\\'")}' and '${parentFolderId}' in parents and mimeType='application/vnd.google-apps.folder' and trashed=false`,
        { headers: { 'Authorization': `Bearer ${token}` } }
      );
      const searchData = await searchRes.json();

      if (searchData.files && searchData.files.length > 0) {
        return searchData.files[0].id;
      }

      // ãƒ•ã‚©ãƒ«ãƒ€ä½œæˆ
      const createRes = await fetch('https://www.googleapis.com/drive/v3/files', {
        method: 'POST',
        headers: {
          'Authorization': `Bearer ${token}`,
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          name: surveyName,
          mimeType: 'application/vnd.google-apps.folder',
          parents: [parentFolderId]
        })
      });
      const folder = await createRes.json();
      return folder.id;
    }

    async function uploadToDrive(recordId, filename, surveyName) {
      await refreshTokenIfNeeded();
      const token = state.settings.googleDrive.accessToken;

      // å†™çœŸãƒ‡ãƒ¼ã‚¿å–å¾—
      const photo = await dbGet('photos', recordId);
      if (!photo) throw new Error('Photo not found');

      // ãƒ•ã‚©ãƒ«ãƒ€ç¢ºä¿
      const flashnapFolderId = await ensureFlashnapFolder();
      const surveyFolderId = await ensureSurveyFolder(surveyName, flashnapFolderId);

      // Base64ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
      const base64 = photo.dataUrl.split(',')[1];

      // multipart/relatedå½¢å¼ã§ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’æ§‹ç¯‰
      const boundary = 'flashnap_boundary_' + Date.now();
      const metadata = {
        name: filename,
        parents: [surveyFolderId]
      };

      const body =
        `--${boundary}\r\n` +
        `Content-Type: application/json; charset=UTF-8\r\n\r\n` +
        `${JSON.stringify(metadata)}\r\n` +
        `--${boundary}\r\n` +
        `Content-Type: image/jpeg\r\n` +
        `Content-Transfer-Encoding: base64\r\n\r\n` +
        `${base64}\r\n` +
        `--${boundary}--`;

      const uploadRes = await fetch(
        'https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart',
        {
          method: 'POST',
          headers: {
            'Authorization': `Bearer ${token}`,
            'Content-Type': `multipart/related; boundary=${boundary}`
          },
          body: body
        }
      );

      if (!uploadRes.ok) {
        const errorText = await uploadRes.text();
        throw new Error(`Upload failed: ${uploadRes.status} - ${errorText}`);
      }

      return await uploadRes.json();
    }

    async function addToSyncQueue(recordId, filename, surveyName) {
      const queueItem = {
        id: generateId(),
        recordId,
        filename,
        surveyName,
        status: 'pending',
        retryCount: 0,
        createdAt: Date.now()
      };
      await dbPut('syncQueue', queueItem);

      // ã‚ªãƒ³ãƒ©ã‚¤ãƒ³ãªã‚‰å³åº§ã«å‡¦ç†
      if (navigator.onLine && state.settings.googleDrive.enabled) {
        processSyncQueue();
      }
    }

    let isSyncing = false;

    async function processSyncQueue() {
      if (isSyncing) return;
      if (!state.settings.googleDrive.enabled) return;
      if (!navigator.onLine) return;

      isSyncing = true;

      try {
        const queue = await dbGetAll('syncQueue');
        const pending = queue.filter(item => item.status === 'pending' || item.status === 'retry');

        for (const item of pending) {
          try {
            // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ›´æ–°
            item.status = 'uploading';
            await dbPut('syncQueue', item);

            // ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
            await uploadToDrive(item.recordId, item.filename, item.surveyName);

            // æˆåŠŸã—ãŸã‚‰ã‚­ãƒ¥ãƒ¼ã‹ã‚‰å‰Šé™¤
            await dbDelete('syncQueue', item.id);
            console.log(`Uploaded: ${item.filename}`);
          } catch (error) {
            console.error(`Upload failed: ${item.filename}`, error);
            item.retryCount++;
            item.lastError = error.message;
            if (item.retryCount >= 3) {
              item.status = 'failed';
            } else {
              item.status = 'retry';
            }
            await dbPut('syncQueue', item);
          }
        }
      } finally {
        isSyncing = false;
      }
    }

    // ã‚ªãƒ³ãƒ©ã‚¤ãƒ³å¾©å¸°æ™‚ã«åŒæœŸ
    window.addEventListener('online', () => {
      if (state.settings.googleDrive.enabled) {
        processSyncQueue();
      }
    });

    // ============================================
    // ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°
    // ============================================
    function generateId() {
      return Date.now().toString(36) + Math.random().toString(36).substr(2);
    }

    function buildHierarchyTree(nodes, parentId = null) {
      return nodes
        .filter(n => n.parentId === parentId)
        .sort((a, b) => a.order - b.order)
        .map(node => ({
          ...node,
          children: buildHierarchyTree(nodes, node.id)
        }));
    }

    function buildBreadcrumbs(nodeId, nodesMap) {
      const crumbs = [];
      let current = nodesMap.get(nodeId);
      while (current) {
        crumbs.unshift(current);
        current = current.parentId ? nodesMap.get(current.parentId) : null;
      }
      return crumbs;
    }

    function getHierarchyNames(nodeId, nodesMap) {
      return buildBreadcrumbs(nodeId, nodesMap).map(n => n.name);
    }

    function formatNumber(num, settings) {
      const s = settings || state.settings;
      let result = num.toString();
      if (s.zeroPad) {
        result = result.padStart(s.digits, '0');
      }
      return (s.prefix || '') + result;
    }

    function getNextNumber(nodeId) {
      const records = state.records.filter(r =>
        r.surveyId === state.currentSurveyId && r.nodeId === nodeId
      );
      if (records.length === 0) {
        return getSurveySettings().startNum;
      }
      return Math.max(...records.map(r => r.number)) + 1;
    }

    function getSurveySettings() {
      const survey = state.surveys.find(s => s.id === state.currentSurveyId);
      const defaults = state.settings;
      if (!survey || !survey.settings) return defaults;
      return {
        digits: survey.settings.digits ?? defaults.digits,
        startNum: survey.settings.startNum ?? defaults.startNum,
        zeroPad: survey.settings.zeroPad ?? defaults.zeroPad,
        prefix: survey.settings.prefix ?? defaults.prefix,
        separator: survey.settings.separator ?? defaults.separator
      };
    }

    function getNodesMap() {
      return new Map(state.nodes.map(n => [n.id, n]));
    }

    // ============================================
    // UI ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
    // ============================================
    const $ = id => document.getElementById(id);

    function showScreen(screenId) {
      $('surveyScreen').classList.toggle('hidden', screenId !== 'survey');
      $('captureScreen').classList.toggle('hidden', screenId !== 'capture');
    }

    function renderSurveyList() {
      const list = $('surveyList');
      if (state.surveys.length === 0) {
        list.innerHTML = `
          <div class="empty-state">
            <div class="empty-state-icon">ğŸ“‹</div>
            <p>èª¿æŸ»ãŒã‚ã‚Šã¾ã›ã‚“</p>
            <p>æ–°è¦èª¿æŸ»ã‚’ä½œæˆã—ã¦ãã ã•ã„</p>
          </div>
        `;
        return;
      }

      list.innerHTML = state.surveys
        .sort((a, b) => b.createdAt - a.createdAt)
        .map(survey => {
          const photoCount = state.records.filter(r => r.surveyId === survey.id).length;
          const nodeCount = state.nodes.filter(n => n.surveyId === survey.id).length;
          return `
            <div class="survey-item ${survey.id === state.currentSurveyId ? 'active' : ''}"
                 data-id="${survey.id}">
              <div class="survey-info">
                <h3>${escapeHtml(survey.name)}</h3>
                <p>å†™çœŸ: ${photoCount}æš / éšå±¤: ${nodeCount}</p>
              </div>
              <div class="survey-actions">
                <button class="btn btn-icon btn-edit-survey" data-id="${survey.id}">âœï¸</button>
                <button class="btn btn-icon btn-delete-survey" data-id="${survey.id}">ğŸ—‘ï¸</button>
              </div>
            </div>
          `;
        }).join('');

      // ã‚¤ãƒ™ãƒ³ãƒˆè¨­å®š
      list.querySelectorAll('.survey-item').forEach(item => {
        item.addEventListener('click', (e) => {
          if (e.target.closest('.btn')) return;
          selectSurvey(item.dataset.id);
        });
      });

      list.querySelectorAll('.btn-edit-survey').forEach(btn => {
        btn.addEventListener('click', (e) => {
          e.stopPropagation();
          openSurveyModal(btn.dataset.id);
        });
      });

      list.querySelectorAll('.btn-delete-survey').forEach(btn => {
        btn.addEventListener('click', (e) => {
          e.stopPropagation();
          deleteSurvey(btn.dataset.id);
        });
      });
    }

    function renderBreadcrumbs() {
      const container = $('breadcrumbs');
      const nodesMap = getNodesMap();

      // èª¿æŸ»ã«æˆ»ã‚‹ãƒªãƒ³ã‚¯
      const survey = state.surveys.find(s => s.id === state.currentSurveyId);
      let html = `<span class="breadcrumb-item" data-id="survey">${escapeHtml(survey?.name || 'èª¿æŸ»')}</span>`;

      if (state.currentNodeId) {
        const crumbs = buildBreadcrumbs(state.currentNodeId, nodesMap);
        crumbs.forEach((node, i) => {
          html += `<span class="breadcrumb-separator">â€º</span>`;
          html += `<span class="breadcrumb-item" data-id="${node.id}">${escapeHtml(node.name)}</span>`;
        });
      }

      container.innerHTML = html;

      // ã‚¤ãƒ™ãƒ³ãƒˆè¨­å®š
      container.querySelectorAll('.breadcrumb-item').forEach(item => {
        item.addEventListener('click', () => {
          if (item.dataset.id === 'survey') {
            // æ’®å½±ç”»é¢ã‚’ç¶­æŒã—ã€ãƒ«ãƒ¼ãƒˆéšå±¤ã§æ’®å½±å¯èƒ½ã«
            state.currentNodeId = null;
            state.lastRecordId = null;
            renderBreadcrumbs();
            renderNodeList();
            renderLandscapeTree();
            renderCaptureSection();
          } else {
            navigateToNode(item.dataset.id);
          }
        });
      });
    }

    function renderNodeList() {
      const container = $('nodeList');
      const surveyNodes = state.nodes.filter(n => n.surveyId === state.currentSurveyId);
      const children = surveyNodes.filter(n => n.parentId === state.currentNodeId);

      if (children.length === 0) {
        container.innerHTML = `
          <div class="empty-state">
            <div class="empty-state-icon">ğŸ“</div>
            <p>éšå±¤ãŒã‚ã‚Šã¾ã›ã‚“</p>
          </div>
        `;
        return;
      }

      container.innerHTML = children
        .sort((a, b) => a.order - b.order)
        .map(node => {
          const photoCount = state.records.filter(r => r.nodeId === node.id).length;
          const hasChildren = surveyNodes.some(n => n.parentId === node.id);
          return `
            <div class="node-item" data-id="${node.id}">
              <div>
                <span class="node-name">${escapeHtml(node.name)}</span>
                <span class="node-count">${photoCount}æš ${hasChildren ? 'â–¶' : ''}</span>
              </div>
              <div class="node-actions">
                <button class="btn btn-icon btn-edit-node" data-id="${node.id}">âœï¸</button>
                <button class="btn btn-icon btn-delete-node" data-id="${node.id}">ğŸ—‘ï¸</button>
              </div>
            </div>
          `;
        }).join('');

      // ã‚¤ãƒ™ãƒ³ãƒˆè¨­å®š
      container.querySelectorAll('.node-item').forEach(item => {
        item.addEventListener('click', (e) => {
          if (e.target.closest('.btn')) return;
          navigateToNode(item.dataset.id);
        });
      });

      container.querySelectorAll('.btn-edit-node').forEach(btn => {
        btn.addEventListener('click', (e) => {
          e.stopPropagation();
          openNodeModal(btn.dataset.id);
        });
      });

      container.querySelectorAll('.btn-delete-node').forEach(btn => {
        btn.addEventListener('click', (e) => {
          e.stopPropagation();
          deleteNode(btn.dataset.id);
        });
      });
    }

    // æ¨ªæŒã¡å°‚ç”¨ãƒ„ãƒªãƒ¼è¡¨ç¤ºï¼ˆèª¿æŸ»ä¸€è¦§ + éšå±¤ï¼‰
    function renderLandscapeTree() {
      const container = $('landscapeTree');
      let html = '';

      // èª¿æŸ»ä¸€è¦§
      state.surveys.sort((a, b) => b.createdAt - a.createdAt).forEach(survey => {
        const isCurrentSurvey = survey.id === state.currentSurveyId;
        const isRootSelected = isCurrentSurvey && state.currentNodeId === null;
        const photoCount = state.records.filter(r => r.surveyId === survey.id).length;

        html += `
          <div class="tree-item tree-survey ${isRootSelected ? 'selected' : ''} ${isCurrentSurvey ? 'current' : ''}" data-survey-id="${survey.id}">
            <span class="tree-item-name">ğŸ“‹ ${escapeHtml(survey.name)}</span>
            <span class="tree-item-count">${photoCount}</span>
          </div>
        `;

        // ç¾åœ¨ã®èª¿æŸ»ã®å ´åˆã€éšå±¤ã‚’è¡¨ç¤º
        if (isCurrentSurvey) {
          const surveyNodes = state.nodes.filter(n => n.surveyId === survey.id);

          // ãƒ„ãƒªãƒ¼æ§‹é€ ã‚’å†å¸°çš„ã«æç”»
          function renderNode(node, depth) {
            const photoCount = state.records.filter(r => r.nodeId === node.id).length;
            const isSelected = node.id === state.currentNodeId;
            const indent = depth * 10 + 16;

            let nodeHtml = `
              <div class="tree-item tree-node ${isSelected ? 'selected' : ''}" data-node-id="${node.id}" style="padding-left: ${indent}px;">
                <span class="tree-item-name">ğŸ“ ${escapeHtml(node.name)}</span>
                <span class="tree-item-count">${photoCount}</span>
              </div>
            `;

            const children = surveyNodes.filter(n => n.parentId === node.id).sort((a, b) => a.order - b.order);
            children.forEach(child => {
              nodeHtml += renderNode(child, depth + 1);
            });

            return nodeHtml;
          }

          const rootNodes = surveyNodes.filter(n => n.parentId === null).sort((a, b) => a.order - b.order);
          rootNodes.forEach(node => {
            html += renderNode(node, 1);
          });
        }
      });

      container.innerHTML = html || '<p style="color: var(--text-secondary); font-size: 0.8rem; padding: 8px;">èª¿æŸ»ãŒã‚ã‚Šã¾ã›ã‚“</p>';

      // èª¿æŸ»ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆï¼ˆã‚¿ãƒƒãƒ—ã§ãƒ«ãƒ¼ãƒˆéšå±¤ã‚’é¸æŠï¼‰
      container.querySelectorAll('.tree-survey').forEach(item => {
        item.addEventListener('click', () => {
          const surveyId = item.dataset.surveyId;
          if (surveyId !== state.currentSurveyId) {
            selectSurvey(surveyId);
          } else {
            // ç¾åœ¨ã®èª¿æŸ»ã‚’ã‚¿ãƒƒãƒ— â†’ ãƒ«ãƒ¼ãƒˆéšå±¤ã‚’é¸æŠ
            state.currentNodeId = null;
            state.lastRecordId = null;
            renderBreadcrumbs();
            renderNodeList();
            renderLandscapeTree();
            renderCaptureSection();
          }
        });
      });

      // éšå±¤ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆ
      container.querySelectorAll('.tree-node').forEach(item => {
        item.addEventListener('click', () => {
          selectNodeForCapture(item.dataset.nodeId);
        });
      });
    }

    // æ¨ªæŒã¡æ™‚ï¼šéšå±¤ã‚’é¸æŠã—ã¦æ’®å½±å¯¾è±¡ã«è¨­å®š
    function selectNodeForCapture(nodeId) {
      state.currentNodeId = nodeId;
      state.lastRecordId = null;
      renderBreadcrumbs();
      renderNodeList();
      renderLandscapeTree();
      renderCaptureSection();
    }

    function renderCaptureSection() {
      const nodesMap = getNodesMap();
      const settings = getSurveySettings();
      const survey = state.surveys.find(s => s.id === state.currentSurveyId);

      // ç¾åœ¨ã®ç•ªå·
      const nextNum = getNextNumber(state.currentNodeId);
      $('currentNumber').textContent = formatNumber(nextNum, settings);

      // ãƒ‘ã‚¹è¡¨ç¤º
      if (state.currentNodeId) {
        const names = getHierarchyNames(state.currentNodeId, nodesMap);
        $('currentPath').textContent = names.join(settings.separator);
      } else {
        $('currentPath').textContent = survey?.name || 'èª¿æŸ»';
      }

      // ç¾åœ¨ã®éšå±¤ã®æ’®å½±æšæ•°
      const count = state.records.filter(r =>
        r.surveyId === state.currentSurveyId && r.nodeId === state.currentNodeId
      ).length;
      $('currentCount').textContent = `${count}æšæ’®å½±æ¸ˆã¿`;

      // å–ã‚Šæ¶ˆã—ãƒœã‚¿ãƒ³ï¼ˆç¸¦å‘ããƒ»æ¨ªå‘ãä¸¡æ–¹ã‚’åŒæœŸï¼‰
      $('btnUndo').classList.toggle('hidden', !state.lastRecordId);
      $('btnUndoLandscape').classList.toggle('hidden', !state.lastRecordId);

      // ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚»ã‚¯ã‚·ãƒ§ãƒ³è¡¨ç¤ºåˆ¶å¾¡
      if (survey?.type && SURVEY_TYPES[survey.type]) {
        $('metadataSection').classList.remove('hidden');
        renderMetadataForm(survey.type);
      } else {
        $('metadataSection').classList.add('hidden');
      }
    }

    function renderRecentList() {
      const container = $('recentList');
      const surveyRecords = state.records
        .filter(r => r.surveyId === state.currentSurveyId)
        .sort((a, b) => b.createdAt - a.createdAt)
        .slice(0, 10);

      if (surveyRecords.length === 0) {
        container.innerHTML = '<p style="color: var(--text-secondary);">ã¾ã æ’®å½±ãŒã‚ã‚Šã¾ã›ã‚“</p>';
        return;
      }

      container.innerHTML = '';
      surveyRecords.forEach(async record => {
        const photo = await dbGet('photos', record.id);
        if (!photo) return;

        const div = document.createElement('div');
        div.className = 'recent-item';
        div.innerHTML = `
          <img src="${photo.dataUrl}" alt="${record.filename}">
          <div class="recent-item-name">${escapeHtml(record.filename)}</div>
        `;
        container.appendChild(div);
      });
    }

    function renderTemplateList() {
      const container = $('templateList');
      if (state.templates.length === 0) {
        container.innerHTML = '<p style="color: var(--text-secondary);">ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãŒã‚ã‚Šã¾ã›ã‚“</p>';
        return;
      }

      container.innerHTML = state.templates.map(t => `
        <div class="template-item">
          <span>${escapeHtml(t.name)}</span>
          <button class="btn btn-icon btn-delete-template" data-id="${t.id}">ğŸ—‘ï¸</button>
        </div>
      `).join('');

      container.querySelectorAll('.btn-delete-template').forEach(btn => {
        btn.addEventListener('click', () => deleteTemplate(btn.dataset.id));
      });
    }

    function renderTemplateSelect() {
      const select = $('templateSelect');
      select.innerHTML = '<option value="">ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãªã—</option>' +
        state.templates.map(t => `<option value="${t.id}">${escapeHtml(t.name)}</option>`).join('');
    }

    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    // ============================================
    // èª¿æŸ»æ“ä½œ
    // ============================================
    async function selectSurvey(surveyId) {
      state.currentSurveyId = surveyId;
      state.currentNodeId = null;
      state.lastRecordId = null;
      _metadataInitialized = false;

      // ãƒ˜ãƒƒãƒ€ãƒ¼ã¯Flashnapã®ã¾ã¾ã€æˆ»ã‚‹ãƒœã‚¿ãƒ³ã‚‚éè¡¨ç¤ºï¼ˆãƒ‘ãƒ³ããšã§æˆ»ã‚Œã‚‹ï¼‰

      showScreen('capture');
      renderBreadcrumbs();
      renderNodeList();
      renderLandscapeTree();
      renderCaptureSection();
      renderRecentList();
    }

    function openSurveyModal(surveyId = null) {
      const modal = $('surveyModal');
      const isEdit = !!surveyId;

      $('surveyModalTitle').textContent = isEdit ? 'èª¿æŸ»ã‚’ç·¨é›†' : 'æ–°è¦èª¿æŸ»';

      if (isEdit) {
        const survey = state.surveys.find(s => s.id === surveyId);
        $('surveyName').value = survey.name;
        $('surveyType').value = survey.type || '';
        $('templateSelect').value = '';
        if (survey.settings) {
          $('surveyDigits').value = survey.settings.digits || '';
          $('surveyStartNum').value = survey.settings.startNum ?? '';
          $('surveyPrefix').value = survey.settings.prefix || '';
          $('surveySeparator').value = survey.settings.separator ?? '';
          $('surveyZeroPad').checked = survey.settings.zeroPad ?? true;
        }
      } else {
        $('surveyName').value = '';
        $('surveyType').value = '';
        $('templateSelect').value = '';
        $('surveyDigits').value = '';
        $('surveyStartNum').value = '';
        $('surveyPrefix').value = '';
        $('surveySeparator').value = '';
        $('surveyZeroPad').checked = true;
      }

      modal.dataset.editId = surveyId || '';
      renderTemplateSelect();
      modal.classList.add('active');
    }

    async function saveSurvey() {
      const modal = $('surveyModal');
      const editId = modal.dataset.editId;
      const name = $('surveyName').value.trim();

      if (!name) {
        alert('èª¿æŸ»åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
        return;
      }

      const settings = {};
      if ($('surveyDigits').value) settings.digits = parseInt($('surveyDigits').value);
      if ($('surveyStartNum').value !== '') settings.startNum = parseInt($('surveyStartNum').value);
      if ($('surveyPrefix').value) settings.prefix = $('surveyPrefix').value;
      if ($('surveySeparator').value !== '') settings.separator = $('surveySeparator').value;
      settings.zeroPad = $('surveyZeroPad').checked;

      const surveyType = $('surveyType').value || null;

      if (editId) {
        // ç·¨é›†
        const survey = state.surveys.find(s => s.id === editId);
        survey.name = name;
        survey.type = surveyType;
        survey.settings = Object.keys(settings).length > 0 ? settings : null;
        await dbPut('surveys', survey);
      } else {
        // æ–°è¦ä½œæˆ
        const survey = {
          id: generateId(),
          name,
          type: surveyType,
          settings: Object.keys(settings).length > 0 ? settings : null,
          createdAt: Date.now()
        };
        await dbPut('surveys', survey);
        state.surveys.push(survey);

        // ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆé©ç”¨
        const templateId = $('templateSelect').value;
        if (templateId) {
          await applyTemplate(survey.id, templateId);
        }
      }

      modal.classList.remove('active');
      renderSurveyList();
    }

    async function deleteSurvey(surveyId) {
      if (!confirm('ã“ã®èª¿æŸ»ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ\né–¢é€£ã™ã‚‹å…¨ã¦ã®å†™çœŸã¨éšå±¤ã‚‚å‰Šé™¤ã•ã‚Œã¾ã™ã€‚')) return;

      // é–¢é€£ãƒ‡ãƒ¼ã‚¿å‰Šé™¤
      const records = state.records.filter(r => r.surveyId === surveyId);
      for (const record of records) {
        await dbDelete('photos', record.id);
        await dbDelete('records', record.id);
      }
      state.records = state.records.filter(r => r.surveyId !== surveyId);

      const nodes = state.nodes.filter(n => n.surveyId === surveyId);
      for (const node of nodes) {
        await dbDelete('nodes', node.id);
      }
      state.nodes = state.nodes.filter(n => n.surveyId !== surveyId);

      await dbDelete('surveys', surveyId);
      state.surveys = state.surveys.filter(s => s.id !== surveyId);

      if (state.currentSurveyId === surveyId) {
        state.currentSurveyId = null;
        state.currentNodeId = null;
      }

      renderSurveyList();
    }

    // ============================================
    // éšå±¤æ“ä½œ
    // ============================================
    function navigateToNode(nodeId) {
      state.currentNodeId = nodeId;
      state.lastRecordId = null;
      renderBreadcrumbs();
      renderNodeList();
      renderLandscapeTree();
      renderCaptureSection();
    }

    function openNodeModal(nodeId = null) {
      const modal = $('nodeModal');
      const isEdit = !!nodeId;

      $('nodeModalTitle').textContent = isEdit ? 'éšå±¤ã‚’ç·¨é›†' : 'éšå±¤ã‚’è¿½åŠ ';

      if (isEdit) {
        const node = state.nodes.find(n => n.id === nodeId);
        $('nodeName').value = node.name;
      } else {
        $('nodeName').value = '';
      }

      modal.dataset.editId = nodeId || '';
      modal.classList.add('active');
    }

    async function saveNode() {
      const modal = $('nodeModal');
      const editId = modal.dataset.editId;
      const name = $('nodeName').value.trim();

      if (!name) {
        alert('éšå±¤åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
        return;
      }

      if (editId) {
        // ç·¨é›†
        const node = state.nodes.find(n => n.id === editId);
        node.name = name;
        await dbPut('nodes', node);
      } else {
        // æ–°è¦ä½œæˆ
        const siblings = state.nodes.filter(n =>
          n.surveyId === state.currentSurveyId && n.parentId === state.currentNodeId
        );
        const node = {
          id: generateId(),
          surveyId: state.currentSurveyId,
          parentId: state.currentNodeId,
          name,
          order: siblings.length,
          createdAt: Date.now()
        };
        await dbPut('nodes', node);
        state.nodes.push(node);
      }

      modal.classList.remove('active');
      renderNodeList();
      renderLandscapeTree();
    }

    async function deleteNode(nodeId) {
      if (!confirm('ã“ã®éšå±¤ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ\nå­éšå±¤ã¨å†™çœŸã‚‚å‰Šé™¤ã•ã‚Œã¾ã™ã€‚')) return;

      // å†å¸°çš„ã«å­ãƒãƒ¼ãƒ‰ã‚’å–å¾—
      const getDescendants = (id) => {
        const children = state.nodes.filter(n => n.parentId === id);
        return [id, ...children.flatMap(c => getDescendants(c.id))];
      };

      const nodeIds = getDescendants(nodeId);

      // é–¢é€£å†™çœŸå‰Šé™¤
      for (const nid of nodeIds) {
        const records = state.records.filter(r => r.nodeId === nid);
        for (const record of records) {
          await dbDelete('photos', record.id);
          await dbDelete('records', record.id);
        }
        state.records = state.records.filter(r => r.nodeId !== nid);
      }

      // ãƒãƒ¼ãƒ‰å‰Šé™¤
      for (const nid of nodeIds) {
        await dbDelete('nodes', nid);
      }
      state.nodes = state.nodes.filter(n => !nodeIds.includes(n.id));

      if (state.currentNodeId === nodeId) {
        const node = state.nodes.find(n => n.id === nodeId);
        state.currentNodeId = node?.parentId || null;
      }

      renderNodeList();
      renderLandscapeTree();
      renderCaptureSection();
    }

    // ============================================
    // æ’®å½±æ©Ÿèƒ½
    // ============================================

    // 4:3ã‚¯ãƒ­ãƒƒãƒ—å‡¦ç†
    function cropTo4by3(dataUrl) {
      return new Promise((resolve) => {
        const img = new Image();
        img.onload = () => {
          const srcW = img.width;
          const srcH = img.height;
          const targetRatio = 4 / 3;
          const srcRatio = srcW / srcH;
          console.log(`å…ƒç”»åƒ: ${srcW}x${srcH} (æ¯”ç‡: ${srcRatio.toFixed(3)}, 4:3=${targetRatio.toFixed(3)})`);

          let cropW, cropH, cropX, cropY;

          if (srcRatio > targetRatio) {
            // æ¨ªé•·ã™ãã‚‹ â†’ å·¦å³ã‚’ã‚«ãƒƒãƒˆ
            cropH = srcH;
            cropW = Math.round(srcH * targetRatio);
            cropX = Math.round((srcW - cropW) / 2);
            cropY = 0;
          } else {
            // ç¸¦é•·ã™ãã‚‹ â†’ ä¸Šä¸‹ã‚’ã‚«ãƒƒãƒˆ
            cropW = srcW;
            cropH = Math.round(srcW / targetRatio);
            cropX = 0;
            cropY = Math.round((srcH - cropH) / 2);
          }

          console.log(`ã‚¯ãƒ­ãƒƒãƒ—å¾Œ: ${cropW}x${cropH} (åˆ‡ã‚Šå–ã‚Šä½ç½®: x=${cropX}, y=${cropY})`);

          const canvas = document.createElement('canvas');
          canvas.width = cropW;
          canvas.height = cropH;
          const ctx = canvas.getContext('2d');
          ctx.drawImage(img, cropX, cropY, cropW, cropH, 0, 0, cropW, cropH);

          resolve(canvas.toDataURL('image/jpeg', 0.92));
        };
        img.src = dataUrl;
      });
    }

    async function handleCapture(file) {
      const nodesMap = getNodesMap();
      const settings = getSurveySettings();
      const survey = state.surveys.find(s => s.id === state.currentSurveyId);
      const nextNum = getNextNumber(state.currentNodeId);

      // ãƒ•ã‚¡ã‚¤ãƒ«åç”Ÿæˆ
      let filename;
      if (state.currentNodeId) {
        const names = getHierarchyNames(state.currentNodeId, nodesMap);
        filename = names.join(settings.separator) + settings.separator + formatNumber(nextNum, settings) + '.jpg';
      } else {
        filename = (survey?.name || 'èª¿æŸ»') + settings.separator + formatNumber(nextNum, settings) + '.jpg';
      }

      // ç”»åƒã‚’DataURLã«å¤‰æ›
      const rawDataUrl = await new Promise((resolve) => {
        const reader = new FileReader();
        reader.onload = (e) => resolve(e.target.result);
        reader.readAsDataURL(file);
      });

      // 4:3ã«ã‚¯ãƒ­ãƒƒãƒ—
      const dataUrl = await cropTo4by3(rawDataUrl);

      // ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿å–å¾—
      const metadata = getMetadataFromForm();

      // è¨˜éŒ²ä¿å­˜
      const record = {
        id: generateId(),
        surveyId: state.currentSurveyId,
        nodeId: state.currentNodeId,
        number: nextNum,
        filename,
        metadata,
        createdAt: Date.now()
      };
      await dbPut('records', record);
      state.records.push(record);

      // å‰å›å€¤ã‚­ãƒ£ãƒªãƒ¼ãƒ•ã‚©ãƒ¯ãƒ¼ãƒ‰
      if (metadata) {
        state.lastMetadata = metadata;
      }

      // å†™çœŸä¿å­˜
      await dbPut('photos', { id: record.id, dataUrl });

      // Google Driveã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ï¼ˆæœ‰åŠ¹ãªå ´åˆï¼‰
      if (state.settings.googleDrive.enabled) {
        const surveyName = survey?.name || 'èª¿æŸ»';
        await addToSyncQueue(record.id, filename, surveyName);
      }

      // ãƒ‡ãƒã‚¤ã‚¹ã«ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ï¼ˆæœ‰åŠ¹ãªå ´åˆï¼‰
      if (state.settings.downloadToDevice) {
        downloadPhoto(dataUrl, filename);
      }

      state.lastRecordId = record.id;
      renderLandscapeTree();
      renderCaptureSection();
      renderRecentList();
    }

    // Downloadsãƒ•ã‚©ãƒ«ãƒ€ã«ã‚‚ä¿å­˜
    async function downloadPhoto(dataUrl, filename) {
      // Data URLã‚’Blobã«å¤‰æ›
      const arr = dataUrl.split(',');
      const mime = arr[0].match(/:(.*?);/)[1];
      const bstr = atob(arr[1]);
      let n = bstr.length;
      const u8arr = new Uint8Array(n);
      while (n--) {
        u8arr[n] = bstr.charCodeAt(n);
      }
      const blob = new Blob([u8arr], { type: mime });

      // iOSã®å ´åˆã¯Web Share APIã‚’ä½¿ç”¨ï¼ˆ<a download>ãŒå‹•ä½œã—ãªã„ãŸã‚ï¼‰
      const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);
      if (isIOS && navigator.canShare) {
        const file = new File([blob], filename, { type: mime });
        if (navigator.canShare({ files: [file] })) {
          try {
            await navigator.share({ files: [file] });
            return;
          } catch (e) {
            // ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã‚­ãƒ£ãƒ³ã‚»ãƒ«ã—ãŸå ´åˆã¯ä½•ã‚‚ã—ãªã„
            if (e.name === 'AbortError') return;
          }
        }
      }

      // é€šå¸¸ã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ï¼ˆéiOSï¼‰
      const blobUrl = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = blobUrl;
      a.download = filename;
      a.click();
      setTimeout(() => URL.revokeObjectURL(blobUrl), 1000);
    }

    async function undoCapture() {
      if (!state.lastRecordId) return;
      if (!confirm('ç›´å‰ã®æ’®å½±ã‚’å–ã‚Šæ¶ˆã—ã¾ã™ã‹ï¼Ÿ')) return;

      const recordId = state.lastRecordId;
      await dbDelete('photos', recordId);
      await dbDelete('records', recordId);
      state.records = state.records.filter(r => r.id !== recordId);
      state.lastRecordId = null;

      renderLandscapeTree();
      renderCaptureSection();
      renderRecentList();
    }

    // ============================================
    // ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
    // ============================================
    async function openExportModal() {
      const modal = $('exportModal');
      const records = state.records.filter(r => r.surveyId === state.currentSurveyId);
      const nodes = state.nodes.filter(n => n.surveyId === state.currentSurveyId);

      // çµ±è¨ˆ
      $('exportStats').innerHTML = `
        <div class="stat-item">
          <div class="stat-value">${records.length}</div>
          <div class="stat-label">å†™çœŸ</div>
        </div>
        <div class="stat-item">
          <div class="stat-value">${nodes.length}</div>
          <div class="stat-label">éšå±¤</div>
        </div>
      `;

      // å†™çœŸä¸€è¦§
      const grid = $('photoGrid');
      grid.innerHTML = '';

      for (const record of records) {
        const photo = await dbGet('photos', record.id);
        if (!photo) continue;

        const div = document.createElement('div');
        div.className = 'photo-item';
        div.innerHTML = `
          <img src="${photo.dataUrl}" alt="${record.filename}">
          <button class="photo-item-delete" data-id="${record.id}">âœ•</button>
          <div class="photo-item-name">${escapeHtml(record.filename)}</div>
        `;
        grid.appendChild(div);
      }

      grid.querySelectorAll('.photo-item-delete').forEach(btn => {
        btn.addEventListener('click', async () => {
          if (!confirm('ã“ã®å†™çœŸã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) return;
          await deletePhoto(btn.dataset.id);
          openExportModal(); // å†æç”»
        });
      });

      modal.classList.add('active');
    }

    async function deletePhoto(recordId) {
      await dbDelete('photos', recordId);
      await dbDelete('records', recordId);
      state.records = state.records.filter(r => r.id !== recordId);
      if (state.lastRecordId === recordId) {
        state.lastRecordId = null;
      }
      renderCaptureSection();
      renderRecentList();
    }

    async function downloadZip() {
      const survey = state.surveys.find(s => s.id === state.currentSurveyId);
      const records = state.records.filter(r => r.surveyId === state.currentSurveyId);

      if (records.length === 0) {
        alert('ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã™ã‚‹å†™çœŸãŒã‚ã‚Šã¾ã›ã‚“');
        return;
      }

      const zip = new JSZip();
      const nodesMap = getNodesMap();
      const settings = getSurveySettings();

      for (const record of records) {
        const photo = await dbGet('photos', record.id);
        if (!photo) continue;

        // ãƒ•ã‚©ãƒ«ãƒ€ãƒ‘ã‚¹ç”Ÿæˆ
        const names = getHierarchyNames(record.nodeId, nodesMap);
        const folderPath = names.join('/');
        const base64 = photo.dataUrl.split(',')[1];

        zip.file(`${folderPath}/${record.filename}`, base64, { base64: true });
      }

      // metadata.csv ç”Ÿæˆï¼ˆtypeä»˜ãèª¿æŸ»ã®å ´åˆï¼‰
      if (survey?.type && SURVEY_TYPES[survey.type]) {
        const csvRows = ['\uFEFFãƒ•ã‚¡ã‚¤ãƒ«å,ã‚«ãƒ†ã‚´ãƒª,éƒ¨ä½,æè³ª,ç‰¹è¨˜'];
        for (const record of records) {
          const m = record.metadata;
          if (m) {
            const escapeCsv = (v) => (v || '').replace(/"/g, '""');
            csvRows.push(`"${escapeCsv(record.filename)}","${escapeCsv(m.category)}","${escapeCsv(m.part)}","${escapeCsv(m.material)}","${escapeCsv(m.note)}"`);
          }
        }
        if (csvRows.length > 1) {
          zip.file('metadata.csv', csvRows.join('\r\n'));
        }
      }

      const content = await zip.generateAsync({ type: 'blob' });
      const date = new Date().toISOString().split('T')[0];
      const filename = `${survey.name}_${date}.zip`;

      const a = document.createElement('a');
      a.href = URL.createObjectURL(content);
      a.download = filename;
      a.click();
      URL.revokeObjectURL(a.href);

      $('exportModal').classList.remove('active');
    }

    // ============================================
    // ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿å…¥åŠ›ï¼ˆå¥å…¨åº¦èª¿æŸ»ç¥¨ç­‰ï¼‰
    // ============================================

    let _metadataInitialized = false;

    function renderMetadataForm(type) {
      const master = SURVEY_TYPES[type]?.master;
      if (!master) return;

      const tabsEl = $('categoryTabs');
      const cats = Object.keys(master.parts);

      // åˆå›ã®ã¿ã‚¿ãƒ–ç”Ÿæˆ
      if (!_metadataInitialized) {
        tabsEl.innerHTML = '';
        cats.forEach((cat, i) => {
          const btn = document.createElement('button');
          btn.textContent = cat;
          btn.dataset.cat = cat;
          if (i === 0) btn.classList.add('active');
          btn.addEventListener('click', () => onCategoryChange(type, cat));
          tabsEl.appendChild(btn);
        });

        $('metaPart').addEventListener('change', () => onPartChange(type));

        _metadataInitialized = true;

        // å‰å›å€¤å¾©å…ƒ or ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ
        if (state.lastMetadata?.category && cats.includes(state.lastMetadata.category)) {
          onCategoryChange(type, state.lastMetadata.category);
          restoreLastMetadata(type);
        } else {
          onCategoryChange(type, cats[0]);
        }
      }
    }

    function onCategoryChange(type, cat) {
      const master = SURVEY_TYPES[type].master;
      const tabsEl = $('categoryTabs');

      // ã‚¿ãƒ–åˆ‡æ›¿
      Array.from(tabsEl.children).forEach(btn => {
        btn.classList.toggle('active', btn.dataset.cat === cat);
      });

      // éƒ¨ä½ãƒªã‚¹ãƒˆæ›´æ–°
      const partEl = $('metaPart');
      const parts = master.parts[cat] || [];
      partEl.innerHTML = '<option value="">éƒ¨ä½</option>';
      parts.forEach(p => {
        const opt = document.createElement('option');
        opt.value = p;
        opt.textContent = p;
        partEl.appendChild(opt);
      });

      // æè³ªãƒ»ç‰¹è¨˜ã‚’ãƒªã‚»ãƒƒãƒˆï¼ˆã‚«ãƒ†ã‚´ãƒªã®ã¿ã§ãƒ•ã‚£ãƒ«ã‚¿ï¼‰
      updateMaterialOptions(type, cat, '');
      updateNoteOptions(type, cat, '');
    }

    function onPartChange(type) {
      const cat = getCurrentCategory();
      const part = $('metaPart').value;
      updateMaterialOptions(type, cat, part);
      updateNoteOptions(type, cat, part);
    }

    function getCurrentCategory() {
      const active = document.querySelector('#categoryTabs button.active');
      return active?.dataset.cat || '';
    }

    function updateMaterialOptions(type, cat, part) {
      const master = SURVEY_TYPES[type].master;
      const el = $('metaMaterial');
      const prev = el.value;

      const filtered = master.materials.filter(m =>
        m.cat === cat && (!part || m.parts.includes(part))
      );

      el.innerHTML = '<option value="">æè³ª</option>';
      const seen = new Set();
      filtered.forEach(m => {
        if (!seen.has(m.val)) {
          seen.add(m.val);
          const opt = document.createElement('option');
          opt.value = m.val;
          opt.textContent = m.val;
          el.appendChild(opt);
        }
      });

      // å‰ã®å€¤ãŒæ®‹ã£ã¦ã„ã‚Œã°å¾©å…ƒ
      if (prev && seen.has(prev)) el.value = prev;
    }

    function updateNoteOptions(type, cat, part) {
      const master = SURVEY_TYPES[type].master;
      const el = $('metaNote');
      const prev = el.value;

      const filtered = master.notes.filter(n =>
        n.cat === cat && (!part || n.parts.includes(part))
      );

      el.innerHTML = '<option value="">ç‰¹è¨˜</option>';
      const seen = new Set();
      filtered.forEach(n => {
        if (!seen.has(n.val)) {
          seen.add(n.val);
          const opt = document.createElement('option');
          opt.value = n.val;
          opt.textContent = n.val;
          el.appendChild(opt);
        }
      });

      if (prev && seen.has(prev)) el.value = prev;
    }

    function getMetadataFromForm() {
      const survey = state.surveys.find(s => s.id === state.currentSurveyId);
      if (!survey?.type || !SURVEY_TYPES[survey.type]) return null;

      return {
        category: getCurrentCategory(),
        part: $('metaPart').value,
        material: $('metaMaterial').value,
        note: $('metaNote').value
      };
    }

    function restoreLastMetadata(type) {
      const m = state.lastMetadata;
      if (!m) return;

      if (m.part) {
        $('metaPart').value = m.part;
        onPartChange(type);
      }
      if (m.material) $('metaMaterial').value = m.material;
      if (m.note) $('metaNote').value = m.note;
    }

    // ============================================
    // ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
    // ============================================
    async function saveAsTemplate() {
      if (!state.currentSurveyId) {
        alert('èª¿æŸ»ã‚’é¸æŠã—ã¦ãã ã•ã„');
        return;
      }

      const surveyNodes = state.nodes.filter(n => n.surveyId === state.currentSurveyId);
      if (surveyNodes.length === 0) {
        alert('ä¿å­˜ã™ã‚‹éšå±¤ãŒã‚ã‚Šã¾ã›ã‚“');
        return;
      }

      const name = prompt('ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆåã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
      if (!name) return;

      // ãƒãƒ¼ãƒ‰æ§‹é€ ã‚’ã‚³ãƒ”ãƒ¼ï¼ˆIDã‚’é™¤ãï¼‰
      const nodesCopy = surveyNodes.map(n => ({
        name: n.name,
        parentId: n.parentId,
        order: n.order
      }));

      // parentIdã‚’ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã«å¤‰æ›
      const idToIndex = new Map(surveyNodes.map((n, i) => [n.id, i]));
      nodesCopy.forEach(n => {
        n.parentIndex = n.parentId ? idToIndex.get(n.parentId) : null;
        delete n.parentId;
      });

      const template = {
        id: generateId(),
        name,
        nodes: nodesCopy,
        createdAt: Date.now()
      };

      await dbPut('templates', template);
      state.templates.push(template);
      renderTemplateList();
      renderTemplateSelect();
    }

    async function applyTemplate(surveyId, templateId) {
      const template = state.templates.find(t => t.id === templateId);
      if (!template) return;

      const newIds = [];

      for (const nodeDef of template.nodes) {
        const node = {
          id: generateId(),
          surveyId,
          parentId: nodeDef.parentIndex !== null ? newIds[nodeDef.parentIndex] : null,
          name: nodeDef.name,
          order: nodeDef.order,
          createdAt: Date.now()
        };
        await dbPut('nodes', node);
        state.nodes.push(node);
        newIds.push(node.id);
      }
    }

    async function deleteTemplate(templateId) {
      if (!confirm('ã“ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) return;
      await dbDelete('templates', templateId);
      state.templates = state.templates.filter(t => t.id !== templateId);
      renderTemplateList();
      renderTemplateSelect();
    }

    // ============================================
    // è¨­å®š
    // ============================================
    function openSettingsModal() {
      const modal = $('settingsModal');
      const s = state.settings;

      $('darkModeToggle').checked = s.darkMode;
      $('downloadToDeviceToggle').checked = s.downloadToDevice;
      $('defaultDigits').value = s.digits;
      $('defaultStartNum').value = s.startNum;
      $('defaultPrefix').value = s.prefix;
      $('defaultSeparator').value = s.separator;
      $('defaultZeroPad').checked = s.zeroPad;

      updateGoogleDriveUI();
      renderTemplateList();
      modal.classList.add('active');
    }

    async function saveSettings() {
      const googleDrive = state.settings.googleDrive; // ä¿æŒ
      const downloadToDevice = state.settings.downloadToDevice; // ä¿æŒ
      state.settings = {
        darkMode: $('darkModeToggle').checked,
        digits: parseInt($('defaultDigits').value),
        startNum: parseInt($('defaultStartNum').value),
        prefix: $('defaultPrefix').value,
        separator: $('defaultSeparator').value,
        zeroPad: $('defaultZeroPad').checked,
        googleDrive,
        downloadToDevice
      };

      await dbPut('settings', { key: 'app', ...state.settings });
      applyTheme();
      $('settingsModal').classList.remove('active');

      if (state.currentSurveyId) {
        renderCaptureSection();
      }
    }

    function applyTheme() {
      document.documentElement.dataset.theme = state.settings.darkMode ? 'dark' : 'light';
    }

    async function updateApp() {
      if (!confirm('ã‚¢ãƒ—ãƒªã‚’æ›´æ–°ã—ã¾ã™ã‹ï¼Ÿ')) return;

      if ('serviceWorker' in navigator) {
        const registration = await navigator.serviceWorker.getRegistration();
        if (registration) {
          await registration.unregister();
        }
        const cacheNames = await caches.keys();
        await Promise.all(cacheNames.map(name => caches.delete(name)));
      }

      location.reload();
    }

    async function resetData() {
      if (!confirm('å…¨ã¦ã®ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ\nã“ã®æ“ä½œã¯å–ã‚Šæ¶ˆã›ã¾ã›ã‚“ã€‚')) return;
      if (!confirm('æœ¬å½“ã«å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) return;

      await dbClear('surveys');
      await dbClear('nodes');
      await dbClear('records');
      await dbClear('photos');
      await dbClear('templates');

      state.surveys = [];
      state.nodes = [];
      state.records = [];
      state.templates = [];
      state.currentSurveyId = null;
      state.currentNodeId = null;
      state.lastRecordId = null;

      $('settingsModal').classList.remove('active');
      showScreen('survey');
      renderSurveyList();
    }

    // ============================================
    // åˆæœŸåŒ–
    // ============================================
    async function init() {
      await initDB();

      // ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿
      state.surveys = await dbGetAll('surveys');
      state.nodes = await dbGetAll('nodes');
      state.records = await dbGetAll('records');
      state.templates = await dbGetAll('templates');

      const savedSettings = await dbGet('settings', 'app');
      if (savedSettings) {
        state.settings = { ...state.settings, ...savedSettings };
      }

      // Google Driveè¨­å®šã‚’èª­ã¿è¾¼ã¿
      const savedGoogleDrive = await dbGet('settings', 'googleDrive');
      if (savedGoogleDrive) {
        state.settings.googleDrive = { ...state.settings.googleDrive, ...savedGoogleDrive };
      }

      // downloadToDeviceè¨­å®šã‚’èª­ã¿è¾¼ã¿
      const savedDownload = await dbGet('settings', 'downloadToDevice');
      if (savedDownload) {
        state.settings.downloadToDevice = savedDownload.value;
      }

      applyTheme();
      showScreen('survey');
      renderSurveyList();

      // Service Workerç™»éŒ²
      if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('sw.js');
      }

      // Google APIåˆæœŸåŒ–ï¼ˆé…å»¶ï¼‰
      setTimeout(async () => {
        await initGapi();
        await initGis();
        // æ¥ç¶šæ¸ˆã¿ã®å ´åˆã¯åŒæœŸã‚­ãƒ¥ãƒ¼ã‚’å‡¦ç†
        if (state.settings.googleDrive.enabled && navigator.onLine) {
          processSyncQueue();
        }
      }, 1000);

      // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼è¨­å®š
      setupEventListeners();
    }

    function setupEventListeners() {
      // ãƒ˜ãƒƒãƒ€ãƒ¼ãƒœã‚¿ãƒ³
      $('btnBack').addEventListener('click', () => {
        state.currentSurveyId = null;
        state.currentNodeId = null;
        $('headerTitle').textContent = 'Flashnap';
        $('btnBack').classList.add('hidden');
        showScreen('survey');
        renderSurveyList();
      });
      $('btnExport').addEventListener('click', () => {
        if (!state.currentSurveyId) {
          alert('èª¿æŸ»ã‚’é¸æŠã—ã¦ãã ã•ã„');
          return;
        }
        openExportModal();
      });
      $('btnSettings').addEventListener('click', openSettingsModal);
      $('headerTitle').addEventListener('click', () => {
        state.currentSurveyId = null;
        state.currentNodeId = null;
        showScreen('survey');
        renderSurveyList();
      });

      // èª¿æŸ»ãƒ¢ãƒ¼ãƒ€ãƒ«
      $('btnNewSurvey').addEventListener('click', () => openSurveyModal());
      $('btnCloseSurveyModal').addEventListener('click', () => $('surveyModal').classList.remove('active'));
      $('btnCancelSurvey').addEventListener('click', () => $('surveyModal').classList.remove('active'));
      $('btnSaveSurvey').addEventListener('click', saveSurvey);

      // éšå±¤ãƒ¢ãƒ¼ãƒ€ãƒ«
      $('btnAddNode').addEventListener('click', () => openNodeModal());
      $('btnAddNodeLandscape').addEventListener('click', () => openNodeModal());
      $('btnCloseNodeModal').addEventListener('click', () => $('nodeModal').classList.remove('active'));
      $('btnCancelNode').addEventListener('click', () => $('nodeModal').classList.remove('active'));
      $('btnSaveNode').addEventListener('click', saveNode);

      // ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆãƒ¢ãƒ¼ãƒ€ãƒ«
      $('btnCloseExportModal').addEventListener('click', () => $('exportModal').classList.remove('active'));
      $('btnCancelExport').addEventListener('click', () => $('exportModal').classList.remove('active'));
      $('btnDownloadZip').addEventListener('click', downloadZip);

      // è¨­å®šãƒ¢ãƒ¼ãƒ€ãƒ«
      $('btnCloseSettingsModal').addEventListener('click', () => $('settingsModal').classList.remove('active'));
      $('btnSaveSettings').addEventListener('click', saveSettings);
      $('btnSaveTemplate').addEventListener('click', saveAsTemplate);
      $('btnUpdateApp').addEventListener('click', updateApp);
      $('btnResetData').addEventListener('click', resetData);

      // ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰å³æ™‚åæ˜ 
      $('darkModeToggle').addEventListener('change', () => {
        state.settings.darkMode = $('darkModeToggle').checked;
        applyTheme();
      });

      // Google Drive
      $('btnConnectGoogleDrive').addEventListener('click', connectGoogleDrive);
      $('btnDisconnectGoogleDrive').addEventListener('click', disconnectGoogleDrive);
      $('btnSyncNow').addEventListener('click', syncNowWithFeedback);
      $('btnClearSyncQueue').addEventListener('click', clearSyncQueue);

      // ãƒ‡ãƒã‚¤ã‚¹ä¿å­˜å³æ™‚åæ˜ 
      $('downloadToDeviceToggle').addEventListener('change', async () => {
        state.settings.downloadToDevice = $('downloadToDeviceToggle').checked;
        await dbPut('settings', { key: 'downloadToDevice', value: state.settings.downloadToDevice });
      });

      // æ’®å½±
      $('btnCapture').addEventListener('click', () => $('fileInput').click());
      $('btnCaptureLandscape').addEventListener('click', () => $('fileInput').click());
      $('fileInput').addEventListener('change', (e) => {
        if (e.target.files[0]) {
          handleCapture(e.target.files[0]);
          e.target.value = '';
        }
      });
      $('btnUndo').addEventListener('click', undoCapture);
      $('btnUndoLandscape').addEventListener('click', undoCapture);

      // ãƒ¢ãƒ¼ãƒ€ãƒ«å¤–ã‚¯ãƒªãƒƒã‚¯ã§é–‰ã˜ã‚‹
      document.querySelectorAll('.modal-overlay').forEach(overlay => {
        overlay.addEventListener('click', (e) => {
          if (e.target === overlay) {
            overlay.classList.remove('active');
          }
        });
      });
    }

    // èµ·å‹•
    init();
  </script>
</body>
</html>
